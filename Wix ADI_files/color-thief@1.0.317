var isValidFocusRect=function(t){return!!t&&"object"==typeof t&&t.top&&t.left&&t.width&&t.height},CanvasImage=function(t,r){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),isValidFocusRect(r)?(this.width=this.canvas.width=r.width,this.height=this.canvas.height=r.height,this.context.drawImage(t,r.left,r.top,r.width,r.height,0,0,r.width,r.height)):(this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height))};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(t){this.context.putImageData(t,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(t,r,n){return this.getPalette(t,5,r,n)[0]},ColorThief.prototype.getPalette=function(t,r,n,o){void 0===r&&(r=10),(void 0===n||n<1)&&(n=10);for(var e,i,a,u,c=new CanvasImage(t,o),h=c.getImageData().data,s=c.getPixelCount(),f=[],v=0;v<s;v+=n)i=h[(e=4*v)+0],a=h[e+1],u=h[e+2],h[e+3]>=125&&(i>250&&a>250&&u>250||f.push([i,a,u]));var p=MMCQ.quantize(f,r),l=p?p.palette():null;return c.removeCanvas(),l},!pv)var pv={map:function(t,r){var n={};return r?t.map(function(t,o){return n.index=o,r.call(n,t)}):t.slice()},naturalOrder:function(t,r){return t<r?-1:t>r?1:0},sum:function(t,r){var n={};return t.reduce(r?function(t,o,e){return n.index=e,t+r.call(n,o)}:function(t,r){return t+r},0)},max:function(t,r){return Math.max.apply(null,r?pv.map(t,r):t)}};var MMCQ=function(){var t=5,r=8-t,n=1e3,o=.75;function e(r,n,o){return(r<<2*t)+(n<<t)+o}function i(t){var r=[],n=!1;function o(){r.sort(t),n=!0}return{push:function(t){r.push(t),n=!1},peek:function(t){return n||o(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return n||o(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return n||o(),r}}}function a(t,r,n,o,e,i,a){var u=this;u.r1=t,u.r2=r,u.g1=n,u.g2=o,u.b1=e,u.b2=i,u.histo=a}function u(){this.vboxes=new i(function(t,r){return pv.naturalOrder(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume())})}function c(t,r){if(r.count()){var n=r.r2-r.r1+1,o=r.g2-r.g1+1,i=r.b2-r.b1+1,a=pv.max([n,o,i]);if(1==r.count())return[r.copy()];var u,c,h,s,f=0,v=[],p=[];if(a==n)for(u=r.r1;u<=r.r2;u++){for(s=0,c=r.g1;c<=r.g2;c++)for(h=r.b1;h<=r.b2;h++)s+=t[e(u,c,h)]||0;f+=s,v[u]=f}else if(a==o)for(u=r.g1;u<=r.g2;u++){for(s=0,c=r.r1;c<=r.r2;c++)for(h=r.b1;h<=r.b2;h++)s+=t[e(c,u,h)]||0;f+=s,v[u]=f}else for(u=r.b1;u<=r.b2;u++){for(s=0,c=r.r1;c<=r.r2;c++)for(h=r.g1;h<=r.g2;h++)s+=t[e(c,h,u)]||0;f+=s,v[u]=f}return v.forEach(function(t,r){p[r]=f-t}),l(a==n?"r":a==o?"g":"b")}function l(t){var n,o,e,i,a,c=t+"1",h=t+"2",s=0;for(u=r[c];u<=r[h];u++)if(v[u]>f/2){for(e=r.copy(),i=r.copy(),a=(n=u-r[c])<=(o=r[h]-u)?Math.min(r[h]-1,~~(u+o/2)):Math.max(r[c],~~(u-1-n/2));!v[a];)a++;for(s=p[a];!s&&v[a-1];)s=p[--a];return e[h]=a,i[c]=e[h]+1,[e,i]}}}return a.prototype={volume:function(t){var r=this;return r._volume&&!t||(r._volume=(r.r2-r.r1+1)*(r.g2-r.g1+1)*(r.b2-r.b1+1)),r._volume},count:function(t){var r=this,n=r.histo;if(!r._count_set||t){var o,i,a,u=0;for(o=r.r1;o<=r.r2;o++)for(i=r.g1;i<=r.g2;i++)for(a=r.b1;a<=r.b2;a++)index=e(o,i,a),u+=n[index]||0;r._count=u,r._count_set=!0}return r._count},copy:function(){var t=this;return new a(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(r){var n=this,o=n.histo;if(!n._avg||r){var i,a,u,c,h=0,s=1<<8-t,f=0,v=0,p=0;for(a=n.r1;a<=n.r2;a++)for(u=n.g1;u<=n.g2;u++)for(c=n.b1;c<=n.b2;c++)h+=i=o[e(a,u,c)]||0,f+=i*(a+.5)*s,v+=i*(u+.5)*s,p+=i*(c+.5)*s;n._avg=h?[~~(f/h),~~(v/h),~~(p/h)]:[~~(s*(n.r1+n.r2+1)/2),~~(s*(n.g1+n.g2+1)/2),~~(s*(n.b1+n.b2+1)/2)]}return n._avg},contains:function(t){var n=this,o=t[0]>>r;return gval=t[1]>>r,bval=t[2]>>r,o>=n.r1&&o<=n.r2&&gval>=n.g1&&gval<=n.g2&&bval>=n.b1&&bval<=n.b2}},u.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)},nearest:function(t){for(var r,n,o,e=this.vboxes,i=0;i<e.size();i++)((n=Math.sqrt(Math.pow(t[0]-e.peek(i).color[0],2)+Math.pow(t[1]-e.peek(i).color[1],2)+Math.pow(t[2]-e.peek(i).color[2],2)))<r||void 0===r)&&(r=n,o=e.peek(i).color);return o},forcebw:function(){var t=this.vboxes;t.sort(function(t,r){return pv.naturalOrder(pv.sum(t.color),pv.sum(r.color))});var r=t[0].color;r[0]<5&&r[1]<5&&r[2]<5&&(t[0].color=[0,0,0]);var n=t.length-1,o=t[n].color;o[0]>251&&o[1]>251&&o[2]>251&&(t[n].color=[255,255,255])}},{quantize:function(h,s){if(!h.length||s<2||s>256)return!1;var f,v,p,l,g,d,m=(f=h,d=new Array(1<<3*t),f.forEach(function(t){p=t[0]>>r,l=t[1]>>r,g=t[2]>>r,v=e(p,l,g),d[v]=(d[v]||0)+1}),d);m.forEach(function(){});var b,x,w,C,y,M,I,_,z,k,E=(b=m,y=1e6,M=0,I=1e6,_=0,z=1e6,k=0,h.forEach(function(t){x=t[0]>>r,w=t[1]>>r,C=t[2]>>r,x<y?y=x:x>M&&(M=x),w<I?I=w:w>_&&(_=w),C<z?z=C:C>k&&(k=C)}),new a(y,M,I,_,z,k,b)),O=new i(function(t,r){return pv.naturalOrder(t.count(),r.count())});function T(t,r){for(var o,e=1,i=0;i<n;)if((o=t.pop()).count()){var a=c(m,o),u=a[0],h=a[1];if(!u)return;if(t.push(u),h&&(t.push(h),e++),e>=r)return;if(i++>n)return}else t.push(o),i++}O.push(E),T(O,o*s);for(var D=new i(function(t,r){return pv.naturalOrder(t.count()*t.volume(),r.count()*r.volume())});O.size();)D.push(O.pop());T(D,s-D.size());for(var P=new u;D.size();)P.push(D.pop());return P}}}();ColorThief.MMCQ=MMCQ,"undefined"!=typeof module&&module.exports&&(module.exports=ColorThief);