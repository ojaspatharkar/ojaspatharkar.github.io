function UUID(){}(function(){"use strict";var logger,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};logger=new Logger("WindowMessenger"),this.WindowMessenger=function(){function WindowMessenger(targetWindow){if(this.targetWindow=targetWindow,this._eventHandler=bind(this._eventHandler,this),this.emit=bind(this.emit,this),this.off=bind(this.off,this),this.one=bind(this.one,this),this.on=bind(this.on,this),void 0===this.targetWindow)throw new Error("target window should be defined");this.observers=[],window.addEventListener("message",this._eventHandler,!1)}return WindowMessenger.prototype.on=function(event,fn){return this.observers.push({event:event,fn:fn})},WindowMessenger.prototype.one=function(event,fn){return this.observers.push({event:event,fn:fn,once:!0})},WindowMessenger.prototype.off=function(event,fn){var i,j;for(i=j=this.observers.length-1;j>=0;i=j+=-1)this.observers[i].event!==event||this.observers[i].fn!==fn&&void 0!==fn||this.observers.splice(i,1)},WindowMessenger.prototype.emit=function(event,data){return logger.log("postMessage emitted",event,data),this.targetWindow.postMessage(JSON.stringify({event:event,data:data}),"*")},WindowMessenger.prototype._eventHandler=function(event){var data;if(event.source===this.targetWindow)return data=JSON.parse(event.data),logger.log("postMessage received",data),this.observers.filter(function(observer){return observer.event===data.event}).forEach(function(_this){return function(observer){if(observer.fn.call(event,data.data),observer.once)return _this.off(observer.event,observer.fn)}}(this))},WindowMessenger}()}).call(this),function(){"use strict";this.app=angular.module("mediaGalleryApp",["templates","ngResource","ui.router","restangular","ngDialog","ui.bootstrap","wixStyle"])}.call(this),angular.module("templates",[]).run(["$templateCache",function($templateCache){"use strict";$templateCache.put("scripts/directives/breadcrumbs/breadcrumbs.html",'<div class="breadcrumbs"><div ng-repeat="(index, folder) in existedList()" ng-switch="index != existedList().length - 1" class="item"><button ng-click="action({folder: folder})" ng-switch-when="true">{{folder.name}}</button><span ng-switch-when="false">{{folder.name}}</span></div></div>'),$templateCache.put("scripts/directives/draggable/draggable-helper.html",'<div ng-show="count" ng-class="{folder: isFolder(entity)}" class="draggable-helper"><div covered-background="{{entity.thumbnailUrl}}" class="box"><div ng-bind="count" class="count"></div><div class="name">{{entity.name}}</div></div><div ng-show="count &gt;= 2" class="box two"></div><div ng-show="count &gt;= 3" class="box many"></div></div>'),$templateCache.put("scripts/directives/entities-grid/entities-grid.html",'<ul multi-select="entities" ng-hide="entities.length == 0" ng-class="adapterName" class="items"><li ng-repeat="entity in entities track by entity.id" bi-click="{eventName: \'itemSelect.click\', data: { target: entity.id }}" more-actions-tooltip="{}" multi-select-entity="entity" can-select-multiple="canSelectMultiple" ng-class="{selected: isSelected(entity), processing: entity._isProcessing, renaming: renameCtrl.isVisible(entity), folder: isFolder(entity), transcoding: entity.can.transcode() &amp;&amp; !entity.isTranscoded()}" ng-click="click({entity: entity})" ng-dblclick="doubleClick({entity: entity})" draggable="entity" can-drag="entity.can.move()" droppable="moveSelectedToFolder({folder: entity})" can-drop-entities="entity.can.moveItemIn()" item-url="{{entity.fileUrl}}" class="item mt-{{entity.mediaType}}"><div ng-if="isFolder(entity)" class="folder-background"></div><div covered-background="{{entity.thumbnailUrl}}" load-visible-for=".entities-wrapper" load-if-changed="selectedLayoutId + entities.length" on-load-success="onThumbnailLoaded()" ng-class="{item: !isFolder(entity), folder:isFolder(entity)}" class="image"></div><div ng-show="entity.can.transcode() &amp;&amp; !entity.isTranscoded()" ng-switch="entity.transcodingStatus" ng-class="entity.transcodingStatus.toLowerCase()" class="transcoding-status"><div ng-class="{&quot;title-centered&quot;: isIE11}" class="title inprogress">{{ "private_media.transcoding" | translate }}</div><div ng-hide="isIE11" class="spinner inprogress"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div><div class="title in-queue">{{ "private_media.transcoding" | translate }}:</div><div class="message in-queue">{{ "private_media.transcoding_in_queue" | translate }}</div><div class="title failed">{{ "private_media.transcoding_fails.title" | translate }}</div><div class="message failed">{{ "private_media.transcoding_fails.message" | translate }}</div></div><renamable-name entity="entity" rename-ctrl="renameCtrl" redraw-on-change="selectedLayoutId"></renamable-name><ul ng-hide="!entity.can.showImagePreview() &amp;&amp; !entity.can.showVideoPreview() &amp;&amp; !entity.can.showExternalVideoPreview() &amp;&amp; !entity.can.makeFavorites() &amp;&amp; !entity.can.rename() &amp;&amp; !entity.can.remove() &amp;&amp; !entity.can.removeFromFolder() &amp;&amp; !entity.can.edit() &amp;&amp; !entity.can.getDownloadLink() &amp;&amp; !entity.can.restore() &amp;&amp; !entity.can.buy()" ng-class="&quot;transcoding-&quot; + entity.transcodingStatus.toLowerCase()" class="actions"><li ng-if="entity.can.showImagePreview() || entity.can.showVideoPreview() || entity.can.showExternalVideoPreview()"><preview adapter-name="adapterName" folder-name="folderName(entity)" item="entity"></preview></li><li ng-if="entity.can.makeFavorites()"><button ng-class="{active: entity.isFavorites()}" deny-bubbling="mousedown" bi-click="{eventName: \'makeItemFavoritesButton.click\', data: {target: entity.id}}" ng-click="entity.isFavorites() ? entity.unmakeFavorites() : entity.makeFavorites()" tooltip-append-to-body="true" tooltip="{{\'private_media.make_favorites\' | translate}}" class="action favorites"></button></li><li ng-if="entity.can.rename()"><button bi-click="{eventName: \'renameButton.click\', data: {target: entity.id}}" deny-bubbling="mousedown" ng-click="renameCtrl.show(entity)" tooltip-append-to-body="true" tooltip="{{\'private_media.rename_item\' | translate}}" class="action rename"></button></li><li ng-if="entity.can.remove()"><button bi-click="{eventName: \'removeItemButton.click\', data: {target: entity.id}}" deny-bubbling="mousedown" ng-click="remove.one(entity)" tooltip-append-to-body="true" tooltip="{{ settings.hasTrash ? \'private_media.move_to_trash\' : \'private_media.remove_item\' | translate}}" class="action remove"></button></li><li ng-if="entity.can.removeFromFolder()"><button bi-click="{eventName: \'removeFromFolderItemButton.click\', data: {target: entity.id}}" deny-bubbling="mousedown" ng-click="remove.one(entity)" tooltip-append-to-body="true" tooltip="{{\'private_media.remove_item_from_folder\' | translate}}" class="action remove"></button></li><li ng-if="entity.can.edit()"><button bi-click="{eventName: \'editItemButton.click\', data: {target: entity.id}}" deny-bubbling="mousedown" ng-click="editItemInMediaStudio(entity)" tooltip-append-to-body="true" tooltip="{{\'private_media.edit_item\' | translate}}" class="action edit"></button></li><li ng-if="entity.can.getDownloadLink()"><a bi-click="{eventName: \'downloadItemButton.click\', data: {target: entity.id}}" deny-bubbling="mousedown" download="{{entity.name}}" href="{{entity.getDownloadLink()}}" target="_blank" tooltip-append-to-body="true" tooltip="{{\'private_media.download_item\' | translate}}" class="action download"></a></li><li ng-if="entity.can.restore()"><button bi-click="{eventName: \'restoreItemButton.click\', data: {target: entity.id}}" ng-click="entity.restore();" deny-bubbling="mousedown" tooltip-append-to-body="true" tooltip="{{\'private_media.restore_item\' | translate}}" class="action restore"></button></li><li ng-if="entity.can.buy()"><button ng-click="selectAndSubmitItem({item: entity})" class="action price"><span ng-bind-html="price"></span></button></li></ul></li></ul>'),$templateCache.put("scripts/directives/folder-actions/folder-actions.html",'<a deny-bubbling="click" ng-show="folder.can.rename() || folder.can.remove() || folder.can.restore() || folder.can.deleteAll()" popup="{contentClass: \'context-menu\', offsetLeft: 10, offsetTop: 18}" class="actions"></a><div class="context-menu menu"><button bi-click="{eventName: \'renameFolderButton.click\', data: {target: folder.id}}" ng-click="showRenaming()" ng-if="folder.can.rename()" class="rename-folder">{{"private_media.rename_folder" | translate}}</button><button bi-click="{eventName: \'removeFolderButton.click\', data: {target: folder.id}}" ng-click="remove.folder(folder)" ng-if="folder.can.remove()" class="remove-folder">{{"private_media.remove_folder" | translate}}</button><button ng-if="folder.can.restore()" ng-click="folder.restore()" class="restore-all">{{\'private_media.restore_all\' | translate}}</button><button ng-if="folder.can.deleteAll()" ng-click="folder.deleteAll()" class="delete-all">{{\'private_media.empty_trash\' | translate}}</button></div>'),$templateCache.put("scripts/directives/help-popup/help-popup.html",'<div><div ng-show="$help.popupIsVisible" class="inner-popup-underlay"></div><div id="help" ng-if="$help.popupIsVisible" class="inner-popup"><div class="popup-header"><h2><button ng-click="$help.hidePopup()" class="close">×</button></h2></div><div class="popup-content"><iframe ng-src="{{$help.url}}" on-load="hideLoader()"></iframe></div><div class="popup-loader loading loaders"><spinner></spinner></div></div></div>'),$templateCache.put("scripts/directives/more-actions-tooltip/show-more.html","<li class=\"show-more\"><button popup=\"{contentClass: 'context-menu', align: 'bottom center', offsetTop: 18, centeredTip: true, event: 'mouseover', parentSelector: options.actionsContainerSelector, parentActiveClass: 'more-actions-visible', containerClass: 'popup-container black'}\" class=\"action show-more\">more</button><ul class=\"context-menu menu more-actions\"></ul></li>"),$templateCache.put("scripts/directives/no-entities/no-entities.html",'<div ng-class="{search: isSearch(), &quot;all-folder&quot;: !selectedFolder, &quot;can-upload&quot;: canUpload, &quot;multiline-description&quot;: adapterType !== &quot;user-owned&quot; &amp;&amp; selectedFolder == allFolder}" class="no-entities {{&quot;no-&quot; + (selectedFolder.mediaType || settings.mediaType)}} {{adapterType}} {{selectedFolder.type}}"><div ng-if="!isSearch()" ng-include="\'scripts/directives/no-entities/no-items-loaded.html\'"></div><div ng-if="isSearch()" ng-include="\'scripts/directives/no-entities/\' + searchTemplate"></div></div>'),$templateCache.put("scripts/directives/no-entities/no-items-loaded.html",'<h3>{{ getHeader() }}</h3><div ng-switch="selectedFolder.type"><div ng-switch-when="siteMedia"><div class="description"><span ng-bind-html="&quot;no_items.text_siteMedia&quot; | unsafe : getDescription()"></span></div></div><div ng-switch-default="ng-switch-default"><div ng-if="canUpload" class="description"><span ng-bind-html="descriptionTranslationKey() | unsafe"></span><div ng-if="showDescriptionLink &amp;&amp; !settings.disableUpload" file-select="uploadFiles({files: files})" class="upload-link">&nbsp;<button>&nbsp;{{ \'uploader.upload\' | translate }}</button><input id="files-input" accept="*" bi-click="{eventName: &quot;noItems.uploadButton.click&quot;,data:{target:selectedFolder.id}}" bi-file-upload="change" multiple="true" name="file" type="file" title=""/></div></div><div ng-if="!canUpload &amp;&amp; getDescription().description" class="description"><span ng-bind-html="getDescription().description | unsafe"></span><button ng-if="getDescription().link" ng-click="changeState(getDescription().state)">&nbsp;{{ getDescription().link | translate }}</button></div></div></div>'),$templateCache.put("scripts/directives/no-entities/no-search-results.html",'\x3c!--h3--\x3e\x3c!--  span(ng-if=\'selectedFolder\')--\x3e\x3c!--    | {{ \'no_search_results_at_folder\' | translate : getSearchQuery() : selectedFolder.name }}--\x3e\x3c!--  span(ng-if=\'!selectedFolder\')--\x3e\x3c!--    | {{ \'no_search_results\' | translate : getSearchQuery() }}--\x3e<div ng-switch="selectedFolder == allFolder"><div ng-switch-when="false"><h3>{{ \'no_search_results.cant_find_at_folder\' | translate : getSearchQuery() : selectedFolder.name }}</h3><div ng-if="allFolder" class="description">{{ \'no_search_results.try_search_at_all\' | translate }}&nbsp;<button ng-click="selectFolder({folder: allFolder})">{{ allFolder.name }}</button></div><div ng-if="!allFolder" class="description">{{ \'no_search_results.use_different_term\' | translate }}</div></div><div ng-switch-when="true"><h3><span ng-bind-html="\'no_search_results.cant_find_at_all\' | unsafe : getSearchQuery()"></span></h3><div class="description"><div class="item">{{ \'no_search_results.check_spelling\' | translate }}</div><div class="item">{{ \'no_search_results.use_different_keywords\' | translate }}</div></div></div></div>'),$templateCache.put("scripts/directives/no-entities/no-user-owned-search-results.html","\x3c!--h3--\x3e\x3c!--  span(ng-if='selectedFolder')--\x3e\x3c!--    | {{ 'no_search_results_at_folder' | translate : getSearchQuery() : selectedFolder.name }}--\x3e\x3c!--  span(ng-if='!selectedFolder')--\x3e\x3c!--    | {{ 'no_search_results' | translate : getSearchQuery() }}--\x3e<div ng-switch=\"selectedFolder == allFolder\"><div ng-switch-when=\"false\"><h3>{{ 'no_search_results.user_owned.cant_find_at_folder' | translate : getSearchQuery() : selectedFolder.name }}</h3><div ng-if=\"allFolder\" class=\"description\">{{ 'no_search_results.user_owned.try_search_at_all' | translate }}&nbsp;<button ng-click=\"selectFolder({folder: allFolder})\">{{ allFolder.name }}</button></div><div ng-if=\"!allFolder\" class=\"description\">{{ 'no_search_results.user_owned.use_different_term' | translate }}</div></div><div ng-switch-when=\"true\"><h3>{{ 'no_search_results.user_owned.cant_find_at_all' | translate : getSearchQuery() }}</h3><div class=\"description\">{{ 'no_search_results.user_owned.use_different_term' | translate }}</div></div></div>"),$templateCache.put("scripts/directives/preview/popup-content.html",'<div ng-class="[adapterName, item.mediaType]" class="popup-content item-preview"><div ng-style="videoHeight" class="cut"><img ng-show="item.can.showImagePreview() &amp;&amp; !item.can.showSvgInlinePreview()" ng-class="item.mediaType" ng-src="{{item.previewUrl}}"/><div ng-if="item.can.showVideoPreview()" ng-class="item.mediaType"><video ng-attr-poster="{{item.previewUrl}}" preload="none" autoplay="autoplay" loop="loop" muted="muted" oncontextmenu="return false;"><source ng-repeat="videoSource in videoSources" ng-src="{{videoSource}}"/></video></div><div ng-if="item.can.showExternalVideoPreview()" ng-class="item.mediaType"><iframe type="text/html" ng-src="{{iframeSrc}}" frameborder="0" volume="0" allowfullscreen="allowfullscreen"></iframe></div><div ng-if="item.can.showSvgInlinePreview()" ng-class="item.mediaType" inlinesvg="{src: &quot;{{item.previewUrl}}&quot;}"></div></div><div class="image-data-labels"><p class="name"><span ng-show="item.name" class="label">{{\'item_preview_label.name\' | translate}}</span></p><p ng-show="item.width" class="size"><span class="label">{{\'item_preview_label.size\' | translate}}</span></p><p ng-show="showFolderName &amp;&amp; folderName" class="folder-name"><span class="label">{{\'item_preview_label.folder_name\' | translate}}</span></p><p ng-show="item.isInSiteMedia" class="folder-name"><span class="label">{{\'item_preview_label.uploaded_by\' | translate}}</span></p><p ng-show="item.labels" class="folder-name"><span class="label">{{\'item_preview_label.labels\' | translate}}</span></p></div><div class="image-data-values"><p class="name"><span ng-show="item.name">{{item.name}}</span></p><p ng-show="item.width" class="size"><span>{{item.width}}x{{item.height}}</span></p><p ng-show="showFolderName &amp;&amp; folderName" class="folder-name"><span>{{folderName}}</span></p><p ng-show="item.isInSiteMedia" class="folder-name"><span>{{uploadedBy(item) | translate}} ({{uploadedTime(item)}})</span></p><p ng-show="item.labels" class="folder-name"><span>{{item.labels.join(\', \')}}</span></p></div></div>'),$templateCache.put("scripts/directives/preview/preview.html",'<div popup="{event: &quot;mouseover&quot;, activeClass: &quot;active&quot;, containerClass: &quot;popup-container item-preview-container&quot;, parentSelector: (parentSelector || &quot;li.item&quot;), template: &quot;scripts/directives/preview/popup-content.html&quot;}" class="action item-preview"></div>'),$templateCache.put("scripts/directives/renamable-name/renamable-name.html",'<div class="name"><div folder="entity" folder-long-name="entity" redraw-on-change="redrawOnChange" ng-bind="entity.name.toString()" ng-hide="renameCtrl.isVisible(entity)" class="name-inner"></div><input ng-show="renameCtrl.isVisible(entity)" focus-me="renameCtrl.isVisible(entity)" maxlength="256" ng-blur="renameCtrl.runOrHide(entity, renameCtrl.newName)" ng-model="renameCtrl.newName" on-enter="renameCtrl.run(entity, renameCtrl.newName);" on-esc="renameCtrl.hide()" deny-bubbling="dblclick"/></div>'),$templateCache.put("scripts/directives/spinner/spinner.html",'<svg width="90px" height="90px" viewbox="0 0 66 66" xmlns="http://www.w3.org/2000/svg" class="spinner"><circle fill="none" stroke-width="2" stroke-linecap="round" cx="33" cy="33" r="30" class="path"></circle></svg>'),$templateCache.put("scripts/directives/upload-button/upload-button.html",'<div file-select="uploadFiles({files: files})" ng-show="canUpload" class="upload-button"><input id="files-input" accept="*" bi-click="{eventName: &quot;uploadButton.click&quot;, data: {}}" bi-file-upload="change" multiple="true" name="file" type="file" title=""/><button>{{ \'uploader.upload\' | translate}}</button></div>'),$templateCache.put("scripts/pages/_base/base.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div drag-highlight="" can-upload="$upload.adapter.can.item.upload()" items-grid-resize="$layouts.selected.itemWidth" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow() &amp;&amp; !settings.disableUpload" bi-file-upload="change"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div class="sidebar"><div ng-include="\'scripts/pages/_partials/folders.html\'" class="sidebar-inner"></div></div><div bi-file-upload="drop" drop-files="$upload.addFiles(files)" entities="$nestedEntities.list" can-upload="$upload.adapter.can.item.upload()" ng-class="$layouts.selected.id" reset-scroll-on="$folders.selectedFolder" select-all="" delete-by-key="" when-scrolled-to-bottom="$nestedEntities.more()" droppable="$nestedEntities.moveSelectedToFolder(getSelectedFolder())" can-drop-entities="getSelectedFolder().can.moveItemIn()" class="entities-wrapper"><breadcrumbs list="selectedFoldersPath" action="selectFolderOrNested(folder)" ng-if="settings.hasSubfolders || $nestedEntities.list.length"></breadcrumbs><no-entities ng-class="{\'no-entities-placeholder\':!$searchQuery.query}" selected-folder="getSelectedFolder()" search-query="$searchQuery.query" upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="getSelectedFolder().can.uploadIn()" ng-show="!$nestedEntities.isLoading &amp;&amp; $nestedEntities.list.length == 0" select-folder="$folders.selectFolder(folder)" all-folder="getAllFolder()" adapter-type="user-owned"></no-entities><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><div ng-class="{processing: $nestedEntities.$createFolder.isProcessing(true)}" ng-show="$nestedEntities.$createFolder.isVisible(true) || $nestedEntities.$createFolder.isProcessing(true)" class="add-subfolder-input">Subfolder name:<input focus-me="$nestedEntities.$createFolder.isVisible(true)" maxlength="256" ng-blur="$nestedEntities.$createFolder.hide()" ng-model="$nestedEntities.$createFolder.newName" on-enter="$nestedEntities.$createFolder.run($nestedEntities.$createFolder.newName)" on-esc="$nestedEntities.$createFolder.hide()"/></div><entities-grid adapter-name="adapter.name" folder-name-by-id="getFolderNameById(id)" entities="$nestedEntities.list" reset-scroll="getSelectedFolder()" double-click="$nestedEntities.isFolder(entity) ? $nestedEntities.selectFolder(entity) : selectAndSubmitItem(entity)" selected-layout-id="$layouts.selected.id" selected-folder="getSelectedFolder()" move-selected-to-folder="$nestedEntities.moveSelectedToFolder(folder)" rename-ctrl="$nestedEntities.$rename" can-select-multiple="true" remove="$remove" on-all-thumbnails-loaded="measureImagesLoadSpeed()" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),$templateCache.put("scripts/pages/_partials/confirmation.html",'<div class="header">{{confirmTitle}}</div><div ng-bind-html="confirmMessage" class="text"></div><div class="buttons"><div class="cancel"><button ng-click="closeThisDialog()">{{confirmNo}}</button></div><div class="confirm"><button ng-click="confirm(); closeThisDialog();" autofocus="autofocus">{{confirmYes}}</button></div></div>'),$templateCache.put("scripts/pages/_partials/folders.html",'<div><div ng-class="{\'offset-bottom\': adapter.can.folder.create()}" ng-if="$folders.list.length" droppable="$folders.moveSelectedToFolder(getUnsorted())" can-drop-entities="getUnsorted().can.moveItemIn()" class="folders"><ul><li ng-repeat="folder in $folders.list | orderBy:$folders.sortOrder" bi-click="{eventName: \'folderSelect.click\', data: { target: folder.id }}" ng-class="{current: $folders.selectedFolder.id == folder.id, processing: folder._isProcessing, renaming: $folders.$rename.isVisible(folder), \'virtual-folder\': folder.isVirtual}" ng-click="$folders.selectFolder(folder);filter.parent_folder_id = folder.folder_id" droppable="$folders.moveSelectedToFolder(folder)" can-drop-entities="folder.can.moveItemIn()" draggable="folder" select-entity="folder" can-drag="folder.can.move()" bi-file-upload="drop" drop-files="$upload.addFiles(files, folder)" drag-highlight="" can-upload="$upload.adapter.can.item.upload()" data-id="{{folder.id}}" class="{{settings.mediaType}}{{folder.type ? &quot; &quot; + folder.type : &quot;&quot;}}"><renamable-name entity="folder" rename-ctrl="$folders.$rename"></renamable-name><folder-actions folder="folder" show-renaming="$folders.$rename.show(folder)" remove="$remove"></folder-actions><div ng-click="$event.stopPropagation()" ng-if="isSiteMediaFolder(folder)" wix-tooltip="{{siteMediaTooltip}}" tooltip-class="site-media-folder-tooltip" placement="right" append-to-body="true" class="site-media-folder-tooltip-icon"></div></li><li ng-class="{processing: $folders.$createFolder.isProcessing(true)}" ng-show="$folders.$createFolder.isVisible(true) || $folders.$createFolder.isProcessing(true)" class="add-folder-input"><input focus-me="$folders.$createFolder.isVisible(true)" maxlength="256" ng-blur="$folders.$createFolder.runOrHide(null, $folders.$createFolder.newName)" ng-model="$folders.$createFolder.newName" on-enter="$folders.$createFolder.run($folders.$createFolder.newName)" on-esc="$folders.$createFolder.hide()"/></li></ul></div><button ng-show="adapter.can.folder.create()" bi-click="{eventName: \'newFolderButton.click\', data: {}}" ng-click="$folders.$createFolder.show(true)" class="add-folder">{{\'private_media.create_folder\' | translate}}</button></div>'),$templateCache.put("scripts/pages/_partials/footer.html",'<div class="submit"><button bi-click="{eventName: \'chooseButton.click\', data: {}}" ng-class="{disabled: !canSubmitItems()}" ng-click="submitItems()" ng-show="settings.submitItems" title="{{submitItemsTooltip()}}">{{footerSubmitTranslationKey | translate}}</button></div><div ng-if="$upload.getFilesQueue().length" ng-class="{\'has-failed\': $upload.hasFailedFiles(), \'in-progress\': $upload.hasInProgress(), maximize: $upload.popupIsVisible, minimize: !$upload.popupIsVisible}" ng-click="$upload.showPopup()" class="upload-status"><div class="title">{{$upload.hasInProgress() ? \'uploader.uploading\' : \'uploader.uploaded\' | translate}}&nbsp;<span class="numbers">({{$upload.succeededFilesCount()}}/{{$upload.allFilesCount()}} <span ng-switch="$upload.allFilesCount() &gt; 1"><span ng-switch-when="true">{{\'uploader.files\' | translate}})</span><span ng-switch-when="false">{{\'uploader.file\' | translate}})</span></span></span></div><div ng-show="$upload.hasInProgress()" class="progress-bar"><div ng-style="{\'width\': $upload.totalProgressPercent + \'%\'}" class="progress"></div></div><div ng-show="$upload.failedFilesCount() &gt; 0" class="fails"><span ng-if="$upload.failedFilesCount() - $upload.cancelledFilesCount() &gt; 0" class="failed-count">{{$upload.failedFilesCount() - $upload.cancelledFilesCount()}} <span ng-switch="$upload.failedFilesCount() - $upload.cancelledFilesCount() &gt; 1"><span ng-switch-when="true">{{\'uploader.errors\' | translate}}</span><span ng-switch-when="false">{{\'uploader.error\' | translate}}</span></span></span></div><button ng-click="$upload.showPopup()" class="show-upload-popup">{{\'uploader.footer.view_details\' | translate}}</button></div><div ng-show="selectedEntitiesCount()" ng-switch="selectedEntitiesCount() &gt; 1" class="selected-items-size"><span ng-switch-when="true">{{\'many_selected_items\' | translate:selectedEntitiesCount()}}</span><span ng-switch-when="false">{{\'one_selected_item\' | translate:selectedEntitiesCount()}}</span></div>'),$templateCache.put("scripts/pages/_partials/group-actions.html",'<ul><li ng-show="settings.hasSubfolders &amp;&amp; adapter.can.folder.create() &amp;&amp; $folders.selectedFolder.id &amp;&amp; $folders.selectedFolder.parentId"><div class="add-subfolder"><button ng-click="$nestedEntities.$createFolder.show(true)">{{\'private_media.create_subfolder\' | translate}}</button></div></li><li ng-show="isSomeRemovable() &amp;&amp; adapter.can.items.remove() &amp;&amp; selectedEntitiesCount() &amp;&amp; !$nestedEntities.isLoading &amp;&amp; $nestedEntities.list.length" class="remove-item"><div class="delete"><button ng-click="$remove.selected($nestedEntities, selectedEntities)">{{deleteButtonText() | translate}}</button></div></li><li ng-show="$nestedEntities.$orientation" class="orientation-switch-wrapper"><button ng-class="{ current : $nestedEntities.$orientation.selected == orientation }" ng-click="$nestedEntities.$orientation.select(orientation)" ng-repeat="orientation in $nestedEntities.$orientation.list" title="{{\'orientation.\' + orientation.name | translate}}" class="action orientation {{orientation.name}}"></button></li><li ng-show="$nestedEntities.sortOrder"><div popup="{containerClass: \'popup-container dropdown\', contentClass:\'sort-options\',  align: \'bottom center\', offsetTop: 22, centeredTip: true}" class="action change-sort-order">{{\'sort_order.title\' | translate}} {{$nestedEntities.sortOrder.selected.name}}</div><div class="sort-options menu centered-tip"><div ng-repeat="sortOption in $nestedEntities.sortOrder.list"><button ng-class="{current: sortOption == $nestedEntities.sortOrder.selected}" ng-click="$nestedEntities.sortOrder.select(sortOption)">{{sortOption.name}}</button></div></div></li><li ng-show="!isSelectedSiteMediaFolder() &amp;&amp; adapter.items.search" class="search"><form><input ng-class="{fail: !$nestedEntities.isLoading &amp;&amp; $nestedEntities.list.length == 0 &amp;&amp; $searchQuery.query &amp;&amp; $searchQuery.currentQuery == $searchQuery.query}" ng-model="$searchQuery.currentQuery" on-enter="$searchQuery.query = $searchQuery.currentQuery; $nestedEntities.load()" placeholder="{{\'search\' | translate}}" type="text"/><input ng-click="$searchQuery.currentQuery = \'\'; $searchQuery.query = \'\'; $nestedEntities.load()" ng-show="$searchQuery.currentQuery &amp;&amp; $searchQuery.currentQuery == $searchQuery.query" type="reset" value="x"/><input ng-click="$searchQuery.query = $searchQuery.currentQuery; $nestedEntities.load()" ng-show="$searchQuery.currentQuery != $searchQuery.query" type="submit" value="→"/></form></li><li ng-show="$layouts &amp;&amp; !$services.isAllDisconnected()"><div popup="{containerClass: \'popup-container dropdown\', contentClass: \'layout-options\', align: \'bottom center\', offsetTop: 22, centeredTip: true}" class="action switch-grid"><button ng-class="$layouts.selected.id" class="selected">switch</button><div class="layout-options menu"><ul><li ng-repeat="layout in $layouts.list"><button ng-class="{current: $layouts.selected.id == layout.id}" ng-click="$layouts.select(layout)" class="{{layout.id}}">{{layout.name}}</button></li></ul></div></div></li></ul>'),$templateCache.put("scripts/pages/_partials/import.html",'<div ng-show="isImporting" class="import"><div class="loading"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>{{ importingCount == 1 ? \'external_media.importing_single.header\' : \'external_media.importing.header\' | translate}}</div><div ng-style="{width: (getImportingProgress() * 100) + \'%\'}" class="progress"></div></div>'),$templateCache.put("scripts/pages/_partials/loaders.html",'<div ng-if="$folders.isLoading" class="loading folders"><spinner></spinner></div><div ng-if="($folders.selectedFolder || !$folders) &amp;&amp; !$nestedEntities.list.length &amp;&amp; $nestedEntities.isLoading" class="loading items"><spinner on-destroy="trackAppLoaded()"></spinner></div><div ng-if="($folders.selectedFolder || !$folders) &amp;&amp; $nestedEntities.list.length &amp;&amp; $nestedEntities.isLoading" class="loading items more"><spinner></spinner></div>'),$templateCache.put("scripts/pages/_partials/notifications.html",'<ul ng-show="$notifications.list.length &gt; 0"><li ng-repeat="notification in $notifications.list track by notification.id" class="{{notification.type}}"><span>{{notification.message}}</span><button ng-click="$notifications.expire(notification)" class="expire-notification">×</button></li></ul>'),$templateCache.put("scripts/pages/_partials/tabs.html",'<ul ng-show="settings.showTabs"><li><button bi-click="{eventName: \'tabSelect.click\', data: {target: tabId}}" ng-class="{active: isActiveTab(tabs[tabId])}" ng-repeat="tabId in settings.tabsList" ng-show="tabs[tabId].canShow()" ui-sref="{{tabs[tabId].state}}"><span ng-if="tabs[tabId].translationKey">{{tabs[tabId].translationKey | translate}}</span><span ng-if="tabs[tabId].getTitle()">{{tabs[tabId].getTitle()}}</span></button></li></ul>'),$templateCache.put("scripts/pages/_partials/upload-message.html",'<div ng-show="!!$upload &amp;&amp; descriptionTranslationKey" title="{{ descriptionTranslationKey | translate : $upload.getFileSizeLimit().size : $upload.getFileSizeLimit().sizeType }}" class="upload-message">{{ descriptionTranslationKey | translate : $upload.getFileSizeLimit().size : $upload.getFileSizeLimit().sizeType }}</div>'),
$templateCache.put("scripts/pages/_partials/upload-popup.html",'<div ng-show="$upload.popupIsVisible" ng-click="$upload.hidePopup()" class="inner-popup-underlay"></div><div id="uploader" ng-if="$upload.getFilesQueue().length &amp;&amp; ($upload.isMinimization || $upload.popupIsVisible)" bi-file-upload="drop" drop-files="$upload.addFiles(files, adapter.name === &quot;private&quot; ? $folders.selectedFolder : null)" can-upload="$upload.adapter.can.item.upload()" ng-class="{&quot;has-failed&quot;: $upload.hasFailedFiles(), &quot;in-progress&quot;: $upload.hasInProgress(), minimize: $upload.isMinimization}" class="inner-popup"><div class="popup-header"><h2>{{$upload.hasInProgress() ? \'uploader.uploading\' : \'uploader.uploaded\' | translate}}<span class="numbers">&nbsp;({{$upload.succeededFilesCount()}}/{{$upload.allFilesCount()}} <span ng-switch="$upload.allFilesCount() &gt; 1"><span ng-switch-when="true">{{\'uploader.files\' | translate}})</span><span ng-switch-when="false">{{\'uploader.file\' | translate}})</span></span></span><span ng-if="$upload.failedFilesCount() - $upload.cancelledFilesCount() &gt; 0" class="fails">&nbsp;-&nbsp;<span class="failed-count">{{$upload.failedFilesCount() - $upload.cancelledFilesCount()}} <span ng-switch="$upload.failedFilesCount() - $upload.cancelledFilesCount() &gt; 1"><span ng-switch-when="true">{{\'uploader.errors\' | translate}}</span><span ng-switch-when="false">{{\'uploader.error\' | translate}}</span></span></span></span><div ng-click="$upload.hidePopup()" class="close">×</div></h2><div ng-show="$upload.hasInProgress()" class="progress-bar"><div ng-style="{&quot;width&quot;: $upload.totalProgressPercent + &quot;%&quot;}" class="progress"></div></div><div class="message">{{\'uploader.popup_message\' | translate}}</div></div><div class="popup-content"><div class="uploads-list"><ul><li ng-class="{cancelled: $upload.isCancelled(fileToUpload)}" ng-repeat="fileToUpload in $upload.getFilesQueue()" class="{{fileToUpload.status}}"><div ng-click="fileToUpload.abort()" ng-show="$upload.canCancelUpload(fileToUpload) &amp;&amp; fileToUpload.canAbort()" class="cancel-file">×</div><div ng-show="fileToUpload.status === &quot;succeeded&quot;" class="success">&check;</div><div ng-click="fileToUpload.signUpForRetry()" ng-show="!$upload.isInProgress(fileToUpload) &amp;&amp; fileToUpload.canRetry() &amp;&amp; !$upload.isFolder(fileToUpload)" class="retry">&nbsp;{{\'uploader.retry\' | translate}}</div><div thumb="fileToUpload.source.file" media-type="fileToUpload.source.mediaType" class="item-preview {{fileToUpload.source.mediaType}}"><div ng-show="fileToUpload.status === &quot;uploading&quot;" class="progress-number">{{ (fileToUpload.bytesLoaded/fileToUpload.source.file.size) * 100 | number : 0 }}%</div><div ng-show="fileToUpload.status === &quot;processing&quot;" class="progress-processing"></div><div ng-show="$upload.isInProgress(fileToUpload) &amp;&amp; !$upload.isWaiting(fileToUpload)" ng-style="{width: ((fileToUpload.bytesLoaded/fileToUpload.source.file.size) * 100 | number : 0) + &quot;%&quot;}" class="progress"></div></div><div class="item-wrapper"><div class="item-inner"><div title="{{fileToUpload.source.file.name.length &gt; 40 ? fileToUpload.source.file.name : &quot;&quot;}} " class="item-name">{{fileToUpload.source.file.name}}</div><div ng-switch="fileToUpload.status === &quot;failed&quot;" class="item-description"><div ng-switch-when="false" class="item-size"><span ng-bind="($upload.getReadableFileSize(fileToUpload.bytesLoaded).size | number : 0) + $upload.getReadableFileSize(fileToUpload.bytesLoaded).sizeType"></span></div><div ng-switch-when="false" ng-show="fileToUpload.source.folderName.length &lt; 30" class="item-folder"><span ng-show="$upload.isInProgress(fileToUpload)">&nbsp;{{\'uploader.of\' | translate}}&nbsp;<span ng-bind="($upload.getReadableFileSize(fileToUpload.source.file.size).size | number : 0) + $upload.getReadableFileSize(fileToUpload.source.file.size).sizeType"></span></span>&nbsp;<span class="item-folder-description">{{\'uploader.uploaded_to_folder\' | translate : fileToUpload.source.folderName}}</span></div><div ng-switch-when="false" ng-show="fileToUpload.source.folderName.length &gt; 30" title="{{&quot;uploader.uploaded_to_folder&quot; | translate : fileToUpload.source.folderName}}" class="item-folder"><span ng-show="$upload.isInProgress(fileToUpload)">&nbsp;{{\'uploader.of\' | translate}}&nbsp;<span ng-bind="($upload.getReadableFileSize(fileToUpload.source.file.size).size | number : 0) + $upload.getReadableFileSize(fileToUpload.source.file.size).sizeType"></span></span>&nbsp;</div><div ng-switch-when="true" class="item-folder"><span title="{{$upload.translateError(fileToUpload)}}" class="item-folder-description">{{$upload.translateError(fileToUpload)}}</span></div></div></div></div></li></ul></div></div><div class="popup-footer"><div ng-click="$upload.hidePopup()" class="close">{{\'uploader.hide\' | translate}}</div><div ng-click="$upload.confirmAbortAll()" ng-show="$upload.hasInProgress() &amp;&amp; $upload.hasAbortable()" class="cancel-upload">{{\'uploader.cancel_all\' | translate}}</div><div ng-click="$upload.retryAll()" ng-show="$upload.hasRetryable() &amp;&amp; !$upload.hasInProgress()" class="retry-all">{{\'uploader.retry_all\' | translate}}</div></div></div>'),$templateCache.put("scripts/pages/_partials/window-header.html",'<h1>{{\'header\' | translate}}<button bi-click="{ eventName: \'closeButton.click\', data: {} }" ng-click="closeWindow()" class="close">×</button><button bi-click="{ eventName: \'helpButton.click\', data: {} }" ng-click="$help.showPopup()" class="help">| ?</button></h1><help-popup></help-popup>'),$templateCache.put("scripts/pages/app.html",'<link ng-href="{{settings.cssUrl}}" ng-if="settings.cssUrl" rel="stylesheet"/><div ui-view="" class="window-wrapper {{settings.windowStyle}}{{settings.showTabs ? \'\' : \' without-tabs\'}}"></div>'),$templateCache.put("scripts/pages/custom/custom.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div drag-highlight="" can-upload="$upload.adapter.can.item.upload()" items-grid-resize="$layouts.selected.itemWidth" class="content"><div class="content-top custom-tab-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow() &amp;&amp; !settings.disableUpload" bi-file-upload="change"></upload-button></div><div class="custom-tab-content-wrapper"><div class="custom-tab-content"><div ng-repeat="section in sections" ng-if="showSection(section)" class="custom-tab-section"><div class="custom-tab-section-header"><div class="custom-tab-section-title">{{section.title}}</div></div><div class="custom-tab-section-content-wrapper"><div ng-repeat="item in section.data track by item.id" ng-click="toggle(item)" ng-dblclick="selectAndSubmitItem(item)" ng-selected="isSelected(item)" class="content-item"><div class="item-name">{{item.name}}</div><div class="items-actions"><div class="actions"><preview item="item" parent-selector=".content-item"></preview></div></div><img ng-src="{{item.thumbnailUrl}}" width="128" height="128"/></div><a ui-sref="app.{{section.action.url.split(&quot;/&quot;)[0]}}" ng-if="showAction(section)" class="custom-tab-section-action"><div class="content-item custom-tab-section-action">{{section.action.title}}</div></a></div></div></div><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div></div></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),$templateCache.put("scripts/pages/empty/empty.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow() &amp;&amp; !settings.disableUpload" bi-file-upload="change"></upload-button></div></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),$templateCache.put("scripts/pages/external-search/_partials/intro.html",'<div ng-hide="$searchQuery.query" class="start-work"><h3>{{ \'external_search.start_work.header\' | translate }}</h3><div class="description">{{ \'external_search.start_work.description\' | translate }}</div><div ng-class="&quot;search-&quot; + settings.mediaType"></div></div>'),$templateCache.put("scripts/pages/external-search/_partials/services-list.html",'<div class="folders"><ul><li ng-class="{current: $services.selected == service}" ng-repeat="service in $services.list"><button ng-class="service.id" ng-click="$services.select(service)" class="name service">{{service.name}}</button></li></ul></div>'),$templateCache.put("scripts/pages/external-search/external-search.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div items-grid-resize="$layouts.selected.itemWidth + $services.selected.id" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files)" can-upload="tabs.private.canShow() &amp;&amp; !settings.disableUpload" bi-file-upload="change"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div class="sidebar"><div ng-include="\'scripts/pages/external-search/_partials/services-list.html\'" class="sidebar-inner"></div></div><div bi-file-upload="drop" drop-files="$upload.addFiles(files)" can-upload="$upload.adapter.can.item.upload()" ng-class="$layouts.selected.id" when-scrolled-to-bottom="$nestedEntities.more()" class="entities-wrapper"><breadcrumbs list="[$services.selected]"></breadcrumbs><no-entities search-query="$searchQuery.query" upload-files="$upload.addFiles(files)" can-upload="$upload.adapter.can.item.upload()" ng-show="$nestedEntities.list.length == 0"></no-entities><div ng-include="\'scripts/pages/external-search/_partials/intro.html\'"></div><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><entities-grid adapter-name="adapter.name" entities="$nestedEntities.list" ng-if="$searchQuery.query" double-click="selectAndSubmitItem(entity)" selected-layout-id="$layouts.selected.id" can-select-multiple="true" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div></div><div ng-include="\'scripts/pages/_partials/import.html\'"></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),$templateCache.put("scripts/pages/external/_partials/connect-service.html",'<div class="services-intro"><div ng-class="settings.mediaType"></div><h2>{{\'external_media.no_services.connect\' | translate : $services.selected.name}}</h2><h3>{{\'external_media.no_services.service_header2\' | translate : $services.selected.name}}</h3><button bi-click="{eventName: \'socialService.connectButton.click\', data: { target: $services.selected.id}}" ng-click="$services.connect($services.selected)" class="connect-service {{$services.selected.translationKey || $services.selected.id}}">{{\'external_media.no_services.connect\' | translate : $services.selected.name}}</button></div>'),$templateCache.put("scripts/pages/external/_partials/intro.html",'<div class="services-intro-wrapper"><div class="services-intro large"><h2>{{\'external_media.no_services.header1\' | translate}}</h2><h3>{{\'external_media.no_services.header2\' | translate}}</h3><div ng-class="{\'one-child\':$services.disconnectedList().length == 1}" class="services"><button ng-repeat="service in $services.disconnectedList()" bi-click="{eventName: \'socialService.connectButton.click\', data: { target: service.id}}" ng-click="$services.connect(service)" class="{{service.translationKey || service.id}}">{{service.name}}</button></div></div></div>'),$templateCache.put("scripts/pages/external/_partials/services.html",'<div class="folders"><ul class="services"><li ng-class="{current: $services.selected.id == service.id}" ng-repeat="service in $services.list"><button ng-click="$services.select(service)" class="name service {{service.translationKey}}">{{service.name}}</button><div popup="{contentClass: \'context-menu\', offsetLeft: 10, offsetTop: 18}" class="actions"><div ng-switch="$services.isConnected(service)" class="context-menu context-menu menu"><button ng-click="$services.disconnect(service)" ng-switch-when="true" class="disconnect">{{"external_media.services_list.disconnect" | translate}}</button><button ng-click="$services.connect(service)" ng-switch-when="false" class="connect">{{"external_media.services_list.connect" | translate}}</button></div></div></li></ul></div>'),$templateCache.put("scripts/pages/external/external.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div>{{$services.selected.name}}<div items-grid-resize="$layouts.selected.itemWidth + $services.selected.id" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow() &amp;&amp; !settings.disableUpload" bi-file-upload="change"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div ng-hide="$services.isAllDisconnected()" class="sidebar"><div ng-include="\'scripts/pages/external/_partials/services.html\'" class="sidebar-inner"></div></div><div bi-file-upload="drop" drop-files="$upload.addFiles(files)" can-upload="$upload.adapter.can.item.upload()" ng-if="$services.selected &amp;&amp; !$services.isAllDisconnected()" ng-class="$layouts.selected.id" when-scrolled-to-bottom="getSelectedFolder() ? $nestedEntities.more() : null" select-all="" class="entities-wrapper"><breadcrumbs list="breadcrumbsList()" action="selectFolderOrService(folder)" ng-if="($services.selected &amp;&amp; $services.isConnected($services.selected)) || $folders.list.length"></breadcrumbs><div ng-class="&quot;no-&quot; + settings.mediaType" ng-show="$nestedEntities.list.length == 0 &amp;&amp; $services.isConnected($services.selected) &amp;&amp; !isLoading" class="no-entities"><h3>{{ \'no_social_items_in_folder\' | translate : getSelectedFolderOrServiceName() }}</h3></div><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><entities-grid ng-show="$services.isConnected($services.selected)" adapter-name="adapter.name" folder-name-by-id="$folders.nameById(id) || $nestedEntities.nameById(id)" entities="$nestedEntities.list" reset-scroll="getSelectedFolder()" click="$nestedEntities.isFolder(entity) ? $nestedEntities.selectFolder(entity) : &quot;&quot; " double-click="$nestedEntities.isFolder(entity) ? $nestedEntities.selectFolder(entity) : selectAndSubmitItem(entity)" selected-layout-id="$layouts.selected.id" selected-folder="getSelectedFolder()" move-selected-to-folder="$nestedEntities.moveSelectedToFolder(folder)" rename-ctrl="$nestedEntities.$rename" can-select-multiple="true" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div><div ng-if="!$services.isConnected($services.selected)" ng-include="\'scripts/pages/external/_partials/connect-service.html\'"></div></div><div ng-if="$services.isAllDisconnected()" ng-include="\'scripts/pages/external/_partials/intro.html\'"></div><div ng-include="\'scripts/pages/_partials/import.html\'"></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),$templateCache.put("scripts/pages/photo-stock/photo-stock.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div items-grid-resize="$layouts.selected.itemWidth" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow() &amp;&amp; !settings.disableUpload" bi-file-upload="change"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div ng-include="\'scripts/pages/public/_partials/parent-folders.html\'" class="parent-folders"></div><div class="sidebar"><div ng-include="\'scripts/pages/_partials/folders.html\'" class="sidebar-inner"></div></div><div bi-file-upload="drop" drop-files="$upload.addFiles(files)" can-upload="$upload.adapter.can.item.upload()" ng-class="$layouts.selected.id" reset-scroll-on="$folders.selectedFolder" when-scrolled-to-bottom="$nestedEntities.more()" class="entities-wrapper"><breadcrumbs list="[$folders.selectedFolder]" ng-if="$nestedEntities.list.length || settings.hasSubfolders"></breadcrumbs><no-entities selected-folder="$folders.selectedFolder" search-query="$searchQuery.query" upload-files="$upload.addFiles(files)" can-upload="adapter.can.items.upload()" ng-show="$nestedEntities.list.length == 0" all-folder="getAllFolder()" select-folder="$folders.selectFolder(folder)"></no-entities><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><entities-grid adapter-name="adapter.name" folder-name-by-id="$folders.nameById(id)" entities="$nestedEntities.list" reset-scroll="$folders.selectedFolder" select-and-submit-item="selectAndSubmitItem(item)" double-click="$nestedEntities.isFolder(entity) ? $nestedEntities.selectFolder(entity) : selectAndSubmitItem(entity)" selected-layout-id="$layouts.selected.id" selected-folder="$folders.selectedFolder" can-select-multiple="false" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),$templateCache.put("scripts/pages/platform/platform.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div drag-highlight="" can-upload="$upload.adapter.can.item.upload()" items-grid-resize="$layouts.selected.itemWidth" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.platform.canShow() &amp;&amp; !settings.disableUpload" bi-file-upload="change"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div class="sidebar"><div ng-include="\'scripts/pages/_partials/folders.html\'" class="sidebar-inner"></div></div><div bi-file-upload="drop" drop-files="$upload.addFiles(files, $folders.selectedFolder)" entities="$nestedEntities.list" can-upload="$upload.adapter.can.item.upload()" ng-class="$layouts.selected.id" reset-scroll-on="$folders.selectedFolder" select-all="" delete-by-key="" when-scrolled-to-bottom="$nestedEntities.more()" droppable="$nestedEntities.moveSelectedToFolder(getSelectedFolder())" can-drop-entities="getSelectedFolder().can.moveItemIn()" class="entities-wrapper"><breadcrumbs list="selectedFoldersPath" action="selectFolderOrNested(folder)" ng-if="settings.hasSubfolders || $nestedEntities.list.length"></breadcrumbs><no-entities ng-class="{\'no-entities-placeholder\':!$searchQuery.query}" selected-folder="getSelectedFolder()" search-query="$searchQuery.query" upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="getSelectedFolder().can.uploadIn()" ng-show="!$nestedEntities.isLoading &amp;&amp; $nestedEntities.list.length == 0" select-folder="$folders.selectFolder(folder)" all-folder="getAllFolder()" adapter-type="user-owned" show-description-link="showNoEntitiesDescriptionLink()"></no-entities><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><div ng-class="{processing: $nestedEntities.$createFolder.isProcessing(true)}" ng-show="$nestedEntities.$createFolder.isVisible(true) || $nestedEntities.$createFolder.isProcessing(true)" class="add-subfolder-input">Subfolder name:<input focus-me="$nestedEntities.$createFolder.isVisible(true)" maxlength="256" ng-blur="$nestedEntities.$createFolder.hide()" ng-model="$nestedEntities.$createFolder.newName" on-enter="$nestedEntities.$createFolder.run($nestedEntities.$createFolder.newName)" on-esc="$nestedEntities.$createFolder.hide()"/></div><entities-grid adapter-name="adapter.name" folder-name-by-id="getFolderNameById(id)" entities="$nestedEntities.list" reset-scroll="getSelectedFolder()" double-click="$nestedEntities.isFolder(entity) ? $nestedEntities.selectFolder(entity) : selectAndSubmitItem(entity)" selected-layout-id="$layouts.selected.id" selected-folder="getSelectedFolder()" move-selected-to-folder="$nestedEntities.moveSelectedToFolder(folder)" rename-ctrl="$nestedEntities.$rename" can-select-multiple="true" remove="$remove" on-all-thumbnails-loaded="measureImagesLoadSpeed()" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),$templateCache.put("scripts/pages/private/private.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div drag-highlight="" can-upload="$upload.adapter.can.item.upload()" items-grid-resize="$layouts.selected.itemWidth" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow() &amp;&amp; !settings.disableUpload" bi-file-upload="change"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div class="sidebar"><div ng-include="\'scripts/pages/_partials/folders.html\'" class="sidebar-inner"></div></div><div bi-file-upload="drop" drop-files="$upload.addFiles(files, $folders.selectedFolder)" entities="$nestedEntities.list" can-upload="$upload.adapter.can.item.upload()" ng-class="$layouts.selected.id" reset-scroll-on="$folders.selectedFolder" select-all="" delete-by-key="" when-scrolled-to-bottom="$nestedEntities.more()" droppable="$nestedEntities.moveSelectedToFolder(getSelectedFolder())" can-drop-entities="getSelectedFolder().can.moveItemIn()" class="entities-wrapper private"><breadcrumbs list="selectedFoldersPath" action="selectFolderOrNested(folder)" ng-if="settings.hasSubfolders || $nestedEntities.list.length"></breadcrumbs><no-entities ng-class="{\'no-entities-placeholder\':!$searchQuery.query}" selected-folder="getSelectedFolder()" search-query="$searchQuery.query" upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="getSelectedFolder().can.uploadIn()" ng-show="!$nestedEntities.isLoading &amp;&amp; $nestedEntities.list.length == 0" select-folder="$folders.selectFolder(folder)" all-folder="getAllFolder()" adapter-type="user-owned"></no-entities><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><div ng-class="{processing: $nestedEntities.$createFolder.isProcessing(true)}" ng-show="$nestedEntities.$createFolder.isVisible(true) || $nestedEntities.$createFolder.isProcessing(true)" class="add-subfolder-input">Subfolder name:<input focus-me="$nestedEntities.$createFolder.isVisible(true)" maxlength="256" ng-blur="$nestedEntities.$createFolder.hide()" ng-model="$nestedEntities.$createFolder.newName" on-enter="$nestedEntities.$createFolder.run($nestedEntities.$createFolder.newName)" on-esc="$nestedEntities.$createFolder.hide()"/></div><entities-grid adapter-name="adapter.name" folder-name-by-id="getFolderNameById(id)" entities="$nestedEntities.list" reset-scroll="getSelectedFolder()" double-click="$nestedEntities.isFolder(entity) ? $nestedEntities.selectFolder(entity) : selectAndSubmitItem(entity)" selected-layout-id="$layouts.selected.id" selected-folder="getSelectedFolder()" move-selected-to-folder="$nestedEntities.moveSelectedToFolder(folder)" rename-ctrl="$nestedEntities.$rename" can-select-multiple="true" remove="$remove" on-all-thumbnails-loaded="measureImagesLoadSpeed()" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),$templateCache.put("scripts/pages/public/_partials/parent-folders.html",'<ul><li ng-class="{current: $parentFolders.selectedFolder.id == folder.id}" data-id="{{folder.id}}" ng-repeat="folder in $parentFolders.list"><button ng-click="$parentFolders.selectFolder(folder)">{{folder.name}}</button></li></ul>'),$templateCache.put("scripts/pages/public/public.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div items-grid-resize="$layouts.selected.itemWidth" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow() &amp;&amp; !settings.disableUpload" bi-file-upload="change"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div ng-include="\'scripts/pages/public/_partials/parent-folders.html\'" class="parent-folders"></div><div class="sidebar"><div ng-include="\'scripts/pages/_partials/folders.html\'" class="sidebar-inner"></div></div><div bi-file-upload="drop" drop-files="$upload.addFiles(files)" can-upload="$upload.adapter.can.item.upload()" ng-class="$layouts.selected.id" reset-scroll-on="$folders.selectedFolder" when-scrolled-to-bottom="$nestedEntities.more()" class="entities-wrapper public"><breadcrumbs list="[$parentFolders.selectedFolder, $folders.selectedFolder]" action="$folders.selectFolder($folders.list[0])" ng-if="$nestedEntities.list.length || settings.hasSubfolders"></breadcrumbs><no-entities selected-folder="$folders.selectedFolder" search-query="$searchQuery.query" upload-files="$upload.addFiles(files)" can-upload="adapter.can.items.upload()" ng-show="$nestedEntities.list.length == 0" select-folder="$folders.selectFolder(folder)" all-folder="getAllFolder()"></no-entities><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><entities-grid adapter-name="adapter.name" folder-name-by-id="$folders.nameById(id)" entities="$nestedEntities.list" reset-scroll="$folders.selectedFolder" double-click="selectAndSubmitItem(entity)" selected-folder="$folders.selectedFolder" selected-layout-id="$layouts.selected.id" can-select-multiple="true" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),$templateCache.put("scripts/pages/shutter-stock-video/shutter-stock-video.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div items-grid-resize="$layouts.selected.itemWidth" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow() &amp;&amp; !settings.disableUpload" bi-file-upload="change"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div ng-include="\'scripts/pages/public/_partials/parent-folders.html\'" class="parent-folders"></div><div class="sidebar"><div ng-include="\'scripts/pages/_partials/folders.html\'" class="sidebar-inner"></div></div><div bi-file-upload="drop" drop-files="$upload.addFiles(files)" can-upload="$upload.adapter.can.item.upload()" ng-class="$layouts.selected.id" reset-scroll-on="$folders.selectedFolder" when-scrolled-to-bottom="$nestedEntities.more()" class="entities-wrapper"><breadcrumbs list="[$folders.selectedFolder]" ng-if="$nestedEntities.list.length || settings.hasSubfolders"></breadcrumbs><no-entities selected-folder="$folders.selectedFolder" search-query="$searchQuery.query" upload-files="$upload.addFiles(files)" can-upload="adapter.can.items.upload()" ng-show="$nestedEntities.list.length == 0" all-folder="getAllFolder()" select-folder="$folders.selectFolder(folder)"></no-entities><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><entities-grid adapter-name="adapter.name" folder-name-by-id="$folders.nameById(id)" entities="$nestedEntities.list" reset-scroll="$folders.selectedFolder" select-and-submit-item="selectAndSubmitItem(item)" double-click="$nestedEntities.isFolder(entity) ? $nestedEntities.selectFolder(entity) : selectAndSubmitItem(entity)" selected-layout-id="$layouts.selected.id" selected-folder="$folders.selectedFolder" can-select-multiple="false" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>'),
$templateCache.put("scripts/pages/shutter-stock/shutter-stock.html",'<div ng-include="\'scripts/pages/_partials/window-header.html\'" class="header"></div><div items-grid-resize="$layouts.selected.itemWidth" class="content"><div class="content-top"><div ng-include="\'scripts/pages/_partials/tabs.html\'" class="tabs"></div><upload-button upload-files="$upload.addFiles(files, getSelectedFolder())" can-upload="tabs.private.canShow() &amp;&amp; !settings.disableUpload" bi-file-upload="change"></upload-button><div ng-include="\'scripts/pages/_partials/group-actions.html\'" class="group-actions"></div><span ng-include="\'scripts/pages/_partials/upload-message.html\'"></span></div><div ng-include="\'scripts/pages/public/_partials/parent-folders.html\'" class="parent-folders"></div><div class="sidebar"><div ng-include="\'scripts/pages/_partials/folders.html\'" class="sidebar-inner"></div></div><div bi-file-upload="drop" drop-files="$upload.addFiles(files)" can-upload="$upload.adapter.can.item.upload()" ng-class="$layouts.selected.id" reset-scroll-on="$folders.selectedFolder" when-scrolled-to-bottom="$nestedEntities.more()" class="entities-wrapper"><breadcrumbs list="[$folders.selectedFolder]" ng-if="$nestedEntities.list.length || settings.hasSubfolders"></breadcrumbs><no-entities selected-folder="$folders.selectedFolder" search-query="$searchQuery.query" upload-files="$upload.addFiles(files)" can-upload="adapter.can.items.upload()" ng-show="$nestedEntities.list.length == 0" all-folder="getAllFolder()" select-folder="$folders.selectFolder(folder)"></no-entities><div ng-include="\'scripts/pages/_partials/notifications.html\'" class="notifications"></div><entities-grid adapter-name="adapter.name" folder-name-by-id="$folders.nameById(id)" entities="$nestedEntities.list" reset-scroll="$folders.selectedFolder" select-and-submit-item="selectAndSubmitItem(item)" double-click="$nestedEntities.isFolder(entity) ? $nestedEntities.selectFolder(entity) : selectAndSubmitItem(entity)" selected-layout-id="$layouts.selected.id" selected-folder="$folders.selectedFolder" can-select-multiple="false" class="entities-grid"></entities-grid><div ng-include="\'scripts/pages/_partials/loaders.html\'" class="loaders"></div></div></div><div ng-include="\'scripts/pages/_partials/upload-popup.html\'" class="uploader"></div><div ng-include="\'scripts/pages/_partials/footer.html\'" class="footer"></div>')}]),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.tooltip","ui.bootstrap.position","ui.bootstrap.bindHtml"]),angular.module("ui.bootstrap.tpls",["template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html"]),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function snake_case(name){var regexp=/[A-Z]/g;return name.replace(regexp,function(letter,pos){return(pos?"-":"")+letter.toLowerCase()})}var defaultOptions={placement:"top",animation:!0,popupDelay:0},triggerMap={mouseenter:"mouseleave",click:"click",focus:"blur"},globalOptions={};this.options=function(value){angular.extend(globalOptions,value)},this.setTriggers=function(triggers){angular.extend(triggerMap,triggers)},this.$get=["$window","$compile","$timeout","$document","$position","$interpolate",function($window,$compile,$timeout,$document,$position,$interpolate){return function(type,prefix,defaultTriggerShow){function getTriggers(trigger){var show=trigger||options.trigger||defaultTriggerShow;return{show:show,hide:triggerMap[show]||show}}var options=angular.extend({},defaultOptions,globalOptions),directiveName=snake_case(type),startSym=$interpolate.startSymbol(),endSym=$interpolate.endSymbol(),template="<div "+directiveName+'-popup title="'+startSym+"title"+endSym+'" content="'+startSym+"content"+endSym+'" placement="'+startSym+"placement"+endSym+'" animation="animation" is-open="isOpen"></div>';return{restrict:"EA",compile:function(tElem,tAttrs){var tooltipLinker=$compile(template);return function(scope,element,attrs){function toggleTooltipBind(){ttScope.isOpen?hideTooltipBind():showTooltipBind()}function showTooltipBind(){hasEnableExp&&!scope.$eval(attrs[prefix+"Enable"])||(prepareTooltip(),ttScope.popupDelay?popupTimeout||(popupTimeout=$timeout(show,ttScope.popupDelay,!1),popupTimeout.then(function(reposition){reposition()})):show()())}function hideTooltipBind(){scope.$apply(function(){hide()})}function show(){return popupTimeout=null,transitionTimeout&&($timeout.cancel(transitionTimeout),transitionTimeout=null),ttScope.content?(createTooltip(),tooltip.css({top:0,left:0,display:"block"}),ttScope.$digest(),positionTooltip(),ttScope.isOpen=!0,ttScope.$digest(),positionTooltip):angular.noop}function hide(){ttScope.isOpen=!1,$timeout.cancel(popupTimeout),popupTimeout=null,ttScope.animation?transitionTimeout||(transitionTimeout=$timeout(removeTooltip,500)):removeTooltip()}function createTooltip(){tooltip&&removeTooltip(),tooltipLinkedScope=ttScope.$new(),tooltip=tooltipLinker(tooltipLinkedScope,function(tooltip){appendToBody?$document.find("body").append(tooltip):element.after(tooltip)})}function removeTooltip(){transitionTimeout=null,tooltip&&(tooltip.remove(),tooltip=null),tooltipLinkedScope&&(tooltipLinkedScope.$destroy(),tooltipLinkedScope=null)}function prepareTooltip(){prepPlacement(),prepPopupDelay()}function prepPlacement(){var val=attrs[prefix+"Placement"];ttScope.placement=angular.isDefined(val)?val:options.placement}function prepPopupDelay(){var val=attrs[prefix+"PopupDelay"],delay=parseInt(val,10);ttScope.popupDelay=isNaN(delay)?options.popupDelay:delay}var tooltip,tooltipLinkedScope,transitionTimeout,popupTimeout,appendToBody=!!angular.isDefined(options.appendToBody)&&options.appendToBody,triggers=getTriggers(void 0),hasEnableExp=angular.isDefined(attrs[prefix+"Enable"]),ttScope=scope.$new(!0),positionTooltip=function(){var ttPosition=$position.positionElements(element,tooltip,ttScope.placement,appendToBody);ttPosition.top+="px",ttPosition.left+="px",tooltip.css(ttPosition)};ttScope.isOpen=!1,attrs.$observe(type,function(val){ttScope.content=val,!val&&ttScope.isOpen&&hide()}),attrs.$observe(prefix+"Title",function(val){ttScope.title=val});var unregisterTriggers=function(){element.unbind(triggers.show,showTooltipBind),element.unbind(triggers.hide,hideTooltipBind)};!function(){var val=attrs[prefix+"Trigger"];unregisterTriggers(),triggers=getTriggers(val),triggers.show===triggers.hide?element.bind(triggers.show,toggleTooltipBind):(element.bind(triggers.show,showTooltipBind),element.bind(triggers.hide,hideTooltipBind))}();var animation=scope.$eval(attrs[prefix+"Animation"]);ttScope.animation=angular.isDefined(animation)?!!animation:options.animation;var appendToBodyVal=scope.$eval(attrs[prefix+"AppendToBody"]);appendToBody=angular.isDefined(appendToBodyVal)?appendToBodyVal:appendToBody,appendToBody&&scope.$on("$locationChangeSuccess",function(){ttScope.isOpen&&hide()}),scope.$on("$destroy",function(){$timeout.cancel(transitionTimeout),$timeout.cancel(popupTimeout),unregisterTriggers(),removeTooltip(),ttScope=null})}}}}}]}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function($tooltip){return $tooltip("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function($tooltip){return $tooltip("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function($document,$window){function getStyle(el,cssprop){return el.currentStyle?el.currentStyle[cssprop]:$window.getComputedStyle?$window.getComputedStyle(el)[cssprop]:el.style[cssprop]}function isStaticPositioned(element){return"static"===(getStyle(element,"position")||"static")}var parentOffsetEl=function(element){for(var docDomEl=$document[0],offsetParent=element.offsetParent||docDomEl;offsetParent&&offsetParent!==docDomEl&&isStaticPositioned(offsetParent);)offsetParent=offsetParent.offsetParent;return offsetParent||docDomEl};return{position:function(element){var elBCR=this.offset(element),offsetParentBCR={top:0,left:0},offsetParentEl=parentOffsetEl(element[0]);offsetParentEl!=$document[0]&&(offsetParentBCR=this.offset(angular.element(offsetParentEl)),offsetParentBCR.top+=offsetParentEl.clientTop-offsetParentEl.scrollTop,offsetParentBCR.left+=offsetParentEl.clientLeft-offsetParentEl.scrollLeft);var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:elBCR.top-offsetParentBCR.top,left:elBCR.left-offsetParentBCR.left}},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].documentElement.scrollLeft)}},positionElements:function(hostEl,targetEl,positionStr,appendToBody){var hostElPos,targetElWidth,targetElHeight,targetElPos,positionStrParts=positionStr.split("-"),pos0=positionStrParts[0],pos1=positionStrParts[1]||"center";hostElPos=appendToBody?this.offset(hostEl):this.position(hostEl),targetElWidth=targetEl.prop("offsetWidth"),targetElHeight=targetEl.prop("offsetHeight");var shiftWidth={center:function(){return hostElPos.left+hostElPos.width/2-targetElWidth/2},left:function(){return hostElPos.left},right:function(){return hostElPos.left+hostElPos.width}},shiftHeight={center:function(){return hostElPos.top+hostElPos.height/2-targetElHeight/2},top:function(){return hostElPos.top},bottom:function(){return hostElPos.top+hostElPos.height}};switch(pos0){case"right":targetElPos={top:shiftHeight[pos1](),left:shiftWidth[pos0]()};break;case"left":targetElPos={top:shiftHeight[pos1](),left:hostElPos.left-targetElWidth};break;case"bottom":targetElPos={top:shiftHeight[pos0](),left:shiftWidth[pos1]()};break;default:targetElPos={top:hostElPos.top-targetElHeight,left:shiftWidth[pos1]()}}return targetElPos}}}]),angular.module("ui.bootstrap.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(scope,element,attr){element.addClass("ng-binding").data("$binding",attr.bindHtmlUnsafe),scope.$watch(attr.bindHtmlUnsafe,function(value){element.html(value||"")})}}),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" bind-html-unsafe="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n')}]),function(exports){"use strict";function createCollection(proto,objectOnly){function Collection(a){if(!this||this.constructor!==Collection)return new Collection(a);this._keys=[],this._values=[],this._itp=[],this.objectOnly=objectOnly,a&&init.call(this,a)}return objectOnly||defineProperty(proto,"size",{get:sharedSize}),proto.constructor=Collection,Collection.prototype=proto,Collection}function init(a){this.add?a.forEach(this.add,this):a.forEach(function(a){this.set(a[0],a[1])},this)}function sharedDelete(key){return this.has(key)&&(this._keys.splice(i,1),this._values.splice(i,1),this._itp.forEach(function(p){i<p[0]&&p[0]--})),-1<i}function sharedGet(key){return this.has(key)?this._values[i]:void 0}function has(list,key){if(this.objectOnly&&key!==Object(key))throw new TypeError("Invalid value used as weak collection key");if(key!=key||0===key)for(i=list.length;i--&&!is(list[i],key););else i=list.indexOf(key);return-1<i}function setHas(value){return has.call(this,this._values,value)}function mapHas(value){return has.call(this,this._keys,value)}function sharedSet(key,value){return this.has(key)?this._values[i]=value:this._values[this._keys.push(key)-1]=value,this}function sharedAdd(value){return this.has(value)||this._values.push(value),this}function sharedClear(){this._values.length=0}function sharedKeys(){return sharedIterator(this._itp,this._keys)}function sharedValues(){return sharedIterator(this._itp,this._values)}function mapEntries(){return sharedIterator(this._itp,this._keys,this._values)}function setEntries(){return sharedIterator(this._itp,this._values,this._values)}function sharedIterator(itp,array,array2){var p=[0],done=!1;return itp.push(p),{next:function(){var v,k=p[0];return!done&&k<array.length?(v=array2?[array[k],array2[k]]:array[k],p[0]++):(done=!0,itp.splice(itp.indexOf(p),1)),{done:done,value:v}}}}function sharedSize(){return this._values.length}function sharedForEach(callback,context){for(var it=this.entries();;){var r=it.next();if(r.done)break;callback.call(context,r.value[1],r.value[0],this)}}var i,defineProperty=Object.defineProperty,is=function(a,b){return isNaN(a)?isNaN(b):a===b};"undefined"==typeof WeakMap&&(exports.WeakMap=createCollection({delete:sharedDelete,clear:sharedClear,get:sharedGet,has:mapHas,set:sharedSet},!0)),"undefined"==typeof Map&&(exports.Map=createCollection({delete:sharedDelete,has:mapHas,get:sharedGet,set:sharedSet,keys:sharedKeys,values:sharedValues,entries:mapEntries,forEach:sharedForEach,clear:sharedClear})),"undefined"==typeof Set&&(exports.Set=createCollection({has:setHas,add:sharedAdd,delete:sharedDelete,clear:sharedClear,keys:sharedValues,values:sharedValues,entries:setEntries,forEach:sharedForEach})),"undefined"==typeof WeakSet&&(exports.WeakSet=createCollection({delete:sharedDelete,add:sharedAdd,clear:sharedClear,has:setHas},!0))}("undefined"!=typeof exports&&"undefined"!=typeof global?global:window),UUID.generate=function(){var rand=UUID._gri,hex=UUID._ha;return hex(rand(32),8)+"-"+hex(rand(16),4)+"-"+hex(16384|rand(12),4)+"-"+hex(32768|rand(14),4)+"-"+hex(rand(48),12)},UUID._gri=function(x){return x<0?NaN:x<=30?0|Math.random()*(1<<x):x<=53?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<x-30))*(1<<30):NaN},UUID._ha=function(num,length){for(var str=num.toString(16),i=length-str.length,z="0";i>0;i>>>=1,z+=z)1&i&&(str=z+str);return str},function(){"use strict";this.app.directive("draggable",function($compile,$templateCache,SelectedEntities,Folder,settings){return{scope:{entity:"=draggable",canDrag:"="},link:function(scope,el,attrs){var $el,canNotDragItem,enableDrag,helper,template;if(scope.canDrag)return template=$templateCache.get("scripts/directives/draggable/draggable-helper.html"),helper=function(){return scope.count=SelectedEntities.size||1,$compile(template)(scope)},scope.isFolder=function(entity){return entity instanceof Folder},canNotDragItem=function(){return"single"===settings.selectionType&&!SelectedEntities.has(scope.entity)&&SelectedEntities.size>0},$el=$(el),enableDrag=function(){return $el.draggable("instance")&&$el.draggable("destroy"),$el.draggable({revert:"invalid",helper:helper,delay:100,appendTo:"body",cursorAt:{left:57,top:57},addClasses:!0,zIndex:1e4,start:function(){return!canNotDragItem()&&el.addClass("ui-dragging")},stop:function(){return el.removeClass("ui-dragging")}})},$el.mouseover(enableDrag),$el.mousedown(enableDrag)}}})}.call(this),function(){app.directive("folderActions",function(){return{restrict:"E",scope:{folder:"=",showRenaming:"&",remove:"="},templateUrl:"scripts/directives/folder-actions/folder-actions.html"}})}.call(this),function(){"use strict";var POPUP_WIDTH;POPUP_WIDTH=350,app.directive("preview",function($sce,localizeDate){return{restrict:"E",replace:!0,templateUrl:"scripts/directives/preview/preview.html",scope:{item:"=",folderName:"=",adapterName:"=",parentSelector:"@"},link:function(scope){var hasAttributes,url;return scope.isRetina=window.devicePixelRatio>1,scope.videoSources=[],scope.showFolderName=!0,hasAttributes=function(url){var ref;return(null!=(ref=/\?((?:&?[^&])+)/.exec(url))?ref[1]:void 0)||""},scope.uploadedBy=function(item){return item.readOnly?"item_preview_label.uploaded_by_contributor":"item_preview_label.uploaded_by_owner"},_.includes(scope.item.tags,"_mp4_alpha")&&(scope.videoHeight={height:scope.item.height*POPUP_WIDTH/scope.item.width/2}),"shutterstock"===scope.adapterName&&(scope.showFolderName=!1),scope.uploadedTime=function(item){return localizeDate(1e3*item.createdAt)},scope.item.can.showExternalVideoPreview()?(url=scope.item.iframeSrc+(hasAttributes(scope.item.iframeSrc)?"&autoplay=1":"?autoplay=1"),"youtube"===scope.adapterName&&(url+="&showinfo=0"),scope.iframeSrc=$sce.trustAsResourceUrl(url)):_.includes(["video"],scope.item.mediaType)?_.forEach(scope.item.videoPreviewUrls,function(videoPreviewUrl){return scope.videoSources.push($sce.trustAsResourceUrl(videoPreviewUrl))}):void 0}}}),app.directive("inlinesvg",function($parse,$http){return{restrict:"A",link:function(scope,el,attrs){var options;return options=_.assign({},$parse(attrs.inlinesvg)(scope)),$http.get(options.src,{withCredentials:!1}).then(function(response){return el.html(response.data)})}}})}.call(this),function(){"use strict";this.app.directive("entitiesGrid",function($sce,SelectedEntities,Notifications,MediaStudio,Folder,i18n,bigstockPrice,shutterStockPrice){return{restrict:"E",templateUrl:"scripts/directives/entities-grid/entities-grid.html",scope:{entities:"=",folderNameById:"&",selectedFolder:"=",adapterName:"=",renameCtrl:"=",moveSelectedToFolder:"&",click:"&",doubleClick:"&",selectAndSubmitItem:"&",onAllThumbnailsLoaded:"&",canSelectMultiple:"=",selectedLayoutId:"=",remove:"="},link:function(scope){return scope.isIE11=Boolean(window.MSInputMethodContext)&&Boolean(document.documentMode),_.includes(["bigstock","shutterstock"],scope.adapterName)&&(scope.price=$sce.trustAsHtml(i18n.translate("photo_stock.big_stock.buy_short")),bigstockPrice().then(function(response){return scope.price=$sce.trustAsHtml(""+response.currencySymbol+response.priceValue)})),_.includes(["shutterStockVideo"],scope.adapterName)&&(scope.price=$sce.trustAsHtml(i18n.translate("photo_stock.shutterstock_video.buy_short")),shutterStockPrice().then(function(response){return scope.price=$sce.trustAsHtml(""+response.currencySymbol+response.priceValue)})),scope.isSelected=function(entity){return SelectedEntities.has(entity)},scope.isFolder=function(entity){return entity instanceof Folder},scope.folderName=function(item){return item.isInSiteMedia?i18n.translate("private_media.site_media"):"function"==typeof scope.folderNameById?scope.folderNameById({id:item.folderId}):void 0},scope.onThumbnailLoaded=_.debounce(function(){return"function"==typeof scope.onAllThumbnailsLoaded?scope.onAllThumbnailsLoaded():void 0},1e3),scope.editItemInMediaStudio=function(item){return MediaStudio.edit(item,scope.selectedFolder)},scope.rename=function(newName,entity){return 0===$.trim(newName).length?Notifications.send(i18n.translate("errors.rename_item_failed.empty_name")):$.trim(newName).length>256?Notifications.send(i18n.translate("errors.rename_item_failed.long_name")):entity.rename(newName)}}}})}.call(this),function(){"use strict";app.directive("moreActionsTooltip",function($compile,$templateCache,$parse,settings){return{restrict:"A",link:function(scope,element,attrs){var actionsContainer,defaultOptions,getActionsWidth,hiddenActionsContainer,hideActions,oldActionsWidth,oldContainerWidth,restoreHiddenActions,showMore,showMoreTemplate;if(settings.hasFavorites)return showMoreTemplate=$templateCache.get("scripts/directives/more-actions-tooltip/show-more.html"),defaultOptions={drawOnEvent:"mouseover",actionsContainerSelector:".actions"},scope.options=_.assign({},defaultOptions,$parse(attrs.popup)(scope)),actionsContainer=element.find(scope.options.actionsContainerSelector),showMore=$compile(showMoreTemplate)(scope),hiddenActionsContainer=showMore.find(".more-actions"),oldActionsWidth=0,oldContainerWidth=0,getActionsWidth=function(){var actions;return actions=actionsContainer.children(":not(.ng-hide)"),_.reduce(actions,function(memo,el){return memo+$(el).outerWidth()},0)},restoreHiddenActions=function(hiddenActions){if(null!=hiddenActions?hiddenActions.length:void 0)return actionsContainer.append(hiddenActions)},hideActions=function(){var lastAction,results;for(results=[];getActionsWidth()>actionsContainer.width()&&0!==actionsContainer.children(":not(.show-more, .ng-hide)").length;)lastAction=actionsContainer.children(":not(.show-more, .ng-hide)").last(),hiddenActionsContainer.prepend(lastAction),actionsContainer.children(".show-more").length?results.push(actionsContainer.children(".show-more").show()):results.push(actionsContainer.append(showMore));return results},element.on(scope.options.drawOnEvent,function(){if(oldActionsWidth!==getActionsWidth()||oldContainerWidth!==actionsContainer.width())return actionsContainer.children(".show-more").hide(),restoreHiddenActions(hiddenActionsContainer.children()),hideActions(),oldContainerWidth=actionsContainer.width(),oldActionsWidth=getActionsWidth()})}}})}.call(this),function(){app.directive("spinner",function(){return{restrict:"E",templateUrl:"scripts/directives/spinner/spinner.html",scope:{onDestroy:"&"},link:function(scope,el,attrs){var $path,$svg,animateColor,animateRotation,animateStroke,applyAnimation,ref,setColor2,setColor3,setColor4;if($svg=$(el).find(".spinner"),$path=$(el).find(".path"),scope.onDestroy&&el.bind("$destroy",function(){return scope.onDestroy()}),applyAnimation=function(val,tween){if("strokeDashoffset"===tween.prop&&$(this).css("stroke-dashoffset",val),"transformRotate"===tween.prop)return $(this).css("transform","rotate("+val+"deg)")},animateRotation=function(){return $svg.css({"transform-rotate":0}),$svg.animate({"transform-rotate":270},{step:applyAnimation,duration:1400,complete:animateRotation})},animateStroke=function(){return $path.animate({"transform-rotate":135,"stroke-dashoffset":46.75},{step:applyAnimation,duration:700,complete:function(){return $path.animate({"transform-rotate":450,"stroke-dashoffset":187},{step:applyAnimation,duration:700,complete:animateStroke})}})},animateColor=function(){return $path.css({stroke:"#3899ec"}),setTimeout(setColor2,1400)},setColor2=function(){return $path.css({stroke:"#42c5bf"}),setTimeout(setColor3,1400)},setColor3=function(){return $path.css({stroke:"#6ccc65"}),setTimeout(setColor4,1400)},setColor4=function(){return $path.css({stroke:"#79b6f0"}),setTimeout(animateColor,1400)},/MSIE|Trident/i.test(null!=(ref=window.navigator)?ref.userAgent:void 0))return $svg.css({"z-index":1e3}),$svg.css({animation:"none"}),$path.css({animation:"none"}),animateStroke(),animateRotation(),animateColor()}}})}.call(this),function(){"use strict";this.app.directive("uploadButton",function(){return{restrict:"E",scope:{uploadFiles:"&",canUpload:"="},templateUrl:"scripts/directives/upload-button/upload-button.html",link:function(scope){return scope.uploadFiles=_.throttle(scope.uploadFiles)}}})}.call(this),function(){"use strict";this.app.directive("noEntities",function($state,$sce,i18n,htmlEncode,settings){return{restrict:"E",templateUrl:"scripts/directives/no-entities/no-entities.html",scope:{selectedFolder:"=",canUpload:"=",uploadFiles:"&",searchQuery:"=",adapterType:"@",allFolder:"=",selectFolder:"&",showDescriptionLink:"&"},link:function(scope){return scope.settings=settings,_.isBoolean("function"==typeof scope.showDescriptionLink?scope.showDescriptionLink():void 0)?scope.showDescriptionLink=scope.showDescriptionLink():scope.showDescriptionLink=!0,scope.getHeader=function(){var ref,ref1,ref2,ref3,ref4,ref5,ref6,ref7;return"allMedia"===(null!=(ref=scope.selectedFolder)?ref.type:void 0)&&i18n.isTranslatable("no_items.header_allMedia")?i18n.translate("no_items.header_allMedia"):"siteMedia"===(null!=(ref1=scope.selectedFolder)?ref1.type:void 0)&&i18n.isTranslatable("no_items.header_siteMedia")?i18n.translate("no_items.header_siteMedia"):(null!=(ref2=scope.selectedFolder)?ref2.can.uploadIn():void 0)?_.includes(["allMedia","siteMedia"],null!=(ref3=scope.selectedFolder)?ref3.type:void 0)?_.includes(["picture","secure_picture","video","secure_video"],settings.mediaType)?i18n.translate("no_items.header_allMedia"):i18n.translate("no_items.header_"+(null!=(ref4=scope.selectedFolder)?ref4.type:void 0)):"unsorted"===(null!=(ref5=scope.selectedFolder)?ref5.type:void 0)?i18n.translate("no_items.header_allMedia"):i18n.translate("no_items.header_user_folder",[scope.selectedFolder.name]):"purchased"===(null!=(ref6=scope.selectedFolder)?ref6.type:void 0)?i18n.translate("no_items.header_"+scope.selectedFolder.type):(null!=(ref7=scope.selectedFolder)?ref7.name:void 0)?i18n.translate("no_items_in_readonly_folder.header",[scope.selectedFolder.name]):void 0},scope.descriptionTranslationKey=function(){var ref,ref1;return"allMedia"===(null!=(ref=scope.selectedFolder)?ref.type:void 0)&&i18n.isTranslatable("no_items.text_allMedia")?"no_items.text_allMedia":"siteMedia"===(null!=(ref1=scope.selectedFolder)?ref1.type:void 0)&&i18n.isTranslatable("no_items.text_siteMedia")?"no_items.text_siteMedia":i18n.isTranslatable("no_items.text_user_folder")?"no_items.text_user_folder":"no_items.text"},scope.getDescription=function(){var ref,ref1;return"purchased"===(null!=(ref=scope.selectedFolder)?ref.type:void 0)?{description:"no_items.text_"+scope.selectedFolder.type,link:"no_items.text_"+scope.selectedFolder.type+"_link",state:"app.photoStock"}:"siteMedia"===(null!=(ref1=scope.selectedFolder)?ref1.type:void 0)?'<a href="'+$sce.trustAsResourceUrl(i18n.translate("help_contributors_url"))+'" target="_blank">'+i18n.translate("no_items.text_siteMedia_link")+"</a>":void 0},scope.changeState=function(state){return $state.go(state)},scope.getSearchQuery=function(){return htmlEncode(scope.searchQuery)},scope.isSearch=function(){return!!scope.searchQuery},scope.searchTemplate="user-owned"===scope.adapterType?"no-user-owned-search-results.html":"no-search-results.html"}}})}.call(this),function(){app.directive("breadcrumbs",function(){return{restrict:"E",templateUrl:"scripts/directives/breadcrumbs/breadcrumbs.html",scope:{list:"&",action:"&"},link:function(scope,el,attr){return scope.existedList=function(){return _.filter(scope.list(),function(folder){return!!folder})}}}})}.call(this),function(){this.app.directive("renamableName",function(){return{restrict:"E",scope:{entity:"=",renameCtrl:"=",redrawOnChange:"="},link:function(scope){return scope.newName=scope.entity.name},templateUrl:"scripts/directives/renamable-name/renamable-name.html"}})}.call(this),function(){this.app.directive("folderLongName",["$timeout","$window","$parse","Folder",function($timeout,$window,$parse,Folder){return{restrict:"A",scope:{folder:"=",redrawOnChange:"="},compile:function(elem,attr,linker){return function(scope,element,attributes){var buildEllipsis,drawNameTooltip,isOverflowed;scope.folder instanceof Folder&&(buildEllipsis=function(){isOverflowed(element)&&drawNameTooltip(element,scope.folder.name)},drawNameTooltip=function(element,name){var folder,tooltip;if(folder=element.parents(".item.folder"),!$(".folder-name-tooltip",folder).length)return tooltip=angular.element('<div class="folder-name-tooltip ng-hide">'+name+"</div>"),folder.append(tooltip),$(".name",folder).on("mouseenter",function(){return tooltip.removeClass("ng-hide")}),folder.on("mouseleave",function(){return tooltip.addClass("ng-hide")})},isOverflowed=function(thisElement){return thisElement[0].scrollWidth>thisElement[0].clientWidth},attributes.lastWindowResizeTime=0,attributes.lastWindowResizeWidth=0,attributes.lastWindowResizeHeight=0,attributes.lastWindowTimeoutEvent=null,attributes.isTruncated=!1,scope.$watch("ngBind",function(){buildEllipsis()}),scope.$watch("redrawOnChange",function(){buildEllipsis()}),angular.element($window).bind("resize",function(){$timeout.cancel(attributes.lastWindowTimeoutEvent),attributes.lastWindowTimeoutEvent=$timeout(function(){attributes.lastWindowResizeWidth===window.innerWidth&&attributes.lastWindowResizeHeight===window.innerHeight||buildEllipsis(),attributes.lastWindowResizeWidth=window.innerWidth,attributes.lastWindowResizeHeight=window.innerHeight},75)}))}}}}])}.call(this),function(){app.directive("autoscroll",function(){return{restrict:"A",link:function(scope,element,attrs){return setTimeout(function(){return element[0].scrollTop="bottom"===attrs.autoscroll?element[0].scrollHeight-element[0].clientHeight:0},200)}}})}.call(this),function(){app.directive("focusMe",function($timeout){return function(scope,element,attrs){return scope.$watch(attrs.focusMe,function(value){if(value)return $timeout(function(){return element[0].focus()})})}})}.call(this),function(){"use strict";var slice=[].slice;app.directive("thumb",function($parse,mediaTypes,supportedArchiveTypes,supportedDocsTypes){return{link:function(scope,element,attrs){var extension,file,fileSpecificBGImage,mediaType,setImageAsBackground;return mediaType=$parse(attrs.mediaType)(scope),_.includes([mediaTypes.ARCHIVE,mediaTypes.DOCUMENT],mediaType)?(file=$parse(attrs.thumb)(scope),extension=_.last(file.name.split(".")),void(_.includes(slice.call(supportedArchiveTypes).concat(slice.call(supportedDocsTypes)),extension)&&(fileSpecificBGImage="images/thumbnails/"+mediaType+"-"+extension+".svg",element.css({"background-image":"url("+fileSpecificBGImage+")","background-size":"cover"})))):(file=$parse(attrs.thumb)(scope),setImageAsBackground=function(img){return element.append(img),element.css({"background-image":"none"})},file&&"image/svg+xml"!==file.type&&/image/i.test(file.type)?loadImage(file,setImageAsBackground,{maxWidth:element.innerWidth(),maxHeight:element.innerHeight(),crop:!0}):void 0)}}})}.call(this),function(){app.directive("denyBubbling",function(){return{restrict:"A",link:function(scope,element,attrs){var eventName;return eventName=attrs.denyBubbling||"click",$(element).on(eventName,function(event){return event.cancelBubble=!0,"function"==typeof event.stopPropagation?event.stopPropagation():void 0})}}})}.call(this),function(){app.directive("onEnter",function(){return{restrict:"A",link:function(scope,element,attrs){return element.on("keydown",function(e){if(13===e.keyCode)return scope.$apply(attrs.onEnter)})}}})}.call(this),function(){app.directive("autoEnterDelayed",function(){return{restrict:"A",link:function(scope,element,attrs){return element.on("keydown",_.debounce(function(){return scope.$apply(attrs.onEnter)},800))}}})}.call(this),function(){app.directive("onEsc",function(){return{restrict:"A",link:function(scope,element,attrs){return element.on("keyup",function(e){if(e.stopPropagation(),27===e.keyCode)return scope.$apply(attrs.onEsc)})}}})}.call(this),function(){app.directive("onClickOutside",function(){return{restrict:"A",link:function(scope,element,attrs){return element.on("focus",function(event){return $(document).off(".hideInput"),$(document).on("mousedown.hideInput",function(event){return event.target!==element[0]&&scope.$apply(attrs.onClickOutside),$(document).off(".hideInput")})})}}})}.call(this),function(){app.directive("multiSelect",function(SelectedEntities){return{controller:function($scope,$attrs,$parse){var lastSelectedItem;return lastSelectedItem=null,this.selectRange=function(entity){var endPosition,entities,i,j,ref,ref1,startPosition;if(!1===$scope.canSelectMultiple)return this.selectSingle(entity);for(entities=$parse($attrs.multiSelect)($scope),startPosition=entities.indexOf(lastSelectedItem||entity),
endPosition=entities.indexOf(entity),SelectedEntities.clear(),i=j=ref=startPosition,ref1=endPosition;ref<=ref1?j<=ref1:j>=ref1;i=ref<=ref1?++j:--j)SelectedEntities.add(entities[i]);return!0},this.addSingle=function(entity){return!1===$scope.canSelectMultiple?this.selectSingle(entity):(!SelectedEntities.has(entity)||1!==SelectedEntities.size)&&(SelectedEntities.add(entity),lastSelectedItem=entity,!0)},this.selectSingle=function(entity){return SelectedEntities.has(entity)&&1===SelectedEntities.size?SelectedEntities.clear():(SelectedEntities.clear(),SelectedEntities.add(entity),lastSelectedItem=entity,!0)},this.unselectSingle=function(entity){return lastSelectedItem=null,SelectedEntities.delete(entity)},this.invertSingle=function(entity){var method;return method=SelectedEntities.has(entity)?"unselectSingle":"addSingle",this[method](entity)},this}}}),app.directive("selectEntity",function(settings,SelectedEntities,$parse){return{link:function(scope,element,attrs){var entity;return entity=$parse(attrs.selectEntity)(scope),element.on("mousedown",function(event){if(event.stopPropagation(),entity.can.select())return SelectedEntities.clear(),SelectedEntities.add(entity),scope.$apply()}),element.on("mouseup",function(event){return SelectedEntities.clear(),scope.$apply()})}}}),app.directive("multiSelectEntity",function(settings,SelectedEntities,$parse){return{require:"?^multiSelect",link:function(scope,element,attrs,multiSelect){var entity,preventMouseUp;return preventMouseUp=!0,entity=$parse(attrs.multiSelectEntity)(scope),element.on("mousedown",function(event){var canDoScopeApply,isCtrl,isShift;if(preventMouseUp=!1,canDoScopeApply=!1,isShift=event.shiftKey,isCtrl=event.metaKey||event.ctrlKey,event.stopPropagation(),entity.can.select())return isShift?(multiSelect.selectRange(entity),preventMouseUp=!0,canDoScopeApply=!0):isCtrl?SelectedEntities.has(entity)||(multiSelect.addSingle(entity),preventMouseUp=!0,canDoScopeApply=!0):0===SelectedEntities.size?(multiSelect.selectSingle(entity),preventMouseUp=!0,canDoScopeApply=!0):SelectedEntities.size>0&&"single"!==settings.selectionType&&!SelectedEntities.has(entity)&&(multiSelect.addSingle(entity),preventMouseUp=!0,canDoScopeApply=!0),canDoScopeApply?scope.$apply():void 0}),element.on("mouseup",function(event){var canDoScopeApply,isCtrl,isShift;if(!preventMouseUp&&(preventMouseUp=!0,isShift=event.shiftKey,isCtrl=event.metaKey||event.ctrlKey,canDoScopeApply=!1,!isShift&&(entity=$parse(attrs.multiSelectEntity)(scope),entity.can.select())))return isCtrl?SelectedEntities.has(entity)&&(multiSelect.unselectSingle(entity,!0),canDoScopeApply=!0):("single"===settings.selectionType?multiSelect.selectSingle(entity):multiSelect.invertSingle(entity,!0),canDoScopeApply=!0),canDoScopeApply?scope.$apply():void 0})}}}),app.directive("selectAll",function(SelectedEntities){return{scope:{entities:"="},link:function(scope,element){var ctrlOrCmdIsActiveInEvent,keyCodeIsForAlpha,targetIsNotInput;return targetIsNotInput=function(target){return"INPUT"!==target.tagName&&"TEXTAREA"!==target.tagName},keyCodeIsForAlpha=function(keyCode){return 65===keyCode},ctrlOrCmdIsActiveInEvent=function(event){return event.metaKey||event.ctrlKey},$(document).on("keydown",function(event){if(targetIsNotInput(event.target)&&keyCodeIsForAlpha(event.keyCode)&&ctrlOrCmdIsActiveInEvent(event))return SelectedEntities.clear(),scope.$apply(function(){return _.forEach(scope.entities,function(entity){return SelectedEntities.add(entity)})}),event.preventDefault(),event.stopPropagation(),!1}),element.on("mousedown",function(event){if(event.target!==element[0])return SelectedEntities.clear(),scope.$apply()})}}})}.call(this),function(){"use strict";this.app.directive("biClick",function($parse,biUiEvents){return{restrict:"A",link:function(scope,el,attrs){return el.bind("click",function(){var options,params;return params=$parse(attrs.biClick)(scope),options=params.data,biUiEvents(params.eventName,options)})}}})}.call(this),function(){"use strict";this.app.directive("biFileUpload",function($parse,biReport,settings){return{restrict:"A",link:function(scope,el,attrs){var event,modes,onFileUpload;return event=attrs.biFileUpload,modes={change:"click",drop:"drop"},onFileUpload=function(ev){var filesCount,ref,ref1;if(ev.stopPropagation(),filesCount=(null!=(ref=ev.originalEvent.dataTransfer)?ref.files.length:void 0)||(null!=(ref1=ev.originalEvent.srcElement)?ref1.files.length:void 0))return biReport("uploadStarted",{files:filesCount,media_type:settings.mediaType,mode:modes[event]})},el.on(event,onFileUpload)}}})}.call(this),function(){this.app.directive("whenScrolledToBottom",function(){return function(scope,element,attrs){var $element,applyOnScrollBottom,callAction,getContentHeight;return $element=$(element),callAction=_.throttle(function(){return scope.$apply(attrs.whenScrolledToBottom)},100),applyOnScrollBottom=function(){if($element.scrollTop()>0&&$element.scrollTop()>=element.prop("scrollHeight")-2*$element.height())return callAction()},$element.on("scroll",applyOnScrollBottom),$element.on("mousemove",applyOnScrollBottom),getContentHeight=function(element){var contentHeight;return contentHeight=0,element.children().each(function(i,el){return contentHeight+=el.offsetHeight}),contentHeight},$element.on("mousewheel DOMMouseScroll",function(){if(0===$element.scrollTop()&&getContentHeight(element)<element.prop("scrollHeight"))return callAction()})}})}.call(this),function(){var isVisibleAt,loadImage,loadedImagesCount;loadedImagesCount=0,loadImage=function(url,callback,errorCallback){var image;return image=new Image,image.onload=function(){if(callback(image),10===++loadedImagesCount)return"undefined"!=typeof appLoadNotifiers&&null!==appLoadNotifiers?appLoadNotifiers.first10ImagesLoaded():void 0},image.onerror=errorCallback,image.src=url,image},isVisibleAt=function(el,container){var offsetTop;return(offsetTop=el.offset().top-container.offset().top)>-el.outerHeight()&&offsetTop<=container.height()},this.app.directive("coveredBackground",function(){return{restrict:"A",scope:{coveredBackground:"@",loadIfChanged:"=",loadVisibleFor:"@",scrollDebounce:"@",onLoadSuccess:"&"},link:function(scope,element){var container,isLoaded,isLoading,setBackgroundSize,showImage,showOnEvent;if(isLoaded=!1,isLoading=!1,scope.scrollDebounce||(scope.scrollDebounce=1500),setBackgroundSize=function(image){var backgroundSize;if(!/\.svg$/i.test(image.src)&&!/\/fit\//i.test(image.src))return backgroundSize=image.width>=element.innerWidth()||image.height>=element.innerHeight()?"cover":"auto",element.css("background-size",backgroundSize)},showImage=function(url){if(!isLoaded&&!isLoading)return isLoading=!0,loadImage(url,function(image){return element.css("background-image",'url("'+url+'")'),setBackgroundSize(image),isLoaded=!0,isLoading=!1,scope.onLoadSuccess()},function(){return isLoading=!1})},container=element.parents(scope.loadVisibleFor).first(),showOnEvent=_.throttle(function(){if(!scope.loadVisibleFor||isVisibleAt(element,container))return isLoaded=!1,showImage(scope.coveredBackground)},scope.scrollDebounce),scope.$watch("coveredBackground",showOnEvent),scope.$watch("loadIfChanged",function(){if(!isLoaded&&!isLoading)return showOnEvent()}),scope.loadVisibleFor)return container.scroll(function(){if(!isLoaded&&!isLoading)return showOnEvent()}),$(window).resize(function(){if(!isLoaded&&!isLoading)return showOnEvent()})}}})}.call(this),function(){"use strict";var hideFns;hideFns=[],app.directive("popup",function($compile,$parse,$templateCache,$document){var defaultOptions;return defaultOptions={event:"click",offsetTop:0,offsetLeft:0,pinTo:"element",pinToSelector:null,align:"bottom right",activeClass:"popup-opened",containerClass:"popup-container",contentClass:"popup-content",parentSelector:null,parentActiveClass:"active",centeredTip:!1,template:null,disable:!1,fadeOut:0},{restrict:"A",link:function(scope,el,attrs){var MARGIN_TOP,compileTemplate,options;if(MARGIN_TOP=25,compileTemplate=function(templateId){return $compile($templateCache.get(templateId))(scope)},options=_.assign({},defaultOptions,$parse(attrs.popup)(scope)),!options.disable)return el.on(options.event,function(event){var activeElementWidth,adjustPopupPosition,align,autoHide,calculateAlign,calculatePosition,containerEl,containerHeight,containerWidth,contentEl,contentInside,handlePopup,hideFn,injectToDOM,onOutsideClick,position;if(event.stopPropagation(),!el.hasClass(options.activeClass))return options.template&&el.html(compileTemplate(options.template)),_.forEach(hideFns,function(hide){return hide()}),containerWidth=0,containerHeight=0,activeElementWidth=0,contentInside=!!el.find("."+options.contentClass).length,contentEl=el.find(contentInside?"."+options.contentClass:"+ ."+options.contentClass),containerEl=angular.element("<div class='"+options.containerClass+"'></div>").append(contentEl),hideFn=function(){var revertBlock;return containerEl.find("iframe").prop("src","about:blank"),containerEl.find("iframe").remove(),$document.off("click",onOutsideClick),el.off("mouseleave.popup"),el.off("mouseenter.popup"),el.off("click.popup"),containerEl.off("mousemove.popup"),containerEl.off("mouseenter.popup"),containerEl.off("click.popup"),$(window).off("resize.popup"),$(window).off("click.popup"),$(window).off("mousemove.popup"),_.remove(hideFns,function(fn){return fn===hideFn}),revertBlock=function(){return el.removeClass(options.activeClass),options.parentSelector&&el.closest(options.parentSelector).removeClass(options.parentActiveClass),contentInside?el.append(contentEl):el.parent().append(contentEl),containerEl.remove()},options.fadeOut?(containerEl.css({opacity:1}),containerEl.animate({opacity:0},options.fadeOut,revertBlock)):revertBlock()},onOutsideClick=function(){return hideFn()},$document.on("click",onOutsideClick),position={},align={vertical:_.intersection(options.align.split(" "),["top","bottom"])[0],horizontal:_.intersection(options.align.split(" "),["left","right","center"])[0]},injectToDOM=function(){return el.addClass(options.activeClass),options.parentSelector&&el.closest(options.parentSelector).addClass(options.parentActiveClass),options.centeredTip&&containerEl.addClass("centered-tip"),$("body").append(containerEl)},autoHide=function(){var delay;return delay=300,hideFns.push(hideFn),containerEl.on("click.popup",hideFn),$(window).on("resize.popup",hideFn),setTimeout(function(){return $(window).on("click.popup",hideFn,100)}),el.one("mouseleave.popup",function(){var timeout;return containerEl.on("mousemove.popup",function(){return!1}),timeout=null,$(window).on("mousemove.popup",_.throttle(function(){var clearTimeout,hideContainer;return el.off("mouseenter.popup"),containerEl.off("mouseenter.popup"),clearTimeout=function(){if(timeout)return window.clearTimeout(timeout)},hideContainer=function(){return clearTimeout(),timeout=window.setTimeout(hideFn,delay)},containerEl.on("mousemove.popup",function(){return clearTimeout()}),el.on("mouseenter.popup",function(){return clearTimeout()}),hideContainer()},300))})},adjustPopupPosition=function(){var windowHeight;if(windowHeight=angular.element(window).height(),containerHeight+position.top+MARGIN_TOP>windowHeight)return position.top=windowHeight-containerHeight-MARGIN_TOP,containerEl.addClass("popup-no-arrow")},calculatePosition=function(){if(position="mouse"===options.pinTo?{top:event.clientY,left:event.clientX}:(options.pinToSelector&&el.find(options.pinToSelector)||el).offset(),position.top+=options.offsetTop+$(window).scrollTop(),position.left+=$(window).scrollLeft(),position.left+=/-?[0-9]+%/.test(options.offsetLeft)?parseFloat(options.offsetLeft)*activeElementWidth/100:options.offsetLeft,"left"===align.horizontal&&(position.left-=containerWidth),"top"===align.vertical&&(position.top-=containerHeight),"center"===align.horizontal)return position.left+=activeElementWidth/2-containerWidth/2},calculateAlign=function(){var horizontalAlign,possibleHorizontal,possibleVertical,verticalAlign,windowHeight;return windowHeight=angular.element(window).height(),possibleVertical=[],position.top+containerHeight<=windowHeight&&possibleVertical.push("bottom"),position.top-containerHeight>=0&&possibleVertical.push("top"),possibleHorizontal=[],position.left+containerWidth<=angular.element(window).width()&&possibleHorizontal.push("right"),position.left-containerWidth>=0&&possibleHorizontal.push("left"),"center"===align.horizontal&&position.left+activeElementWidth/2-containerWidth/2<=angular.element(window).width()&&possibleHorizontal.push("center"),verticalAlign=_.find(possibleVertical,function(possibleAlign){return possibleAlign===align.vertical}),horizontalAlign=_.find(possibleHorizontal,function(possibleAlign){return possibleAlign===align.horizontal}),align={vertical:verticalAlign||possibleVertical[0]||align.vertical||"bottom",horizontal:horizontalAlign||possibleHorizontal[0]||align.horizontal||"right"}},handlePopup=function(){if(containerWidth=containerEl.outerWidth(),containerHeight=containerEl.outerHeight(),activeElementWidth=el.outerWidth(),calculatePosition(),calculateAlign(),calculatePosition(),adjustPopupPosition(),containerEl.addClass(align.vertical+" "+align.horizontal).css({top:position.top,left:position.left}),options.fadeOut)return containerEl.css({opacity:1})},injectToDOM(),autoHide(),el.hasClass("item-preview")?(containerEl.hide(),contentEl.find("img").on("load",function(){return setTimeout(function(){return containerEl.show(),handlePopup()},0)})):handlePopup()})}}})}.call(this),function(){this.app.directive("resetScroll",function(){return function(scope,el,attrs){return scope.$watch(attrs.resetScroll,function(){return $(el).scrollTop(0)},!0)}})}.call(this),function(){this.app.directive("dragHighlight",function($parse,settings){return function(scope,element,attrs){var canUpload,disableUpload,dragEnterTarget,dragLeaveTarget,target;return canUpload=$parse(attrs.canUpload),target=attrs.dragHighlight?$(attr.dragHighlight):element,target=element,dragEnterTarget=null,dragLeaveTarget=null,disableUpload=function(){settings.disableUpload||canUpload(scope)},target.on("dragenter",function(e){if(e.stopPropagation(),e.preventDefault(),disableUpload())return dragEnterTarget=e.target,element.hasClass("drag")?void 0:element.addClass("drag")}),target.on("drop",function(e){if(!settings.disableUpload)return element.removeClass("drag")}),target.on("dragstop",function(e){if(e.stopPropagation(),e.preventDefault(),disableUpload())return dragEnterTarget=null,dragLeaveTarget=null,element.removeClass("drag")}),target.on("dragleave",function(e){if(e.stopPropagation(),e.preventDefault(),disableUpload())return dragLeaveTarget=e.target,dragEnterTarget===dragLeaveTarget?element.removeClass("drag"):void 0})}})}.call(this),function(){this.app.directive("dropFiles",function($parse,settings){return function(scope,element,attrs){var canUpload,dragOver,mapMultipart,upload;return upload=$parse(attrs.dropFiles),canUpload=$parse(attrs.canUpload),dragOver=function(e){return e.stopPropagation(),e.preventDefault()},mapMultipart=function(files){return _.map(files,function(file){return{file:file,name:file.name,size:file.size}})},$(element)[0].addEventListener("dragover",dragOver,!1),$(element).on("drop",function(e){var mappedFiles,ref;if(!settings.disableUpload&&canUpload(scope)&&null!=(null!=(ref=e.originalEvent.dataTransfer)?ref.files:void 0))return e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.files.length?(mappedFiles=mapMultipart(e.originalEvent.dataTransfer.files),upload(scope,{files:mappedFiles})):void 0})}})}.call(this),function(){var hasParent,hoverClassName,lastOverElement;lastOverElement=null,hoverClassName="drop-hover",hasParent=function(element,parentElement){var parentToSearch;return parentToSearch=$(parentElement)[0],_.some($(element).parents(),function(parentEl){return parentEl===parentToSearch})},this.app.directive("droppable",function($parse){return function(scope,element,attrs){return $(document).on("drop",function(){return element.removeClass(hoverClassName)}),$(element).droppable({addClasses:!0,hoverClass:hoverClassName,greedy:!0,tolerance:"pointer",accept:function(draggableElement){return draggableElement[0]!==element[0]&&!hasParent(draggableElement,element)},over:function(){return $parse(attrs.canDropEntities)(scope)||element.removeClass(hoverClassName),lastOverElement&&lastOverElement!==element&&!element.parents("[droppable]").length&&element.removeClass(hoverClassName),lastOverElement=element,setTimeout(function(){return lastOverElement=null},10)},drop:function(event,ui){var fn;if($parse(attrs.canDropEntities)(scope)&&!hasParent(event.toElement,element)&&event.toElement!==element[0])return fn=$parse(attrs.droppable),scope.$apply(function(){return fn(scope)})}})}})}.call(this),function(){"use strict";this.app.directive("fileSelect",function($parse){return function(scope,element,attrs){var bindOnChange,input,mapInput,mapMultipart,parseFileName,upload;return upload=$parse(attrs.fileSelect),input=function(){return $(element).find('input[type="file"]')},parseFileName=function(path){return _.last(path.split("\\"))},mapMultipart=function(files){return _.map(files,function(file){return{file:file,name:file.name,size:file.size}})},mapInput=function(input,form,iframe){var fileToUpload;return fileToUpload={form:form,iframe:iframe,input:input,name:parseFileName(input.val()),size:1e3},[fileToUpload]},bindOnChange=function(e){var clone,form,iframe,mappedFiles;return e.target.files?(mappedFiles=mapMultipart(e.target.files,e.target),input().replaceWith(input().clone(!0,!0))):(input=$(e.target),form=$(angular.element("<form/>")),clone=input.clone(!0,!0),iframe=$(angular.element('<iframe name="iframeTransport'+Date.now()+'"/>')),form.insertAfter(input),form.append(input).append(iframe),clone.insertBefore(form),form.addClass("form-in-progress"),mappedFiles=mapInput(input,form,iframe)),input()[0].value="",upload(scope,{files:mappedFiles})},input().on("change",bindOnChange)}})}.call(this),function(){window.containerWidth=null,this.app.directive("itemsGridResize",function($parse){return{link:function(scope,element,attr){var adjustGrid,applyAdjusment,getContainerWidth,getItemsOffset,options;return getContainerWidth=function(){return $("entities-grid").width()&&(window.containerWidth=$("entities-grid").width()),window.containerWidth},options={gridSize:$parse(attr.itemsGridResize)(scope),initialSidebarWidth:200,freeze:!0},applyAdjusment=function(offset){var sidebarOffset;return sidebarOffset=options.initialSidebarWidth+offset,$(".entities-wrapper").css({left:sidebarOffset+1}),$(".sidebar").css({width:sidebarOffset})},getItemsOffset=function(){var itemsContainerWidth;return itemsContainerWidth=Math.floor(getContainerWidth()/(options.gridSize+16))*(options.gridSize+16),getContainerWidth()-itemsContainerWidth},adjustGrid=function(){if(applyAdjusment(0),!options.freeze)return applyAdjusment(Math.floor(getItemsOffset()/2))},scope.$watch(attr.itemsGridResize,function(gridSize){return gridSize?(options.gridSize=gridSize,options.freeze=!1):options.freeze=!0,adjustGrid()}),window.onresize=function(){if(!options.freeze)return adjustGrid()}}}})}.call(this),function(){"use strict";app.directive("deleteByKey",function($document,SelectedEntities){return{link:function(scope){var canRemove,pressBackspace,pressDelete;return pressBackspace=function(keyCode){return 8===keyCode},pressDelete=function(keyCode){return 46===keyCode},canRemove=function(event){return scope.selectedEntitiesCount()&&(pressBackspace(event.keyCode)||pressDelete(event.keyCode))},$document.off("keydown.deleteByKey"),$document.on("keydown.deleteByKey",function(event){if(canRemove(event)&&"INPUT"!==event.target.tagName)return event.stopPropagation(),event.preventDefault(),scope.$remove.selected(scope.$nestedEntities,SelectedEntities)})}}})}.call(this),function(){app.directive("helpPopup",function(){return{restrict:"E",templateUrl:"scripts/directives/help-popup/help-popup.html",link:function(scope,el,attrs){return scope.hideLoader=function(){el.find(".popup-loader").hide()}}}})}.call(this),function(){app.directive("onLoad",function(){return{restrict:"A",scope:{callBack:"&onLoad"},link:function(scope,el,attrs){return el.on("load",function(){return scope.callBack()})}}})}.call(this),function(){this.app.factory("NotificationsCtrlPartial",function(events,Notifications,i18n){return function(){return this.list=Notifications.get(),this.expire=function(notification){return Notifications.expire(notification.id)},events.on(events.FOLDERS.LIST,function(promise){return promise.catch(function(){return Notifications.send(i18n.translate("errors.get_folders_failed"))})}),events.on(events.ITEMS.LIST,function(promise){return promise.catch(function(){return Notifications.send(i18n.translate("errors.get_items_failed"))})}),events.on(events.ITEMS.SEARCH,function(promise,event){return promise.catch(function(error){if("bigstock"!==event.eventTarget.name||503!==error.code)return Notifications.send(i18n.translate("errors.search_items_failed"))})}),events.on(events.ITEMS.SEARCH_BY_TAG,function(promise){return promise.catch(function(){return Notifications.send(i18n.translate("errors.get_items_by_tag_failed"))})}),events.on(events.FOLDER.CREATE,function(promise){return promise.catch(function(reason){return Notifications.send(i18n.translate("errors.create_folder_failed",reason))})}),events.on(events.FOLDER.RENAME,function(promise){return promise.catch(function(reason){return Notifications.send(i18n.translate("errors.rename_folder_failed",reason))})}),events.on(events.FOLDERS.REMOVE,function(promises){return _.forEach(promises,function(promise){return promise.catch(function(reason){return Notifications.send(i18n.translate("errors.remove_folder_failed"))})})}),events.on(events.ITEM.RENAME,function(promise){return promise.catch(function(reason){return Notifications.send(i18n.translate("errors.rename_item_failed",reason))})}),events.on(events.ITEMS.REMOVE,function(promises){return _.forEach(promises,function(promise){return promise.catch(function(reason){return Notifications.send(i18n.translate("errors.remove_item_failed"))})})}),events.on(events.ITEM.MOVE,function(promise){return promise.catch(function(reason){return Notifications.send(i18n.translate("errors.move_item_failed",reason))})}),events.on(events.ITEM.MAKE_FAVORITES,function(promise){return promise.catch(function(reason){return Notifications.send(i18n.translate("errors.make_item_favorites_failed",reason))})}),this}})}.call(this),function(){"use strict";var eventListeners;this.app.directive("fileSize",function($parse){return function(scope,el,attr){return console.log($parse(attr.fileSize)(scope))}}),eventListeners={},this.app.factory("UploadCtrlPartial",function($state,$rootScope,$timeout,mediaTypes,settings,i18n,getFileSizeLimit,editorConnection,confirm,getReadableFileSize,path){return function(adapter){var getCancelledFiles,getFailedFiles,getSucceededFiles,isFirstOpen,minimizationTimeout,redirectToPrivate,safeApply,updateProgress;return this.popupIsVisible=!1,this.totalProgressPercent=0,this.queue=[],this.adapter=adapter,this.getFilesQueue=function(_this){return function(){return _.filter(_this.queue,function(data){return data.source.file&&data.source.mediaType===settings.mediaType})}}(this),this.getFileSizeLimit=function(){return getReadableFileSize(getFileSizeLimit(settings.mediaType))},this.isFolder=function(fileToUpload){var ref,ref1,ref2,ref3;return""===(null!=(ref=fileToUpload.source)&&null!=(ref1=ref.file)?ref1.type:void 0)&&(null!=(ref2=fileToUpload.source)&&null!=(ref3=ref2.file)?ref3.size:void 0)<1e4},this.translateError=function(fileToUpload){var error,errorCode,key,message,ref,ref1,ref2;return this.isFolder(fileToUpload)?i18n.translate("uploader.upload_folder_error"):fileToUpload.error instanceof Promise.CancellationError?i18n.translate("error.upload.cancelled"):(error=fileToUpload.error||{},key="uploader."+(null!=(ref=error.data)&&null!=(ref1=ref.error_info)?ref1.key:void 0),i18n.isTranslatable(key)?i18n.translate(key,error.data.error_info.args||[]):(message="uploader.failed",errorCode=error.code||error.status,_.includes([500,406],+errorCode)&&null!=(null!=(ref2=error.data)?ref2.error_description:void 0)?i18n.translate("uploader.request_fail",[error.data.error_description.replace(/for .*$/i,"")]):(key="error.upload."+errorCode,i18n.isTranslatable(key)&&(message=key),i18n.translate(message))))},this.isMinimization=!1,minimizationTimeout=null,this.showPopup=function(_this){return function(){return _this.popupIsVisible=!0,minimizationTimeout&&$timeout.cancel(minimizationTimeout),_this.isMinimization=!1}}(this),this.hidePopup=function(_this){return function(){_this.isMinimization=!0,minimizationTimeout&&$timeout.cancel(minimizationTimeout),minimizationTimeout=$timeout(function(){return _this.isMinimization=!1,$rootScope.$apply()},550),_this.popupIsVisible=!1}}(this),getSucceededFiles=function(_this){return function(){return _.filter(_this.getFilesQueue(),function(fileToUpload){return"succeeded"===fileToUpload.status})}}(this),getFailedFiles=function(_this){return function(){return _.filter(_this.getFilesQueue(),function(fileToUpload){return"failed"===fileToUpload.status})}}(this),getCancelledFiles=function(_this){return function(){return _.filter(_this.getFilesQueue(),_this.isCancelled)}}(this),this.allFilesCount=function(){return this.getFilesQueue().length},this.succeededFilesCount=function(){return getSucceededFiles().length},this.failedFilesCount=function(){return getFailedFiles().length},this.cancelledFilesCount=function(){return getCancelledFiles().length},this.hasInProgress=function(){return!!_.find(this.getFilesQueue(),function(_this){return function(fileToUpload){return _this.isInProgress(fileToUpload)}}(this))},this.hasFailedFiles=function(){return!!_.find(this.getFilesQueue(),function(fileToUpload){return"failed"===fileToUpload.status})},this.hasAbortable=function(){return!!_.find(this.getFilesQueue(),function(fileToUpload){return fileToUpload.canAbort()})},this.hasRetryable=function(){return!!_.find(this.getFilesQueue(),function(_this){return function(fileToUpload){return fileToUpload.canRetry()&&!_this.isFolder(fileToUpload)}}(this))},this.isInProgress=function(fileToUpload){return _.includes(["waiting","uploading","processing"],fileToUpload.status)},this.isWaiting=function(fileToUpload){return"waiting"===(null!=fileToUpload?fileToUpload.status:void 0)},this.isCancelled=function(fileToUpload){return"failed"===fileToUpload.status&&fileToUpload.error instanceof Promise.CancellationError},this.canCancelUpload=function(fileToUpload){return this.isInProgress(fileToUpload)||this.isWaiting(fileToUpload)},safeApply=_.debounce(function(){if(!$rootScope.$$phase)return $rootScope.$apply()},50),redirectToPrivate=function(){if($state.current.name!=="app."+settings.uploadAdapterName)return $state.go("app."+settings.uploadAdapterName)},isFirstOpen=!0,editorConnection.on("settings",function(){return isFirstOpen=!0}),this.addFiles=function(_this){return function(files,folder){var defaultFolder,uploadFn;return uploadFn=adapter.item.upload,settings.resumableUpload&&_.includes([mediaTypes.VIDEO,mediaTypes.SECURE_VIDEO],settings.mediaType)&&(uploadFn=adapter.item.uploadResumable),redirectToPrivate(),path.setFull(settings.uploadAdapterName),_this.showPopup(),isFirstOpen=!1,defaultFolder={id:null,name:i18n.translate("private_media.all_media")},folder&&folder.can.uploadIn()||(folder=defaultFolder),settings.maxParallelUploads&&(wixmp.Uploader.maxParallelUploads=settings.maxParallelUploads),wixmp.Uploader.upload(_.map(files,function(file){var base,base1,data;return data={uploadFn:uploadFn,source:_.assign(file,{folderId:folder.id,folderName:folder.name,mediaType:settings.mediaType})},"video"!==settings.mediaType&&"secure_video"!==settings.mediaType||""===settings.videoEncodingProfile||((base=data.source).encodingOptions||(base.encodingOptions={}),data.source.encodingOptions.profile_name=settings.videoEncodingProfile),settings.useFastTranscoding&&((base1=data.source).encodingOptions||(base1.encodingOptions={}),data.source.encodingOptions.fast_transcode=!0),data})),safeApply()}}(this),this.confirmAbortAll=function(){var options;return options={queue:this.getFilesQueue(),confirmTitle:i18n.translate("uploader.cancel_all_confirmation.title"),confirmMessage:i18n.translate("uploader.cancel_all_confirmation.message"),confirmYes:i18n.translate("uploader.cancel_all_confirmation.yes"),confirmNo:i18n.translate("uploader.cancel_all_confirmation.no"),confirm:function(){return _.forEach(options.queue,function(fileToUpload){return fileToUpload.abort()})}},confirm(options),!1},this.retryAll=function(){return _.forEach(this.getFilesQueue(),function(fileToUpload){if(fileToUpload.canRetry())return fileToUpload.signUpForRetry()})},this.getReadableFileSize=function(fileSize){return getReadableFileSize(fileSize)},updateProgress=function(_this){return function(){var bytesTotal,bytesTotalUploaded,files,status;return files=_this.getFilesQueue(),bytesTotalUploaded=_.sum(_.map(files,function(fileToUpload){return fileToUpload.bytesLoaded})),bytesTotal=_.sum(_.map(files,function(fileToUpload){return fileToUpload.source.file.size})),_this.totalProgressPercent=Math.round(100*bytesTotalUploaded/bytesTotal),status=100===_this.totalProgressPercent?"processing":"uploading",_.every(files,function(file){return"succeeded"===file.status})&&(status="succeeded"),editorConnection.emit("uploadProcessProgress",{data:{loaded:bytesTotalUploaded,status:status,total:bytesTotal},source:adapter.name}),"succeeded"===status&&editorConnection.emit("uploadProcessComplete",{data:{files:files,loaded:bytesTotalUploaded,status:status,total:bytesTotal},source:adapter.name}),_this.totalProgressPercent}}(this),_.mapKeys(eventListeners,function(listener,event){return wixmp.Uploader.off(event,listener)}),wixmp.Uploader.on("fileStatusChanged",function(_this){return function(data){return _this.queue.length||(_this.queue=data.queue),updateProgress(),safeApply()}}(this)),wixmp.Uploader.on("queueChanged",function(_this){return function(queue){return _this.queue=queue,updateProgress()}}(this)),this}})}.call(this),function(){"use strict";this.app.factory("HelpCtrlPartial",function($sce,i18n){return function(){return this.popupIsVisible=!1,this.showPopup=function(){return this.popupIsVisible=!0},this.hidePopup=function(){return this.popupIsVisible=!1},this.url=$sce.trustAsResourceUrl(i18n.translate("help_url")),this}})}.call(this),function(){"use strict";this.app.factory("RemoveCtrlPartial",function(Folder,confirm,i18n){return function($scope){return this.selected=function(entities,selectedEntities){var currentSelectedEntities,entitiesCount,isInSiteMedia,options;return!!(entitiesCount=$scope.selectedEntitiesCount())&&(!((isInSiteMedia=_.some(entities.list,function(item){return item.isInSiteMedia}))&&(currentSelectedEntities=selectedEntities.get(),currentSelectedEntities=_.filter(currentSelectedEntities,function(entity){return!entity.readOnly}),!currentSelectedEntities.length))&&(options={confirmYes:i18n.translate("private_media.remove_confirmation.yes"),confirmNo:i18n.translate("private_media.remove_confirmation.no"),confirm:function(){return entities.removeSelected()}},isInSiteMedia?(options.confirmYes=i18n.translate("private_media.site_media.remove"),options.confirmTitle=i18n.translate("private_media.site_media.remove_confirmation.item.title"),options.confirmMessage=entitiesCount>1?i18n.translate("private_media.site_media.remove_confirmation.items.message",[entitiesCount]):i18n.translate("private_media.site_media.remove_confirmation.item.message")):entitiesCount>1?(options.confirmTitle=i18n.translate("private_media.remove_confirmation.items.title"),options.confirmMessage=i18n.translate("private_media.remove_confirmation.items.message",[entitiesCount])):(options.confirmTitle=i18n.translate("private_media.remove_confirmation.item.title"),options.confirmMessage=i18n.translate("private_media.remove_confirmation.item.message")),confirm(options),!1))},
this.one=function(entity){var options;return options={confirmYes:i18n.translate("private_media.remove_confirmation.yes"),confirmNo:i18n.translate("private_media.remove_confirmation.no"),confirm:function(){return entity.remove()}},entity.isInSiteMedia?(options.confirmYes=i18n.translate("private_media.site_media.remove"),options.confirmTitle=i18n.translate("private_media.site_media.remove_confirmation.item.title"),options.confirmMessage=i18n.translate("private_media.site_media.remove_confirmation.item.message")):entity instanceof Folder?(options.confirmTitle=i18n.translate("private_media.remove_confirmation.folder.title"),options.confirmMessage=i18n.translate("private_media.remove_confirmation.folder.message")):(options.confirmTitle=i18n.translate("private_media.remove_confirmation.item.title"),options.confirmMessage=i18n.translate("private_media.remove_confirmation.item.message")),confirm(options),!1},this.folder=function(folder){return confirm({confirmTitle:i18n.translate("private_media.remove_confirmation.folder.title"),confirmMessage:i18n.translate("private_media.remove_confirmation.folder.message"),confirmYes:i18n.translate("private_media.remove_confirmation.yes"),confirmNo:i18n.translate("private_media.remove_confirmation.no"),confirm:function(){return folder.remove()}}),!1},this}})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app",{url:"",templateUrl:"scripts/pages/app.html",controller:"appCtrl",resolve:{settings:function(Settings){return Settings.isLoaded},locales:function(LoadLocales,settings){return LoadLocales(settings).then(function(res){var ref;return null!=(ref=_this.appLoadNotifiers)&&ref.translationsLoaded(),res})}}})}}(this)),this.app.controller("appCtrl",function($document,$q,$scope,$state,$rootScope,SelectedEntities,Notifications,NotificationsCtrlPartial,FilterCtrlPartial,UploadCtrlPartial,HelpCtrlPartial,RemoveCtrlPartial,events,settings,editorConnection,submitItems,tabs,i18n,perfMarks,performance,biReport,biFirst){var canTrackAppLoaded,isFirstAppLoadedTrack,lookupScope;return canTrackAppLoaded=!0,isFirstAppLoadedTrack=biFirst("MMLoaded"),$scope.trackAppLoaded=function(){if(canTrackAppLoaded)return performance.mark(perfMarks.LOAD_END),biReport("MMLoaded",{loadingTime:Math.round(performance.getDurationBetweenMarks(perfMarks.LOAD_START,perfMarks.LOAD_END)),media_type:settings.mediaType,session_id:window.sessionId,site_id:window.siteId,tab_name:settings.path.split("/")[0],isFirst:isFirstAppLoadedTrack.get()},"media-mr"),isFirstAppLoadedTrack.set(!1),canTrackAppLoaded=!1},editorConnection.on("settings",function(){return canTrackAppLoaded=!0}),$scope.settings=settings,$scope.tabs=tabs,$scope.selectedEntitiesCount=function(){return SelectedEntities.size},$scope.isActiveTab=function(tab){return $state.includes(tab.state)},$scope.closeWindow=function(){return $document.off("keyup"),editorConnection.emit("close")},settings.closeWindowOnEscape&&$document.on("keyup",function(ev){if(27===ev.keyCode)return $scope.closeWindow()}),$scope.$searchQuery={query:"",currentQuery:""},$scope.$layouts=new FilterCtrlPartial("layout-grid",[{id:"layout-grid",name:"grid",itemWidth:126},{id:"layout-grid-large",name:"large grid",itemWidth:220},{id:"layout-list",name:"list",itemWidth:null}]),$scope.$notifications=new NotificationsCtrlPartial,tabs[settings.uploadAdapterName].canShow()&&($scope.$upload=new UploadCtrlPartial(tabs[settings.uploadAdapterName].getAdapter())),$scope.$help=new HelpCtrlPartial,$scope.$remove=new RemoveCtrlPartial($scope),$scope.canSubmitItems=function(){return!(SelectedEntities.size>1&&"single"===settings.selectionType)&&(!_.any(SelectedEntities.get(),function(item){var base;return!("function"==typeof(base=item.can).submit?base.submit():void 0)})&&SelectedEntities.size>0)},$scope.submitItemsTooltip=function(){return $scope.canSubmitItems()?"":"single"===settings.selectionType?i18n.translate("selected_items.tooltip_error_empty"):i18n.translate("selected_items.tooltip_error_multiple")},$scope.descriptionTranslationKey="private_media.upload_restrictions_header_message",$scope.footerSubmitTranslationKey="footer.submit",lookupScope=function(scope,attrName){if(null!=scope)return scope[attrName]?scope[attrName]:lookupScope(scope.$parent,attrName)},$scope.selectAndSubmitItem=function(item){var base;if(item.can.submit())return SelectedEntities.clear(),SelectedEntities.add(item),"function"==typeof(base=lookupScope(this,"submitItems"))?base():void 0},$scope.submitItems=function(){if($scope.canSubmitItems())return submitItems(_.filter(SelectedEntities.get(),function(item){return item.can.submit()}))},$scope.$on("$stateChangeSuccess",function(){return SelectedEntities.clear()})})}.call(this),function(){"use strict";this.app.config(function($stateProvider){return $stateProvider.state("init",{url:"/init/{settings:.*}",controller:"initCtrl"})}),this.app.controller("initCtrl",function($scope,$stateParams,$state,Settings){var logger;return logger=new Logger("initCtrl"),logger.log("settings received",$stateParams.settings),Settings.reload(JSON.parse(decodeURIComponent(encodeURIComponent($stateParams.settings))))})}.call(this),function(){"use strict";this.app.factory("favoritable",function(SelectedEntities){return function(controller,adapter,getParentFolder){var _events,makeFavoritesCount;return _events=adapter.events,makeFavoritesCount=0,_events.on(_events.ITEM.MAKE_FAVORITES,function(_this){return function(promise){return makeFavoritesCount++,promise.then(function(){if(!--makeFavoritesCount&&"favorites"===("function"==typeof getParentFolder?getParentFolder().type:void 0))return controller.load()})}}()),_events.on(_events.ITEM.UMMAKE_FAVORITES,function(_this){return function(promise){return promise.then(function(res){if("favorites"===("function"==typeof getParentFolder?getParentFolder().type:void 0))return _.remove(controller.list,function(entity){var ref;return entity.id===(null!=(ref=res.data)?ref.id:void 0)}),SelectedEntities.clear()})}}())}})}.call(this),function(){"use strict";this.app.factory("folderCreatable",function(ActionCtrlPartial,Notifications,i18n){return function(controller,adapter,getParentFolder){return controller.$createFolder=new ActionCtrlPartial(function(name){var ref;return 0===$.trim(name).length?Notifications.send(i18n.translate("errors.create_folder_failed.empty_name")):$.trim(name).length>256?Notifications.send(i18n.translate("errors.create_folder_failed.long_name")):adapter.folder.create(name,{parentId:"function"==typeof getParentFolder&&null!=(ref=getParentFolder())?ref.id:void 0})}),controller.$createFolder.show=_.flow(controller.$createFolder.show,function(_this){return function(){return controller.$createFolder.newName=""}}()),adapter.events.on(adapter.events.FOLDER.CREATE,function(_this){return function(promise){return promise.then(function(res){var parentId,ref,ref1,unsorted;if(!_.includes(["unsorted","allMedia","favorites","purchased"],"function"==typeof getParentFolder&&null!=(ref=getParentFolder())?ref.type:void 0))return parentId="function"==typeof getParentFolder&&null!=(ref1=getParentFolder())?ref1.id:void 0,parentId||(unsorted=_.find(controller.list,function(folder){return"unsorted"===folder.type}),parentId=null!=unsorted?unsorted.id:void 0),res.data.parentId!==parentId&&parentId?void 0:controller.list.unshift(res.data)})}}())}})}.call(this),function(){"use strict";this.app.factory("movable",function(SelectedEntities,Folder){return function(controller,adapter,getParentFolder){var _events,affectedFoldersIds,movingCount;return controller.moveSelectedToFolder=function(folder){return SelectedEntities.forEach(function(entity){var base;if("function"==typeof(base=entity.can).move?base.move():void 0)return entity instanceof Folder?folder.moveFolderIn(entity):folder.moveItemIn(entity)}),SelectedEntities.clear()},movingCount=0,affectedFoldersIds=[],_events=adapter.events,_events.on([_events.ITEM.MOVE,_events.FOLDER.MOVE],function(_this){return function(promise,event){return affectedFoldersIds.push(event.arguments[0].parentId||event.arguments[0].folderId),affectedFoldersIds.push(event.arguments[1].parentId||event.arguments[1].folderId),movingCount++,promise.then(function(){var ref,unsorted;if(!--movingCount)return unsorted=_.find(controller.list,function(folder){return"unsorted"===(null!=folder?folder.type:void 0)}),_.includes(affectedFoldersIds,("function"==typeof getParentFolder&&null!=(ref=getParentFolder())?ref.id:void 0)||(null!=unsorted?unsorted.id:void 0))&&controller.reload(),affectedFoldersIds.length=0})}}())}})}.call(this),function(){"use strict";this.app.factory("removable",function(SelectedEntities,Folder,Item){return function(controller,adapter,getParentFolder){var _events,isReadOnly,isSiteOwner;return isReadOnly=function(entity){return entity.readOnly},isSiteOwner=function(entity){return entity.isSiteOwner},controller.removeSelected=function(_this){return function(){var folders,foldersIds,items,itemsIds,ref,ref1;if(items=_.filter(SelectedEntities.get(),function(entity){return entity instanceof Item&&(isSiteOwner(entity)||!isReadOnly(entity))}),folders=_.filter(SelectedEntities.get(),function(entity){return entity instanceof Folder}),itemsIds=_.pluck(items,"id"),foldersIds=_.pluck(folders,"id"),"trash"===("function"==typeof getParentFolder&&null!=(ref=getParentFolder())?ref.type:void 0)){if(items.length&&adapter.items.trash.remove(itemsIds),folders.length)return adapter.folders.trash.remove(foldersIds)}else if("siteMedia"===("function"==typeof getParentFolder&&null!=(ref1=getParentFolder())?ref1.type:void 0)){if(items.length)return adapter.items.siteMedia.remove(itemsIds)}else if(items.length&&adapter.items.remove(itemsIds),folders.length)return adapter.folders.remove(foldersIds)}}(),_events=adapter.events,_events.on([_events.ITEMS.SITE_MEDIA.REMOVE],function(_this){return function(promise){return promise.then(function(res){return _.remove(controller.list,function(entity){return _.some(res.data.itemIds,function(id){return id===entity.id})}),SelectedEntities.clear()})}}()),_events.on([_events.ITEMS.REMOVE,_events.ITEMS.TRASH.REMOVE,_events.ITEMS.TRASH.RESTORE,_events.FOLDERS.REMOVE,_events.FOLDERS.TRASH.REMOVE,_events.FOLDERS.TRASH.RESTORE],function(_this){return function(promises){return _.forEach(promises,function(promise){return promise.then(function(res){var ref;if(_.remove(controller.list,function(entity){return entity.id===res.data.id}),SelectedEntities.clear(),(null!=(ref=controller.selectedFolder)?ref.id:void 0)===res.data.id)return"function"==typeof controller.selectFolder?controller.selectFolder(controller.list[0]):void 0})})}}())}})}.call(this),function(){"use strict";this.app.factory("renamable",function(ActionCtrlPartial,Notifications,Folder,i18n){return function(controller,adapter){return controller.$rename=new ActionCtrlPartial(function(entity,newName){var entityType;return entityType=entity instanceof Folder?"folder":"item",0===$.trim(newName).length?Notifications.send(i18n.translate("errors.rename_"+entityType+"_failed.empty_name")):$.trim(newName).length>256?Notifications.send(i18n.translate("errors.rename_"+entityType+"_failed.long_name")):entity.rename(newName)}),controller.$rename.show=_.flow(controller.$rename.show,function(entity){return controller.$rename.newName=entity.name})}})}.call(this),function(){"use strict";this.app.factory("transcodable",function(){return function(controller,adapter){var _events,transcodeItems,waitForTranscoding;return waitForTranscoding=function(){var ref;return null!=(ref=adapter.blackArrow)?ref.open():void 0},transcodeItems=function(_this){return function(response){var needTranscoding;if(needTranscoding=_.filter(response.data,function(entity){var base;return("function"==typeof(base=entity.can).transcode?base.transcode():void 0)&&!entity.isTranscoded()}),needTranscoding.length>0)return waitForTranscoding()}}(),_events=adapter.events,_events.on([_events.ITEMS.LIST,_events.ITEMS.SEARCH,_events.ITEMS.TRASH.LIST],function(_this){return function(promise){return promise.then(transcodeItems)}}()),wixmp.Uploader.on("uploadQueueStarted",function(_this){return function(){if(adapter.can.item.transcode())return waitForTranscoding()}}())}})}.call(this),function(){"use strict";this.app.factory("updatable",function(){return function(controller,adapter){var _events;return _events=adapter.events,_events.on([_events.ITEM.UPDATE,_events.FOLDER.UPDATE],function(_this){return function(promise){return promise.then(function(res){var dataForUpdate,updatedEntity;if(updatedEntity=_.find(controller.list,function(entity){return entity.id===res.data.id}))return dataForUpdate={},_.each(res.data,function(val,key){if(null!=val&&"id"!==key)return dataForUpdate[key]=val}),_.assign(updatedEntity,dataForUpdate)})}}())}})}.call(this),function(){"use strict";this.app.factory("ActionCtrlPartial",function($q,LoadingHelper,RejectError){return function(runAction){var currentEntity,currentProcessing,loader;return currentProcessing=void 0,currentEntity=void 0,loader=new LoadingHelper(this),this.isProcessing=function(entity){return currentProcessing===entity},this.isVisible=function(entity){return currentEntity===entity},this.hide=function(){return currentEntity=void 0},this.show=function(entity){return currentEntity=entity},this.runOrHide=function(entity,newName){var args;return args=_.filter(_.map(arguments)),newName?this.run.apply(this,args):this.hide.apply(this,args)},this.run=function(){return null==currentEntity?$q.reject(new RejectError(RejectError.noActionSubject,"ActionCtrl")):null!=currentProcessing?$q.reject(new RejectError(RejectError.alreadyLoading,"ActionCtrl")):loader.isDeniedByInterval()?$q.reject(new RejectError(RejectError.tooShortCallInterval,"ActionCtrl")):loader.attach($q.when(runAction.apply(this,arguments)).then(function(){return currentEntity=void 0,currentProcessing=void 0},function(){return currentProcessing=void 0}))},this}})}.call(this),function(){"use strict";this.app.factory("EntitiesCtrlPartial",function($q,SelectedEntities,LoadingHelper,RejectError,Folder,biUiEvents,editorConnection){var itemsPerPage;return itemsPerPage=50,function(adapter,$searchQuery,getParentFolder,loadEntities,searchEntities){var addEntitiesToScope,loadList,loadOrSearch,loadUnlessCount,loader,oldParentFolder,search;return this.list=null,this.selectedFolder=null,this.isLoading=!1,loader=new LoadingHelper(this),oldParentFolder=null,addEntitiesToScope=function(_this){return function(list){if(oldParentFolder===("function"==typeof getParentFolder?getParentFolder():void 0))return _this.list||(_this.list=[]),_.forEach(list.data,function(entity){if(!_.findWhere(_this.list,{id:entity.id}))return _this.list.push(entity)}),list}}(this),loadList=function(isFirstPage){return null==isFirstPage&&(isFirstPage=!0),null==loadEntities?$q.reject(new RejectError(RejectError.noMethod,"EntitiesCtrl.loadEntities")):loadEntities(isFirstPage)},search=function(isFirstPage){return null==isFirstPage&&(isFirstPage=!0),null==searchEntities?$q.reject(new RejectError(RejectError.noMethod,"EntitiesCtrl.searchEntities")):searchEntities($searchQuery.query,isFirstPage).then(function(response){return biUiEvents("search.performed",{found:response.data.length,query:$searchQuery.query}),response})},loadUnlessCount=function(loadData,isFirstPage,response){return loadData(isFirstPage).then(function(currentResponse){var ref;return currentResponse.data=((null!=response?response.data:void 0)||[]).concat(currentResponse.data||[]),currentResponse.data.length>=itemsPerPage||!(null!=(ref=currentResponse.paging)?ref.cursor:void 0)?currentResponse:loadUnlessCount(loadData,!1,currentResponse)},function(error){return response||$q.reject(error)})},loadOrSearch=function(_this){return function(isFirstPage,isReload){var loadData,promise;return null==isFirstPage&&(isFirstPage=!0),null==isReload&&(isReload=!1),_this.isLoading?$q.reject(new RejectError(RejectError.alreadyLoading,"EntitiesCtrl")):loader.isDeniedByInterval()&&oldParentFolder===("function"==typeof getParentFolder?getParentFolder():void 0)?$q.reject(new RejectError(RejectError.tooShortCallInterval,"EntitiesCtrl")):(oldParentFolder="function"==typeof getParentFolder?getParentFolder():void 0,isFirstPage&&(SelectedEntities.clear(),_this.list=null,isReload||(_this.selectedFolder=null)),loadData=$searchQuery.query&&searchEntities?search:loadList,promise=loader.attach(loadUnlessCount(loadData,isFirstPage).then(addEntitiesToScope)),isReload&&promise.then(function(data){return _this.selectedFolder?(_this.selectedFolder=_.find(_this.list,function(entity){return _this.selectedFolder.id===entity.id}),data):data}),promise)}}(this),this.nameById=function(_this){return function(id){var item;return item=_.find(_this.list,function(item){return item.id===id}),null!=item?item.name:void 0}}(this),this.load=function(_this){return function(){return loadOrSearch(!0)}}(),this.more=function(_this){return function(){return loadOrSearch(!1)}}(),this.reload=function(_this){return function(){return loadOrSearch(!0,!0)}}(),this.selectFolder=function(_this){return function(folder){return $searchQuery.currentQuery||($searchQuery.query=""),_this.selectedFolder=folder}}(this),this.isFolder=function(_this){return function(entity){return entity instanceof Folder}}(),editorConnection.on("reloadItems",this.load),this}})}.call(this),function(){this.app.factory("FilterCtrlPartial",function(){return function(defaultId,list){var defaultEntity;return this.selected=null,this.list=list,this.select=function(_this){return function(entity){return _this.selected=entity}}(this),defaultEntity=_.find(this.list,function(entity){return defaultId===entity.id}),this.select(defaultEntity||null),this}})}.call(this),function(){"use strict";this.app.factory("baseCtrl",function($q,EntitiesCtrlPartial,FilterCtrlPartial,Folder,settings,i18n,editorConnection,path,paginatedItemsListLoader,paginatedItemsSearchLoader){return function($scope,adapter){var getDefaultFolder,getDefaultNestedFolder,getSortOptions,initializationPath,isChildFolderSelectedAtPath,isPathWasSet,loadEntities,loadFolders,loadItems,loadNestedFolders,makeFoldersFirst,searchItems,sortNestedFolders,updatePath;return $scope.adapter=adapter,initializationPath=_.clone(path.get()),isPathWasSet=!1,updatePath=function(){var currentPath;return currentPath=[],_.forEach($scope.selectedFoldersPath,function(folder){return!!((null!=folder?folder.id:void 0)||(null!=folder?folder.virtualId:void 0))&&(currentPath.push(folder.id||folder.virtualId),!0)}),path.set(currentPath)},$scope.selectedFoldersPath=[],isChildFolderSelectedAtPath=function(){return!!initializationPath[$scope.selectedFoldersPath.length]},getDefaultFolder=function(){var folderId;if(folderId=initializationPath[0])return _.find($scope.$folders.list,function(folder){return folder.id===folderId||null!=folder.virtualId&&folder.virtualId===folderId})},loadFolders=function(){return adapter.folders.list().catch(function(reason){if(401===reason.code)return editorConnection.emit("notauthorized")})},$scope.$folders=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,null,loadFolders),$scope.$folders.sortOrder=function(folder){return folder.isVirtual?"0"+folder.name:"1"+folder.name},$scope.$folders.load=_.flow($scope.$folders.load,function(promise){return promise.then(function(res){var defaultFolder;return defaultFolder=isPathWasSet?$scope.$folders.list[0]:getDefaultFolder()||$scope.$folders.list[0],$scope.$folders.selectFolder(defaultFolder),res})}),$scope.$folders.selectFolder=_.flow($scope.$folders.selectFolder,function(){return $scope.selectedFoldersPath=[$scope.$folders.selectedFolder],updatePath(),$scope.$nestedEntities.load()}),$scope.selectFolderOrNested=function(folder){var isNested,position;return position=$scope.selectedFoldersPath.indexOf(folder),isNested=position>=1,$scope.selectedFoldersPath.length=position,isNested?$scope.$nestedEntities.selectFolder(folder):$scope.$folders.selectFolder(folder)},$scope.getSelectedFolder=function(){return _.last($scope.selectedFoldersPath)},getDefaultNestedFolder=function(){var folderId;if(folderId=initializationPath[$scope.selectedFoldersPath.length])return _.find($scope.$nestedEntities.list,function(folder){return folder.id===folderId||null!=folder.virtualId&&folder.virtualId===folderId})},sortNestedFolders=function(list){var sortOrder;return sortOrder=$scope.$nestedEntities.sortOrder.selected.data,list.data=_.sortBy(list.data,sortOrder.attrName),"desc"===sortOrder.direction&&list.data.reverse(),list},makeFoldersFirst=function(list){return list.data=_.sortBy(list.data,function(entity){return entity instanceof Folder?0:1}),list},getSortOptions=function(){return{sort:$scope.$nestedEntities.sortOrder.selected.data}},loadItems=paginatedItemsListLoader(adapter,$scope.getSelectedFolder,getSortOptions),searchItems=paginatedItemsSearchLoader(adapter,$scope.getSelectedFolder,getSortOptions),loadNestedFolders=function(){var ref;return null!=(ref=$scope.getSelectedFolder())?ref.foldersList().then(function(list){return!isPathWasSet&&getDefaultNestedFolder()&&$scope.$nestedEntities.selectFolder(getDefaultNestedFolder()),sortNestedFolders(list)}):void 0},loadEntities=function(isFirstPage){var deferred,list,promises,unresolvedCount;return promises=[],settings.hasSubfolders&&isFirstPage&&!_.includes(["unsorted","allMedia","favorites","purchased"],"function"==typeof $scope.getSelectedFolder?$scope.getSelectedFolder().type:void 0)&&promises.push(loadNestedFolders()),isChildFolderSelectedAtPath()||promises.push(loadItems(isFirstPage)),list={data:[]},deferred=$q.defer(),unresolvedCount=0,_.forEach(promises,function(promise){return unresolvedCount++,promise.then(function(currentList){return list.data=list.data.concat(currentList.data),currentList}).then(function(){if(!--unresolvedCount)return deferred.resolve(makeFoldersFirst(list))},function(){if(!--unresolvedCount)return deferred.resolve(makeFoldersFirst(list))})}),deferred.promise},$scope.$nestedEntities=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,$scope.getSelectedFolder,loadEntities,searchItems),$scope.$nestedEntities.selectFolder=_.flow($scope.$nestedEntities.selectFolder,function(folder){return $scope.selectedFoldersPath.push(folder),updatePath(),$scope.$nestedEntities.load()}),$scope.$nestedEntities.sortOrder=new FilterCtrlPartial("date_desc",[{id:"name_asc",name:i18n.translate("sort_order.name_asc"),data:{order:"name",attrName:"name",direction:"asc"}},{id:"name_desc",name:i18n.translate("sort_order.name_desc"),data:{order:"name",attrName:"name",direction:"desc"}},{id:"date_desc",name:i18n.translate("sort_order.date_desc"),data:{order:"date",attrName:"createdAt",direction:"desc"}},{id:"date_asc",name:i18n.translate("sort_order.date_asc"),data:{order:"date",attrName:"createdAt",direction:"asc"}}]),$scope.$nestedEntities.load=_.flow($scope.$nestedEntities.load,function(promise){return promise.catch(function(reason){if(401===reason.code)return editorConnection.emit("notauthorized")})}),$scope.$nestedEntities.sortOrder.select=_.flow($scope.$nestedEntities.sortOrder.select,function(){return $scope.$nestedEntities.load()}),function(){return $scope.$folders.load().then(function(){return isPathWasSet=!0})}}})}.call(this),function(){"use strict";this.app.config(function($stateProvider){return $stateProvider.state("app.empty",{url:"/empty",templateUrl:"scripts/pages/empty/empty.html",controller:"emptyCtrl",resolve:{adapter:function(tabs){return tabs.empty.getAdapter()}}})}),this.app.controller("emptyCtrl",function(_this){return function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.emptyStateLoaded():void 0}}(this))}.call(this),function(){"use strict";var eventListeners;eventListeners={},this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.private",{url:"/private",templateUrl:"scripts/pages/private/private.html",controller:"privateCtrl",resolve:{notify:function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.tabSelected():void 0},adapter:function(tabs){return tabs.private.getAdapter()}}})}}(this)),this.app.controller("privateCtrl",function($scope,$state,$sce,$q,SelectedEntities,Folder,Item,adapter,baseCtrl,i18n,settings,editorConnection,path,updatable,transcodable,renamable,removable,movable,folderCreatable,favoritable,biMeasureImageLoadSpeed,TestWebsocket){var affectedWithUploadFoldersIds,canRefreshAfterUpload,clearSearchQuery,foldersNames,init,isSearch,isSomeFileUploaded,onFileStatusChanged,onUploadQueueFinished,onUploadQueueStarted,siteMediaTooltipLink,url;return init=baseCtrl($scope,adapter),$scope.measureImagesLoadSpeed=biMeasureImageLoadSpeed,$scope.selectedEntities=SelectedEntities,$scope.isSomeRemovable=function(){return _.some(SelectedEntities.get(),function(entity){return entity.can.removeFromFolder()||entity.can.remove()})},$scope.deleteButtonText=function(){var ref;return"siteMedia"===(null!=(ref=$scope.getSelectedFolder())?ref.type:void 0)?"private_media.site_media.remove":"private_media.remove_items"},$scope.isSelectedSiteMediaFolder=function(){var ref;return"siteMedia"===(null!=(ref=$scope.getSelectedFolder())?ref.type:void 0)},foldersNames={},$scope.getFolderNameById=function(id){return foldersNames[id]},updatable($scope.$folders,adapter),renamable($scope.$folders,adapter),removable($scope.$folders,adapter,null),movable($scope.$folders,adapter,null),folderCreatable($scope.$folders,adapter,null),$scope.$folders.sortOrder=function(folder){return"allMedia"===folder.type?"0":"siteMedia"===folder.type?"1":"trash"===folder.type?"3":folder.isVirtual?"2"+folder.name:"4"+folder.name},$scope.getAllFolder=function(){return _.findWhere($scope.$folders.list,{type:"allMedia"})},$scope.getUnsorted=function(){return _.find($scope.$folders.list,function(folder){return"unsorted"===folder.type})},url=$sce.trustAsResourceUrl(i18n.translate("help_contributors_url")),siteMediaTooltipLink='<a href="'+url+'" target="_blank">'+i18n.translate("private_media.site_media.tooltip.link")+"</a>",$scope.siteMediaTooltip=i18n.translate("private_media.site_media.tooltip.text",[siteMediaTooltipLink]),$scope.isSiteMediaFolder=function(folder){return"siteMedia"===folder.id},updatable($scope.$nestedEntities,adapter),transcodable($scope.$nestedEntities,adapter),renamable($scope.$nestedEntities,adapter),removable($scope.$nestedEntities,adapter,$scope.getSelectedFolder),movable($scope.$nestedEntities,adapter,$scope.getSelectedFolder),folderCreatable($scope.$nestedEntities,adapter,$scope.getSelectedFolder),favoritable($scope.$nestedEntities,adapter,$scope.getSelectedFolder),adapter.events.on(adapter.events.FOLDERS.LIST,function(promise){return promise.then(function(res){return _.forEach(res.data,function(folder){return foldersNames[folder.id]=folder.name})})}),adapter.events.on([adapter.events.FOLDER.UPDATE,adapter.events.FOLDER.CREATE],function(promise){return promise.then(function(res){return foldersNames[res.data.id]=res.data.name})}),isSomeFileUploaded=function(){return _.some($scope.$upload.queue,function(fileToUpload){return"succeeded"===fileToUpload.status})},isSearch=function(){return!!$scope.$searchQuery.query},clearSearchQuery=function(){return $scope.$searchQuery.query="",$scope.$searchQuery.currentQuery=""},affectedWithUploadFoldersIds=[],canRefreshAfterUpload=function(){var ref,ref1,ref2;return _.includes(["allMedia","siteMedia"],null!=(ref=$scope.getSelectedFolder())?ref.type:void 0)||_.includes(affectedWithUploadFoldersIds,null!=(ref1=$scope.getSelectedFolder())?ref1.id:void 0)&&!_.includes(["favorites","purchased","trash"],null!=(ref2=$scope.getSelectedFolder())?ref2.type:void 0)},onUploadQueueStarted=function(){if(_.includes(["video","secure_video"],settings.mediaType))return $scope.$upload.showPopup()},onUploadQueueFinished=function(){if(isSomeFileUploaded()&&canRefreshAfterUpload())return isSearch()&&clearSearchQuery(),$scope.$nestedEntities.load().then(function(){return SelectedEntities.clear(),SelectedEntities.add(_.find($scope.$nestedEntities.list,function(entity){return entity instanceof Item}))})},onFileStatusChanged=function(_this){return function(progress){var item,itemData,ref;if("succeeded"===progress.currentFileProgress.status){if(itemData=progress.currentFileProgress.file.serverResponse.data,itemData.mediaType!==settings.mediaType)return;if(_.includes(affectedWithUploadFoldersIds,itemData.folderId)||affectedWithUploadFoldersIds.push(itemData.folderId),item=new Item(adapter,itemData),isSearch())return clearSearchQuery(),$scope.$nestedEntities.load();if(item.folderId===(null!=(ref=$scope.getSelectedFolder())?ref.id:void 0)||canRefreshAfterUpload())return $scope.$nestedEntities.list.unshift(item)}}}(),_.mapKeys(eventListeners,function(listener,event){return wixmp.Uploader.off(event,listener)}),wixmp.Uploader.on("uploadQueueStarted",onUploadQueueStarted),eventListeners.uploadQueueStarted=onUploadQueueStarted,wixmp.Uploader.on("uploadQueueFinished",onUploadQueueFinished),eventListeners.uploadQueueFinished=onUploadQueueFinished,wixmp.Uploader.on("fileStatusChanged",onFileStatusChanged),eventListeners.fileStatusChanged=onFileStatusChanged,adapter.events.on(adapter.events.FOLDERS.TRASH.RESTORE,function(_this){return function(promises){return $q.all(promises).finally(function(){return $scope.$folders.reload()})}}()),adapter.events.on(adapter.events.FOLDERS.REMOVE,function(_this){return function(promises){return $q.all(promises).finally(function(){if(1===$scope.selectedFoldersPath.length&&"trash"===$scope.selectedFoldersPath[0].type)return $scope.$nestedEntities.load()})}}()),(settings.blackArrowTests||"debug"===settings.mode)&&TestWebsocket(adapter,settings),init()})}.call(this),function(){"use strict";var eventListeners;eventListeners={},this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.platform",{url:"/platform",templateUrl:"scripts/pages/platform/platform.html",controller:"platformCtrl",resolve:{notify:function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.tabSelected():void 0},adapter:function(tabs){return tabs.platform.getAdapter()}}})}}(this)),this.app.controller("platformCtrl",function($scope,$state,$sce,$q,SelectedEntities,Folder,Item,adapter,baseCtrl,i18n,settings,editorConnection,path,updatable,transcodable,renamable,removable,movable,folderCreatable,favoritable){var affectedWithUploadFoldersIds,canRefreshAfterUpload,clearSearchQuery,foldersNames,init,isSearch,isSomeFileUploaded,onFileStatusChanged,onUploadQueueFinished,onUploadQueueStarted,siteMediaTooltipLink,url;return init=baseCtrl($scope,adapter),$scope.selectedEntities=SelectedEntities,$scope.isSomeRemovable=function(){return _.some(SelectedEntities.get(),function(entity){return entity.can.removeFromFolder()||entity.can.remove()})},$scope.deleteButtonText=function(){var ref;return"siteMedia"===(null!=(ref=$scope.getSelectedFolder())?ref.type:void 0)?"private_media.site_media.remove":"private_media.remove_items"},$scope.showNoEntitiesDescriptionLink=function(){return!1},foldersNames={},$scope.getFolderNameById=function(id){return foldersNames[id]},updatable($scope.$folders,adapter),renamable($scope.$folders,adapter),removable($scope.$folders,adapter,null),movable($scope.$folders,adapter,null),folderCreatable($scope.$folders,adapter,null),$scope.$folders.sortOrder=function(folder){return"allMedia"===folder.type?"0":"siteMedia"===folder.type?"1":"trash"===folder.type?"3":folder.isVirtual?"2"+folder.name:"4"+folder.name},$scope.getAllFolder=function(){return _.findWhere($scope.$folders.list,{type:"allMedia"})},$scope.getUnsorted=function(){return _.find($scope.$folders.list,function(folder){return"unsorted"===folder.type})},url=$sce.trustAsResourceUrl(i18n.translate("help_contributors_url")),siteMediaTooltipLink='<a href="'+url+'" target="_blank">'+i18n.translate("private_media.site_media.tooltip.link")+"</a>",$scope.siteMediaTooltip=i18n.translate("private_media.site_media.tooltip.text",[siteMediaTooltipLink]),$scope.isSiteMediaFolder=function(folder){
return"siteMedia"===folder.id},updatable($scope.$nestedEntities,adapter),transcodable($scope.$nestedEntities,adapter),renamable($scope.$nestedEntities,adapter),removable($scope.$nestedEntities,adapter,$scope.getSelectedFolder),movable($scope.$nestedEntities,adapter,$scope.getSelectedFolder),folderCreatable($scope.$nestedEntities,adapter,$scope.getSelectedFolder),favoritable($scope.$nestedEntities,adapter,$scope.getSelectedFolder),adapter.events.on(adapter.events.FOLDERS.LIST,function(promise){return promise.then(function(res){return _.forEach(res.data,function(folder){return foldersNames[folder.id]=folder.name})})}),adapter.events.on([adapter.events.FOLDER.UPDATE,adapter.events.FOLDER.CREATE],function(promise){return promise.then(function(res){return foldersNames[res.data.id]=res.data.name})}),isSomeFileUploaded=function(){return _.some($scope.$upload.queue,function(fileToUpload){return"succeeded"===fileToUpload.status})},isSearch=function(){return!!$scope.$searchQuery.query},clearSearchQuery=function(){return $scope.$searchQuery.query="",$scope.$searchQuery.currentQuery=""},affectedWithUploadFoldersIds=[],canRefreshAfterUpload=function(){var ref,ref1,ref2;return _.includes(["allMedia","siteMedia"],null!=(ref=$scope.getSelectedFolder())?ref.type:void 0)||_.includes(affectedWithUploadFoldersIds,null!=(ref1=$scope.getSelectedFolder())?ref1.id:void 0)&&!_.includes(["favorites","purchased","trash"],null!=(ref2=$scope.getSelectedFolder())?ref2.type:void 0)},onUploadQueueStarted=function(){if(_.includes(["video","secure_video"],settings.mediaType))return $scope.$upload.showPopup()},onUploadQueueFinished=function(){if(isSomeFileUploaded()&&canRefreshAfterUpload())return isSearch()&&clearSearchQuery(),$scope.$nestedEntities.load().then(function(){return SelectedEntities.clear(),SelectedEntities.add(_.find($scope.$nestedEntities.list,function(entity){return entity instanceof Item}))})},onFileStatusChanged=function(_this){return function(progress){var item,itemData,ref;if("succeeded"===progress.currentFileProgress.status){if(itemData=progress.currentFileProgress.file.serverResponse.data,itemData.mediaType!==settings.mediaType)return;if(_.includes(affectedWithUploadFoldersIds,itemData.folderId)||affectedWithUploadFoldersIds.push(itemData.folderId),item=new Item(adapter,itemData),isSearch())return clearSearchQuery(),$scope.$nestedEntities.load();if(item.folderId===(null!=(ref=$scope.getSelectedFolder())?ref.id:void 0)||canRefreshAfterUpload())return $scope.$nestedEntities.list.unshift(item)}}}(),_.mapKeys(eventListeners,function(listener,event){return wixmp.Uploader.off(event,listener)}),wixmp.Uploader.on("uploadQueueStarted",onUploadQueueStarted),eventListeners.uploadQueueStarted=onUploadQueueStarted,wixmp.Uploader.on("uploadQueueFinished",onUploadQueueFinished),eventListeners.uploadQueueFinished=onUploadQueueFinished,wixmp.Uploader.on("fileStatusChanged",onFileStatusChanged),eventListeners.fileStatusChanged=onFileStatusChanged,adapter.events.on(adapter.events.FOLDERS.TRASH.RESTORE,function(_this){return function(promises){return $q.all(promises).finally(function(){return $scope.$folders.reload()})}}()),adapter.events.on(adapter.events.FOLDERS.REMOVE,function(_this){return function(promises){return $q.all(promises).finally(function(){if(1===$scope.selectedFoldersPath.length&&"trash"===$scope.selectedFoldersPath[0].type)return $scope.$nestedEntities.load()})}}()),init()})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.public",{url:"/public",templateUrl:"scripts/pages/public/public.html",controller:"publicMediaCtrl",resolve:{notify:function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.tabSelected():void 0},adapter:function(tabs){return tabs.public.getAdapter()}}})}}(this)),this.app.controller("publicMediaCtrl",function($scope,adapter,$state,settings,submitItems,SelectedEntities,path,Item,EntitiesCtrlPartial,paginatedItemsListLoader,paginatedItemsSearchLoader,publicAllCategoriesIds){var clearSearchQuery,getDefaultFolder,getDefaultParentFolder,getSelectedFolder,getSelectedParentFolder,initializationPath,isPathWasSet,loadFolders,loadItems,loadParentFolders,searchItems,updatePath;return $scope.adapter=adapter,initializationPath=_.clone(path.get()),isPathWasSet=!1,updatePath=function(){var currentPath,ref,ref1;return currentPath=[],(null!=(ref=$scope.$parentFolders.selectedFolder)?ref.id:void 0)&&(currentPath.push($scope.$parentFolders.selectedFolder.id.split(":")[0]),(null!=(ref1=$scope.$folders.selectedFolder)?ref1.id:void 0)&&currentPath.push($scope.$folders.selectedFolder.id.split(":")[0])),path.set(currentPath)},getDefaultParentFolder=function(){var folderId,res;if(folderId=initializationPath[0])return res=$scope.$parentFolders.list.filter(function(f){return f.id.split(":")[0]===folderId}),res[0]},loadParentFolders=function(){return adapter.folders.list(settings.publicMediaRoot)},$scope.$parentFolders=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,null,loadParentFolders),$scope.$parentFolders.load=_.flow($scope.$parentFolders.load,function(promise){return promise.then(function(){return isPathWasSet?$scope.$parentFolders.selectFolder($scope.$parentFolders.list[0]):$scope.$parentFolders.selectFolder(getDefaultParentFolder()||$scope.$parentFolders.list[0])})}),$scope.$parentFolders.selectFolder=_.flow($scope.$parentFolders.selectFolder,function(){return updatePath(),$scope.$folders.load()}),$scope.$parentFolders.sortOrder=null,getDefaultFolder=function(){var folderId,res;if(folderId=initializationPath[1])return res=$scope.$folders.list.filter(function(f){return f.id.split(":")[0]===folderId}),res[0]},getSelectedParentFolder=function(){return $scope.$parentFolders.selectedFolder},clearSearchQuery=function(){return $scope.$searchQuery.query="",$scope.$searchQuery.currentQuery=""},loadFolders=function(){return $scope.$parentFolders.selectedFolder.foldersList()},$scope.$folders=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,getSelectedParentFolder,loadFolders),$scope.$folders.load=_.flow($scope.$folders.load,function(promise){return promise.then(function(){return isPathWasSet?$scope.$folders.selectFolder($scope.$folders.list[0]):$scope.$folders.selectFolder(getDefaultFolder()||$scope.$folders.list[0])})}),$scope.$folders.selectFolder=_.flow($scope.$folders.selectFolder,function(){return isPathWasSet&&clearSearchQuery(),updatePath(),$scope.$nestedEntities.load()}),$scope.getAllFolder=function(){return _.find($scope.$folders.list,function(folder){return _.includes(publicAllCategoriesIds,""+folder.id.split(":")[0])})},getSelectedFolder=function(){return $scope.$folders.selectedFolder},loadItems=paginatedItemsListLoader(adapter,getSelectedFolder),searchItems=paginatedItemsSearchLoader(adapter,getSelectedFolder),$scope.$nestedEntities=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,getSelectedFolder,loadItems,searchItems),$scope.$nestedEntities.load=_.flow($scope.$nestedEntities.load,function(){return $scope.$searchQuery.query,updatePath()}),$scope.descriptionTranslationKey=void 0,$scope.$parentFolders.load().then(function(){return isPathWasSet=!0}),$scope.submitItems=function(){var idsToGet,promise,readyToSubmit;if($scope.canSubmitItems())return readyToSubmit=[],idsToGet=[],_.forEach(SelectedEntities.get(),function(item){return"part"===item.subtype?idsToGet.push(item.id):readyToSubmit.push(item)}),idsToGet.length?(promise=adapter.item.get(idsToGet),promise.then(function(response){var items;return items=_.map(response.data,function(item){return new Item(adapter,item)}),submitItems(readyToSubmit.concat(items))})):submitItems(readyToSubmit)}})}.call(this),function(){"use strict";this.app.constant("publicAllCategoriesIds",["c2a37dfc-36cf-4bfd-b940-55bac7bdc9e6","bd176e29-5534-4d9f-87a6-a8177517ea4f","820351a1-729d-4bd1-856d-d578ca44f29e","ea934aee-5729-4c5e-aed1-ac25f5489914","cfad1a19-5cae-4d27-9cb7-fbf39ab6b644","2217cb59-e74f-4eac-b039-c5a61722d69a","9e839ab1-0fe5-4ffe-84c3-1ac80406ae66","8aa61c23-bff9-4426-ae8c-c1fd569764bf","d7b4efe4-a6ea-42df-80ac-1820c14fbe9a","b1dbbe33-cc31-4b23-b865-a81680f70976","8a78186b-a8d2-434a-91e1-8020f6bc9c87","a3269d65-3971-4557-9c4e-918b7a67edc9","d6b6b972-952c-4ab0-b46a-a6c05a0a94a5"])}.call(this),function(){"use strict";var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.external",{url:"/external",templateUrl:"scripts/pages/external/external.html",controller:"externalCtrl",resolve:{notify:function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.tabSelected():void 0},adapters:function(tabs){return tabs.external.getAdapters()}}})}}(this)),this.app.controller("externalCtrl",function($scope,adapters,$q,submitItems,importItems,SelectedEntities,i18n,FilterCtrlPartial,EntitiesCtrlPartial,path,Folder,serviceRedirectUrl,paginatedItemsListLoader,supportedExternalServicesWithoutFolders,externalAdaptersWithNestedSupport){var getDefaultNestedFolder,getFirstConnectedService,getServiceFromPath,importedCount,initializationPath,isChildFolderSelectedAtPath,isPathWasSet,itemsPartialControllers,loadNestedFolders,makeFoldersFirst,ref,selectDefaultService,servicesList,setAdapter,skipImport,sortNestedFolders,updatePath,userSettings;return initializationPath=_.clone(path.get()),isPathWasSet=!1,updatePath=function(){var currentPath;return currentPath=[],$scope.$services.selected&&currentPath.push($scope.$services.selected.id),_.forEach($scope.selectedFoldersPath,function(folder){return!!((null!=folder?folder.id:void 0)||(null!=folder?folder.virtualId:void 0))&&(currentPath.push(folder.id||folder.virtualId),!0)}),path.set(currentPath)},$scope.selectedFoldersPath=[],userSettings={redirectUrl:serviceRedirectUrl()},servicesList=_.map(adapters,function(adapter){var connectorId;return connectorId=_.snakeCase(adapter.name).toUpperCase(),{id:adapter.name,translationKey:adapter.translationKey||adapter.name,name:i18n.translate("external_media."+(adapter.translationKey||adapter.name)),connector:wixmp.connectExternalSource(connectorId,userSettings)}}),$scope.$services=new FilterCtrlPartial(null,servicesList),getFirstConnectedService=function(){return _.find($scope.$services.list,$scope.$services.isConnected)},getServiceFromPath=function(){var serviceFromPath,serviceId;return serviceId=initializationPath[0],serviceId&&(serviceFromPath=_.find($scope.$services.list,function(service){return service.id===serviceId})),serviceFromPath},selectDefaultService=function(){return isPathWasSet?$scope.$services.select(getFirstConnectedService()||null):$scope.$services.select(getServiceFromPath()||getFirstConnectedService()||null)},setAdapter=function(service){return $scope.adapter=_.findWhere(adapters,{name:service.id}),$scope.$nestedEntities=itemsPartialControllers[service.id]},$scope.breadcrumbsList=function(){return _.includes(supportedExternalServicesWithoutFolders,$scope.$services.selected.id)?[$scope.$services.selected]:[$scope.$services.selected].concat($scope.selectedFoldersPath)},$scope.$services.connect=function(service){return service.connector.connect().then(function(){return $scope.$services.select(service)})},$scope.$services.disconnect=function(service){if($scope.$services.isConnected(service))return $scope.$services.selected===service&&$scope.$services.select(null),service.connector.disconnect().then(selectDefaultService)},$scope.$services.isConnected=function(service){return null!=service?service.connector.isConnected():void 0},$scope.$services.isAllDisconnected=function(){return _.every($scope.$services.list,function(service){return!$scope.$services.isConnected(service)})},$scope.$services.isAllConnected=function(){return _.every($scope.$services.list,$scope.$services.isConnected)},$scope.$services.disconnectedList=function(){return _.filter($scope.$services.list,function(service){return!$scope.$services.isConnected(service)})},$scope.$services.select=_.flow($scope.$services.select,function(service){if(service&&setAdapter(service),$scope.selectedFoldersPath=[],updatePath(),isPathWasSet=!0,$scope.$services.isConnected(service))return $scope.$nestedEntities.load().then(function(){if(_.includes(supportedExternalServicesWithoutFolders,service.id))return $scope.$nestedEntities.selectFolder(_.find($scope.$nestedEntities.list,function(entity){return entity instanceof Folder}))})}),isChildFolderSelectedAtPath=function(){return!!getDefaultNestedFolder()},$scope.getSelectedFolder=function(){return _.last($scope.selectedFoldersPath)},getDefaultNestedFolder=function(){var folderId;if(folderId=initializationPath[$scope.selectedFoldersPath.length])return _.find($scope.$nestedEntities.list,function(folder){return folder.id===folderId||null!=folder.virtualId&&folder.virtualId===folderId})},sortNestedFolders=function(list){return list.data=_.sortBy(list.data,"name"),list},makeFoldersFirst=function(list){return list.data=_.sortBy(list.data,function(entity){return entity instanceof Folder?0:1}),list},loadNestedFolders=function(){var promise,ref;return promise=(null!=(ref=$scope.getSelectedFolder())?ref.foldersList():void 0)||$scope.adapter.folders.list(),promise.then(function(list){return!isPathWasSet&&getDefaultNestedFolder()&&$scope.$nestedEntities.selectFolder(getDefaultNestedFolder()),sortNestedFolders(list),$scope.$nestedEntities.list=null!=list?list.data:void 0})},$scope.selectFolderOrService=function(folder){var position;return position=$scope.selectedFoldersPath.indexOf(folder),position>=0&&($scope.selectedFoldersPath.length=position),folder instanceof Folder?$scope.$nestedEntities.selectFolder(folder):$scope.$services.select(folder)},itemsPartialControllers={},_.forEach(adapters,function(adapter){var loadAllEntities,loadItems;return loadItems=paginatedItemsListLoader(adapter,$scope.getSelectedFolder),loadAllEntities=function(isFirstPage){var deferred,list,promises,ref,ref1,unresovedCount;return promises=[],isFirstPage&&(!$scope.getSelectedFolder()||(ref=adapter.name,indexOf.call(externalAdaptersWithNestedSupport,ref)>=0))&&promises.push(loadNestedFolders()),($scope.getSelectedFolder()||(ref1=$scope.adapter.name,indexOf.call(externalAdaptersWithNestedSupport,ref1)>=0))&&!isChildFolderSelectedAtPath()&&promises.push(loadItems(isFirstPage)),list={data:[]},deferred=$q.defer(),unresovedCount=0,_.forEach(promises,function(promise){return unresovedCount++,promise.then(function(currentList){return currentList.data&&(list.data=list.data.concat(currentList.data)),currentList}).finally(function(){if(!--unresovedCount)return deferred.resolve(makeFoldersFirst(list))})}),deferred.promise},itemsPartialControllers[adapter.name]=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,$scope.getSelectedFolder,loadAllEntities),itemsPartialControllers[adapter.name].selectFolder=_.flow(itemsPartialControllers[adapter.name].selectFolder,function(folder){return $scope.selectedFoldersPath.push(folder),updatePath(),itemsPartialControllers[adapter.name].load()}),itemsPartialControllers[adapter.name].load=_.flow(itemsPartialControllers[adapter.name].load,function(promise){return promise.catch(function(reason){if(401===reason.code)return editorConnection.emit("notauthorized")})}),itemsPartialControllers[adapter.name].load=_.flow(itemsPartialControllers[adapter.name].load,function(promise){return $scope.isLoading=!0,promise.finally(function(){return $scope.isLoading=!1})})}),$scope.canSubmitItems=_.flow($scope.canSubmitItems,function(canSubmit){return canSubmit&&!$scope.isImporting}),skipImport=function(){return $scope.adapter.can.item.skipImport()},importedCount=0,$scope.getImportingProgress=function(){return importedCount/SelectedEntities.get().length},$scope.importingCount=0,$scope.submitItems=function(){var importedItems,promises;if($scope.canSubmitItems())return skipImport()?submitItems(SelectedEntities.get()):(importedItems=[],$scope.isImporting=!0,importedCount=0,promises=importItems(SelectedEntities.get(),$scope.adapter.name),$scope.importingCount=promises.length,_.forEach(promises,function(promise){return promise.then(function(item){return importedItems.push(item),importedCount++})}),$q.all(promises).then(function(){return $scope.isImporting=!1,submitItems(importedItems),$scope.importingCount=0},function(){return $scope.isImporting=!1,$scope.importingCount=0}))},$scope.getSelectedFolderOrServiceName=function(){var ref,serviceName;return serviceName=i18n.translate("external_media."+$scope.$services.selected.id),_.includes(supportedExternalServicesWithoutFolders,$scope.$services.selected.id)?serviceName:(null!=(ref=$scope.getSelectedFolder())?ref.name:void 0)||serviceName},$scope.descriptionTranslationKey="external_media.upload_restrictions_header_message",_.forEach(adapters,function(adapter){return adapter.events.on([adapter.events.ITEMS.LIST,adapter.events.FOLDERS.LIST],function(promise){if($scope.adapter===adapter)return promise.catch(function(error){if(403===error.code||401===error.code)return $scope.$services.disconnect($scope.$services.selected)})})}),null!=(ref=selectDefaultService())?ref.then(function(){return isPathWasSet=!0}):void 0})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.externalSearch",{url:"/externalSearch",templateUrl:"scripts/pages/external-search/external-search.html",controller:"externalSearchCtrl",resolve:{notify:function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.tabSelected():void 0},adapters:function(tabs){return tabs.externalSearch.getAdapters()}}})}}(this)),this.app.controller("externalSearchCtrl",function($scope,adapters,submitItems,importItems,SelectedEntities,i18n,FilterCtrlPartial,EntitiesCtrlPartial,path,paginatedItemsSearchLoader,$q){var defaultServiceId,getServiceFromPath,importedCount,initializationPath,itemsPartialControllers,servicesList,setAdapter,skipImport,updatePath;return initializationPath=_.clone(path.get()),updatePath=function(){var currentPath;return currentPath=[],null!=$scope.$services.selected&&currentPath.push($scope.$services.selected.id),path.set(currentPath)},defaultServiceId=path.get()[1]||"googleSearch",servicesList=_.map(adapters,function(adapter){return{id:adapter.name,name:i18n.translate("external_search."+adapter.name)}}),$scope.$services=new FilterCtrlPartial(defaultServiceId,servicesList),setAdapter=function(service){return $scope.adapter=_.findWhere(adapters,{name:service.id}),$scope.$nestedEntities=itemsPartialControllers[service.id]},$scope.$services.select=_.flow($scope.$services.select,function(){return setAdapter($scope.$services.selected),$scope.$nestedEntities.load()}),itemsPartialControllers={},_.forEach(adapters,function(adapter){var searchItems;return searchItems=paginatedItemsSearchLoader(adapter),itemsPartialControllers[adapter.name]=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,null,null,searchItems)}),$scope.canSubmitItems=_.flow($scope.canSubmitItems,function(canSubmit){return canSubmit&&!$scope.isImporting}),skipImport=function(){return $scope.adapter.can.item.skipImport()},importedCount=0,$scope.getImportingProgress=function(){return importedCount/SelectedEntities.get().length},$scope.submitItems=function(){var importedItems,promises;if(SelectedEntities.size)return skipImport()?submitItems(SelectedEntities.get()):(importedItems=[],$scope.isImporting=!0,importedCount=0,promises=importItems(SelectedEntities.get(),$scope.adapter.name),_.forEach(promises,function(promise){return promise.then(function(item){return importedItems.push(item),importedCount++})}),$q.all(promises).then(function(){return $scope.isImporting=!1,submitItems(importedItems)},function(){return $scope.isImporting=!1}))},$scope.descriptionTranslationKey="external_search.upload_restrictions_header_message",getServiceFromPath=function(){var serviceFromPath,serviceId;return serviceId=initializationPath[0],serviceId&&(serviceFromPath=_.find($scope.$services.list,function(service){return service.id===serviceId})),serviceFromPath},$scope.$services.select(getServiceFromPath()||$scope.$services.list[0]),updatePath()})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.photoStock",{url:"/photoStock",templateUrl:"scripts/pages/photo-stock/photo-stock.html",controller:"photoStockCtrl",resolve:{notify:function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.tabSelected():void 0},adapter:function(tabs){return tabs.photoStock.getAdapter()}}})}}(this)),this.app.controller("photoStockCtrl",function($scope,$state,SelectedEntities,EntitiesCtrlPartial,FilterCtrlPartial,tabs,adapter,settings,stockPayment,submitItems,path,paginatedItemsListLoader,paginatedItemsSearchLoader,i18n){var clearSearchQuery,getDefaultFolder,getFolders,getListOptions,getSelectedFolder,initializationPath,isPathWasSet,loadItems,searchItems,updatePath;return $scope.adapter=adapter,initializationPath=_.clone(path.get()),isPathWasSet=!1,updatePath=function(){var currentPath,ref;return currentPath=[],(null!=(ref=$scope.$folders.selectedFolder)?ref.id:void 0)&&currentPath.push($scope.$folders.selectedFolder.id),path.set(currentPath)},getDefaultFolder=function(){var folderId;if(folderId=initializationPath[0])return _.findWhere($scope.$folders.list,{id:folderId})},clearSearchQuery=function(){return $scope.$searchQuery.query="",$scope.$searchQuery.currentQuery=""},getFolders=function(){return adapter.folders.list()},$scope.$folders=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,null,getFolders),$scope.$folders.load=_.flow($scope.$folders.load,function(promise){return promise.then(function(){return _.forEach($scope.$folders.list,function(folder){var folderId;return folderId=folder.id,null===folder.id&&(folderId="All"),folder.name=i18n.translate("photo_stock.big_stock.folder."+folderId)}),isPathWasSet?$scope.$folders.selectFolder($scope.$folders.list[0]):$scope.$folders.selectFolder(getDefaultFolder()||$scope.$folders.list[0])})}),$scope.$folders.selectFolder=_.flow($scope.$folders.selectFolder,function(){return isPathWasSet&&clearSearchQuery(),updatePath(),$scope.$nestedEntities.load()}),$scope.getAllFolder=function(){return _.find($scope.$folders.list,function(folder){return null===folder.id})},getSelectedFolder=function(){return $scope.$folders.selectedFolder},getListOptions=function(){return{hasIllustrations:!1,hasVectors:!1,isSafeSearch:!0,orientation:$scope.$nestedEntities.$orientation.selected?$scope.$nestedEntities.$orientation.selected.id:void 0}},loadItems=paginatedItemsListLoader(adapter,getSelectedFolder,getListOptions),searchItems=paginatedItemsSearchLoader(adapter,$scope.getAllFolder,getListOptions),$scope.$nestedEntities=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,getSelectedFolder,loadItems,searchItems),$scope.$nestedEntities.load=_.flowRight($scope.$nestedEntities.load,function(){if($scope.$searchQuery.query&&$scope.$folders.selectedFolder!==$scope.getAllFolder())return $scope.$folders.selectedFolder=$scope.getAllFolder(),updatePath()}),$scope.$nestedEntities.$orientation=new FilterCtrlPartial(null,[{name:"vertical",id:"v"},{name:"horizontal",id:"h"}]),$scope.$nestedEntities.$orientation.select=function(orientation){return $scope.$nestedEntities.$orientation.selected=$scope.$nestedEntities.$orientation.selected===orientation?null:orientation,$scope.$nestedEntities.load()},$scope.isBuying=!1,$scope.submitItems=function(){var item,items,payment;if(items=SelectedEntities.get(),items.length)return item=_.first(items),payment=stockPayment(adapter.name),$scope.isBuying=!1,payment.buyImage(item).then(function(){return $scope.isBuying=!0,payment.getBoughtImage(item).then(function(boughtItem){var ref,ref1,ref2;if(settings.siteMediaToken&&null!=(ref=tabs.private)&&null!=(ref1=ref.getAdapter())&&null!=(ref2=ref1.items.siteMedia)&&ref2.add([boughtItem.id]),$scope.isBuying=!1,null!=boughtItem?boughtItem.id:void 0)return submitItems([boughtItem])},function(){return $scope.isBuying=!1})})},$scope.descriptionTranslationKey="bigstock_images.upload_restrictions_header_message",$scope.footerSubmitTranslationKey="photo_stock_tab.footer.submit",$scope.$folders.load().then(function(){return isPathWasSet=!0})})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.shutterStock",{url:"/shutterStock",templateUrl:"scripts/pages/shutter-stock/shutter-stock.html",controller:"shutterStockCtrl",resolve:{notify:function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.tabSelected():void 0},adapter:function(tabs){return tabs.shutterStock.getAdapter()}}})}}(this)),this.app.controller("shutterStockCtrl",function($scope,$state,SelectedEntities,EntitiesCtrlPartial,FilterCtrlPartial,tabs,adapter,settings,stockPayment,submitItems,path,paginatedItemsListLoader,paginatedItemsSearchLoader,i18n){var clearSearchQuery,getDefaultFolder,getFolders,getListOptions,getSelectedFolder,initializationPath,isPathWasSet,loadItems,searchItems,updatePath;return $scope.adapter=adapter,initializationPath=_.clone(path.get()),isPathWasSet=!1,updatePath=function(){var currentPath,ref;return currentPath=[],(null!=(ref=$scope.$folders.selectedFolder)?ref.id:void 0)&&currentPath.push($scope.$folders.selectedFolder.id),path.set(currentPath)},getDefaultFolder=function(){var folderId;if(folderId=initializationPath[0])return _.findWhere($scope.$folders.list,{id:folderId})},clearSearchQuery=function(){return $scope.$searchQuery.query="",$scope.$searchQuery.currentQuery=""},getFolders=function(){return adapter.folders.list()},$scope.$folders=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,null,getFolders),$scope.$folders.load=_.flow($scope.$folders.load,function(promise){return promise.then(function(){return _.forEach($scope.$folders.list,function(folder){var folderId;return folderId=folder.id,null===folder.id&&(folderId="All"),folder.name=i18n.translate("photo_stock.shutterstock.folder."+folderId)}),isPathWasSet?$scope.$folders.selectFolder($scope.$folders.list[0]):$scope.$folders.selectFolder(getDefaultFolder()||$scope.$folders.list[0])})}),$scope.$folders.selectFolder=_.flow($scope.$folders.selectFolder,function(){return isPathWasSet&&clearSearchQuery(),updatePath(),$scope.$nestedEntities.load()}),$scope.getAllFolder=function(){return _.find($scope.$folders.list,function(folder){return null===folder.id})},getSelectedFolder=function(){return $scope.$folders.selectedFolder},getListOptions=function(){return{hasIllustrations:!1,hasVectors:!1,isSafeSearch:!0,orientation:$scope.$nestedEntities.$orientation.selected?$scope.$nestedEntities.$orientation.selected.id:void 0}},loadItems=paginatedItemsListLoader(adapter,getSelectedFolder,getListOptions),searchItems=paginatedItemsSearchLoader(adapter,$scope.getAllFolder,getListOptions),$scope.$nestedEntities=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,getSelectedFolder,loadItems,searchItems),$scope.$nestedEntities.load=_.flowRight($scope.$nestedEntities.load,function(){if($scope.$searchQuery.query&&$scope.$folders.selectedFolder!==$scope.getAllFolder())return $scope.$folders.selectedFolder=$scope.getAllFolder(),updatePath()}),$scope.$nestedEntities.$orientation=new FilterCtrlPartial(null,[{name:"vertical",id:"vertical"},{name:"horizontal",id:"horizontal"}]),$scope.$nestedEntities.$orientation.select=function(orientation){return $scope.$nestedEntities.$orientation.selected=$scope.$nestedEntities.$orientation.selected===orientation?null:orientation,$scope.$nestedEntities.load()},$scope.isBuying=!1,$scope.submitItems=function(){var item,items,payment;if(items=SelectedEntities.get(),items.length)return item=_.first(items),payment=stockPayment(adapter.name),$scope.isBuying=!1,payment.buyImage(item).then(function(){return $scope.isBuying=!0,payment.getBoughtImage(item).then(function(boughtItem){var ref,ref1,ref2;return settings.siteMediaToken&&null!=(ref=tabs.private)&&null!=(ref1=ref.getAdapter())&&null!=(ref2=ref1.items.siteMedia)&&ref2.add([boughtItem.id]),(null!=boughtItem?boughtItem.id:void 0)&&setTimeout(function(){return $state.go("app.private")},5e3),$scope.isBuying=!1},function(){return $scope.isBuying=!1})})},$scope.descriptionTranslationKey="shutterstock_images.upload_restrictions_header_message",$scope.footerSubmitTranslationKey="shutterstock_tab.footer.submit",$scope.$folders.load().then(function(){return isPathWasSet=!0})})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.shutterStockVideo",{url:"/shutterStockVideo",templateUrl:"scripts/pages/shutter-stock-video/shutter-stock-video.html",controller:"shutterStockVideoCtrl",resolve:{notify:function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.tabSelected():void 0},adapter:function(tabs){return tabs.shutterStockVideo.getAdapter()}}})}}(this)),this.app.controller("shutterStockVideoCtrl",function($scope,$state,SelectedEntities,EntitiesCtrlPartial,FilterCtrlPartial,tabs,adapter,settings,stockPayment,submitItems,path,paginatedItemsListLoader,paginatedItemsSearchLoader,i18n){var clearSearchQuery,getDefaultFolder,getFolders,getListOptions,getSelectedFolder,initializationPath,isPathWasSet,loadItems,searchItems,updatePath;return $scope.adapter=adapter,initializationPath=_.clone(path.get()),isPathWasSet=!1,updatePath=function(){var currentPath,ref;return currentPath=[],(null!=(ref=$scope.$folders.selectedFolder)?ref.id:void 0)&&currentPath.push($scope.$folders.selectedFolder.id),path.set(currentPath)},getDefaultFolder=function(){var folderId;if(folderId=initializationPath[0])return _.findWhere($scope.$folders.list,{id:folderId})},clearSearchQuery=function(){return $scope.$searchQuery.query="",$scope.$searchQuery.currentQuery=""},getFolders=function(){return adapter.folders.list()},$scope.$folders=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,null,getFolders),$scope.$folders.load=_.flow($scope.$folders.load,function(promise){return promise.then(function(){return _.forEach($scope.$folders.list,function(folder){var folderId;return folderId=folder.id,null===folder.id&&(folderId="All"),folder.name=i18n.translate("photo_stock.shutterstock_video.folder."+folderId)}),isPathWasSet?$scope.$folders.selectFolder($scope.$folders.list[0]):$scope.$folders.selectFolder(getDefaultFolder()||$scope.$folders.list[0])})}),$scope.$folders.selectFolder=_.flow($scope.$folders.selectFolder,function(){return isPathWasSet&&clearSearchQuery(),updatePath(),$scope.$nestedEntities.load()}),$scope.getAllFolder=function(){return _.find($scope.$folders.list,function(folder){return null===folder.id})},getSelectedFolder=function(){return $scope.$folders.selectedFolder},getListOptions=function(){return{hasIllustrations:!1,hasVectors:!1,isSafeSearch:!0}},loadItems=paginatedItemsListLoader(adapter,getSelectedFolder,getListOptions),searchItems=paginatedItemsSearchLoader(adapter,$scope.getAllFolder,getListOptions),$scope.$nestedEntities=new EntitiesCtrlPartial(adapter,$scope.$searchQuery,getSelectedFolder,loadItems,searchItems),$scope.$nestedEntities.load=_.flowRight($scope.$nestedEntities.load,function(){if($scope.$searchQuery.query&&$scope.$folders.selectedFolder!==$scope.getAllFolder())return $scope.$folders.selectedFolder=$scope.getAllFolder(),updatePath()}),$scope.isBuying=!1,$scope.submitItems=function(){var item,items,payment;if(items=SelectedEntities.get(),items.length)return item=_.first(items),payment=stockPayment(adapter.name),$scope.isBuying=!1,payment.buyImage(item).then(function(){return $scope.isBuying=!0,payment.getBoughtImage(item).then(function(boughtItem){var ref,ref1,ref2;return settings.siteMediaToken&&null!=(ref=tabs.private)&&null!=(ref1=ref.getAdapter())&&null!=(ref2=ref1.items.siteMedia)&&ref2.add([boughtItem.id]),(null!=boughtItem?boughtItem.id:void 0)&&setTimeout(function(){return $state.go("app.private")},5e3),$scope.isBuying=!1},function(){
return $scope.isBuying=!1})})},$scope.descriptionTranslationKey="shutterstock_videos.upload_restrictions_header_message",$scope.footerSubmitTranslationKey="shutterstock_video_tab.footer.submit",$scope.$folders.load().then(function(){return isPathWasSet=!0})})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.collection",{url:"/collection",templateUrl:"scripts/pages/_base/base.html",controller:"collectionCtrl",resolve:{notify:function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.tabSelected():void 0},adapter:function(tabs){return tabs.collection.getAdapter()}}})}}(this)),this.app.controller("collectionCtrl",function($scope,adapter,baseCtrl){return baseCtrl($scope,adapter)()})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.settingsPassed",{url:"/settingsPassed",templateUrl:"scripts/pages/_base/base.html",controller:"settingsPassedCtrl",resolve:{notify:function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.tabSelected():void 0},adapter:function(tabs){return tabs.settingsPassed.getAdapter()}}})}}(this)),this.app.controller("settingsPassedCtrl",function($scope,adapter,baseCtrl){return baseCtrl($scope,adapter)()})}.call(this),function(){"use strict";this.app.config(function(_this){return function($stateProvider){return $stateProvider.state("app.custom",{url:"/custom",templateUrl:"scripts/pages/custom/custom.html",controller:"customCtrl",resolve:{notify:function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.tabSelected():void 0}}})}}(this)),this.app.controller("customCtrl",function($scope,settings,tabs,SelectedEntities,path){var addItemProperties,select,unselect;return addItemProperties=function(item){return item.can={submit:function(){return!0},showImagePreview:function(){return _.includes(["picture","watermark","site_icon","ufont","shape"],settings.mediaType)},showVideoPreview:function(){var ref;return(null!=(ref=item.videoPreviewUrls)?ref.length:void 0)&&_.includes(["video"],settings.mediaType)},showExternalVideoPreview:function(){return!1}},item},select=function(item){return"single"===settings.selectionType&&SelectedEntities.clear(),SelectedEntities.add(item)},unselect=function(item){return SelectedEntities.delete(item)},$scope.sections=settings.customData.sections,$scope.sections.forEach(function(section){return section.action&&path.setFull(section.action.url),section.data=section.data.map(function(item){return addItemProperties(item)})}),$scope.showSection=function(section){return section.data.length>0},$scope.showAction=function(section){return section.action&&section.action.url},$scope.isSelected=function(item){return SelectedEntities.has(item)},$scope.toggle=function(item){return $scope.isSelected(item)?unselect(item):select(item)}})}.call(this),function(){"use strict";this.app.constant("perfMarks",{LOAD_START:"load-start",LOAD_END:"load-end",OPEN_START:"open-start",OPEN_END:"open-end"})}.call(this),function(){"use strict";this.app.constant("deprecatedSettings",["canShowTabs","canShowSelectButton","showSelectButton"])}.call(this),function(){"use strict";this.app.constant("externalAdaptersWithNestedSupport",["drive","dropbox"])}.call(this),function(){"use strict";this.app.constant("mediaTypes",{ARCHIVE:"archive",DOCUMENT:"document",MUSIC:"music",PICTURE:"picture",SECURE_ARCHIVE:"secure_archive",SECURE_DOCUMENT:"secure_document",SECURE_MUSIC:"secure_music",SECURE_PICTURE:"secure_picture",SECURE_VIDEO:"secure_video",SHAPE:"shape",SITE_ICON:"site_icon",SWF:"swf",UFONT:"ufont",VIDEO:"video",WATERMARK:"watermark"})}.call(this),function(){"use strict";this.app.constant("supportedExternalSearchServices",[{name:"googleSearch",mediaTypes:["picture","secure_picture"]},{name:"flickrSearch",mediaTypes:["picture","secure_picture"]},{name:"vimeoSearch",mediaTypes:["video","secure_video"]},{name:"youtubeSearch",mediaTypes:["video","secure_video"]}])}.call(this),function(){"use strict";this.app.constant("supportedExternalServices",[{name:"facebook",mediaTypes:["picture","secure_picture"]},{name:"picasa",mediaTypes:["picture","secure_picture"]},{name:"instagram",mediaTypes:["picture","secure_picture"]},{name:"flickr",mediaTypes:["picture","secure_picture"]},{name:"drive",mediaTypes:["picture","secure_picture"]},{name:"dropbox",mediaTypes:["picture","secure_picture"]},{name:"youtube",mediaTypes:["video","secure_video"]},{name:"vimeo",mediaTypes:["video","secure_video"]},{name:"facebookVideo",mediaTypes:["video","secure_video"]},{name:"instagramVideo",mediaTypes:["video"]},{name:"deviantart",mediaTypes:["picture","secure_picture"]}])}.call(this),function(){"use strict";this.app.constant("supportedExternalServicesWithoutFolders",["facebookVideo","instagram","instagramVideo","vimeo"])}.call(this),function(){"use strict";this.app.value("supportedArchiveTypes",["zip"])}.call(this),function(){"use strict";this.app.value("supportedDocsTypes",["doc","docx","epub","odp","odt","pdf","ppt","pptx","xls","xlsx","ppsx"])}.call(this),function(){"use strict";this.app.constant("supportedMediaTypes",["picture","watermark","document","ufont","site_icon","swf","music","video","secure_document","secure_picture","secure_music","secure_video"])}.call(this),function(){"use strict";this.app.constant("supportedPublicMediaRoots",["backgrounds","clipart","file_icons","icons","photos","watermarks","shapes","social_icons","video"])}.call(this),function(window){"use strict";var CanvasPrototype=window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype,hasBlobConstructor=window.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),hasArrayBufferViewSupport=hasBlobConstructor&&window.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,dataURLtoBlob=(hasBlobConstructor||BlobBuilder)&&window.atob&&window.ArrayBuffer&&window.Uint8Array&&function(dataURI){var byteString,arrayBuffer,intArray,i,mimeString,bb;for(byteString=dataURI.split(",")[0].indexOf("base64")>=0?atob(dataURI.split(",")[1]):decodeURIComponent(dataURI.split(",")[1]),arrayBuffer=new ArrayBuffer(byteString.length),intArray=new Uint8Array(arrayBuffer),i=0;i<byteString.length;i+=1)intArray[i]=byteString.charCodeAt(i);return mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0],hasBlobConstructor?new Blob([hasArrayBufferViewSupport?intArray:arrayBuffer],{type:mimeString}):(bb=new BlobBuilder,bb.append(arrayBuffer),bb.getBlob(mimeString))};window.HTMLCanvasElement&&!CanvasPrototype.toBlob&&(CanvasPrototype.mozGetAsFile?CanvasPrototype.toBlob=function(callback,type,quality){callback(quality&&CanvasPrototype.toDataURL&&dataURLtoBlob?dataURLtoBlob(this.toDataURL(type,quality)):this.mozGetAsFile("blob",type))}:CanvasPrototype.toDataURL&&dataURLtoBlob&&(CanvasPrototype.toBlob=function(callback,type,quality){callback(dataURLtoBlob(this.toDataURL(type,quality)))})),"function"==typeof define&&define.amd?define(function(){return dataURLtoBlob}):window.dataURLtoBlob=dataURLtoBlob}(this),function(a){"use strict";var b=function(a,c,d){var e,f,g=document.createElement("img");if(g.onerror=c,g.onload=function(){!f||d&&d.noRevoke||b.revokeObjectURL(f),c&&c(b.scale(g,d))},b.isInstanceOf("Blob",a)||b.isInstanceOf("File",a))e=f=b.createObjectURL(a),g._type=a.type;else{if("string"!=typeof a)return!1;e=a,d&&d.crossOrigin&&(g.crossOrigin=d.crossOrigin)}return e?(g.src=e,g):b.readFile(a,function(a){var b=a.target;b&&b.result?g.src=b.result:c&&c(a)})},c=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;b.isInstanceOf=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},b.transformCoordinates=function(){},b.getTransformedOptions=function(a,b){var c,d,e,f,g=b.aspectRatio;if(!g)return b;c={};for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c.crop=!0,e=a.naturalWidth||a.width,f=a.naturalHeight||a.height,e/f>g?(c.maxWidth=f*g,c.maxHeight=f):(c.maxWidth=e,c.maxHeight=e/g),c},b.renderImageToCanvas=function(a,b,c,d,e,f,g,h,i,j){return a.getContext("2d").drawImage(b,c,d,e,f,g,h,i,j),a},b.hasCanvasOption=function(a){return a.canvas||a.crop||a.aspectRatio},b.scale=function(a,c){c=c||{};var d,e,f,g,h,i,j,k,l,m=document.createElement("canvas"),n=a.getContext||b.hasCanvasOption(c)&&m.getContext,o=a.naturalWidth||a.width,p=a.naturalHeight||a.height,q=o,r=p,s=function(){var a=Math.max((f||q)/q,(g||r)/r);a>1&&(q*=a,r*=a)},t=function(){var a=Math.min((d||q)/q,(e||r)/r);1>a&&(q*=a,r*=a)};return n&&(c=b.getTransformedOptions(a,c),j=c.left||0,k=c.top||0,c.sourceWidth?(h=c.sourceWidth,void 0!==c.right&&void 0===c.left&&(j=o-h-c.right)):h=o-j-(c.right||0),c.sourceHeight?(i=c.sourceHeight,void 0!==c.bottom&&void 0===c.top&&(k=p-i-c.bottom)):i=p-k-(c.bottom||0),q=h,r=i),d=c.maxWidth,e=c.maxHeight,f=c.minWidth,g=c.minHeight,n&&d&&e&&c.crop?(q=d,r=e,l=h/i-d/e,0>l?(i=e*h/d,void 0===c.top&&void 0===c.bottom&&(k=(p-i)/2)):l>0&&(h=d*i/e,void 0===c.left&&void 0===c.right&&(j=(o-h)/2))):((c.contain||c.cover)&&(f=d=d||f,g=e=e||g),c.cover?(t(),s()):(s(),t())),n?(m.width=q,m.height=r,b.transformCoordinates(m,c),b.renderImageToCanvas(m,a,j,k,h,i,0,0,q,r)):(a.width=q,a.height=r,a)},b.createObjectURL=function(a){return!!c&&c.createObjectURL(a)},b.revokeObjectURL=function(a){return!!c&&c.revokeObjectURL(a)},b.readFile=function(a,b,c){if(window.FileReader){var d=new FileReader;if(d.onload=d.onerror=b,c=c||"readAsDataURL",d[c])return d[c](a),d}return!1},"function"==typeof define&&define.amd?define(function(){return b}):a.loadImage=b}(this),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image"],a):a(window.loadImage)}(function(a){"use strict";if(window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)){var b=a.renderImageToCanvas;a.detectSubsampling=function(a){var b,c;return a.width*a.height>1048576&&(b=document.createElement("canvas"),b.width=b.height=1,c=b.getContext("2d"),c.drawImage(a,1-a.width,0),0===c.getImageData(0,0,1,1).data[3])},a.detectVerticalSquash=function(a,b){var c,d,e,f,g,h=a.naturalHeight||a.height,i=document.createElement("canvas"),j=i.getContext("2d");for(b&&(h/=2),i.width=1,i.height=h,j.drawImage(a,0,0),c=j.getImageData(0,0,1,h).data,d=0,e=h,f=h;f>d;)g=c[4*(f-1)+3],0===g?e=f:d=f,f=e+d>>1;return f/h||1},a.renderImageToCanvas=function(c,d,e,f,g,h,i,j,k,l){if("image/jpeg"===d._type){var m,n,o,p,q=c.getContext("2d"),r=document.createElement("canvas"),s=1024,t=r.getContext("2d");if(r.width=s,r.height=s,q.save(),m=a.detectSubsampling(d),m&&(e/=2,f/=2,g/=2,h/=2),n=a.detectVerticalSquash(d,m),m||1!==n){for(f*=n,k=Math.ceil(s*k/g),l=Math.ceil(s*l/h/n),j=0,p=0;h>p;){for(i=0,o=0;g>o;)t.clearRect(0,0,s,s),t.drawImage(d,e,f,g,h,-o,-p,g,h),q.drawImage(r,0,0,s,s,i,j,k,l),o+=s,i+=k;p+=s,j+=l}return q.restore(),c}}return b(c,d,e,f,g,h,i,j,k,l)}}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image"],a):a(window.loadImage)}(function(a){"use strict";var b=a.hasCanvasOption,c=a.transformCoordinates,d=a.getTransformedOptions;a.hasCanvasOption=function(c){return b.call(a,c)||c.orientation},a.transformCoordinates=function(b,d){c.call(a,b,d);var e=b.getContext("2d"),f=b.width,g=b.height,h=d.orientation;if(h&&!(h>8))switch(h>4&&(b.width=g,b.height=f),h){case 2:e.translate(f,0),e.scale(-1,1);break;case 3:e.translate(f,g),e.rotate(Math.PI);break;case 4:e.translate(0,g),e.scale(1,-1);break;case 5:e.rotate(.5*Math.PI),e.scale(1,-1);break;case 6:e.rotate(.5*Math.PI),e.translate(0,-g);break;case 7:e.rotate(.5*Math.PI),e.translate(f,-g),e.scale(-1,1);break;case 8:e.rotate(-.5*Math.PI),e.translate(-f,0)}},a.getTransformedOptions=function(b,c){var e,f,g=d.call(a,b,c),h=g.orientation;if(!h||h>8||1===h)return g;e={};for(f in g)g.hasOwnProperty(f)&&(e[f]=g[f]);switch(g.orientation){case 2:e.left=g.right,e.right=g.left;break;case 3:e.left=g.right,e.top=g.bottom,e.right=g.left,e.bottom=g.top;break;case 4:e.top=g.bottom,e.bottom=g.top;break;case 5:e.left=g.top,e.top=g.left,e.right=g.bottom,e.bottom=g.right;break;case 6:e.left=g.top,e.top=g.right,e.right=g.bottom,e.bottom=g.left;break;case 7:e.left=g.bottom,e.top=g.right,e.right=g.top,e.bottom=g.left;break;case 8:e.left=g.bottom,e.top=g.left,e.right=g.top,e.bottom=g.right}return g.orientation>4&&(e.maxWidth=g.maxHeight,e.maxHeight=g.maxWidth,e.minWidth=g.minHeight,e.minHeight=g.minWidth,e.sourceWidth=g.sourceHeight,e.sourceHeight=g.sourceWidth),e}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image"],a):a(window.loadImage)}(function(a){"use strict";var b=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);a.blobSlice=b&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},a.metaDataParsers={jpeg:{65505:[]}},a.parseMetaData=function(b,c,d){d=d||{};var e=this,f=d.maxMetaDataSize||262144,g={};(!(window.DataView&&b&&b.size>=12&&"image/jpeg"===b.type&&a.blobSlice)||!a.readFile(a.blobSlice.call(b,0,f),function(b){if(b.target.error)return console.log(b.target.error),void c(g);var f,h,i,j,k=b.target.result,l=new DataView(k),m=2,n=l.byteLength-4,o=m;if(65496===l.getUint16(0)){for(;n>m&&((f=l.getUint16(m))>=65504&&65519>=f||65534===f);){if(h=l.getUint16(m+2)+2,m+h>l.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(i=a.metaDataParsers.jpeg[f])for(j=0;j<i.length;j+=1)i[j].call(e,l,m,h,g,d);m+=h,o=m}!d.disableImageHead&&o>6&&(g.imageHead=k.slice?k.slice(0,o):new Uint8Array(k).subarray(0,o))}else console.log("Invalid JPEG file: Missing JPEG marker.");c(g)},"readAsArrayBuffer"))&&c(g)}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image","load-image-meta"],a):a(window.loadImage)}(function(a){"use strict";a.ExifMap=function(){return this},a.ExifMap.prototype.map={Orientation:274},a.ExifMap.prototype.get=function(a){return this[a]||this[this.map[a]]},a.getExifThumbnail=function(a,b,c){var d,e,f;if(!c||b+c>a.byteLength)return void console.log("Invalid Exif data: Invalid thumbnail data.");for(d=[],e=0;c>e;e+=1)f=a.getUint8(b+e),d.push((16>f?"0":"")+f.toString(16));return"data:image/jpeg,%"+d.join("%")},a.exifTagTypes={1:{getValue:function(a,b){return a.getUint8(b)},size:1},2:{getValue:function(a,b){return String.fromCharCode(a.getUint8(b))},size:1,ascii:!0},3:{getValue:function(a,b,c){return a.getUint16(b,c)},size:2},4:{getValue:function(a,b,c){return a.getUint32(b,c)},size:4},5:{getValue:function(a,b,c){return a.getUint32(b,c)/a.getUint32(b+4,c)},size:8},9:{getValue:function(a,b,c){return a.getInt32(b,c)},size:4},10:{getValue:function(a,b,c){return a.getInt32(b,c)/a.getInt32(b+4,c)},size:8}},a.exifTagTypes[7]=a.exifTagTypes[1],a.getExifValue=function(b,c,d,e,f,g){var h,i,j,k,l,m,n=a.exifTagTypes[e];if(!n)return void console.log("Invalid Exif data: Invalid tag type.");if(h=n.size*f,(i=h>4?c+b.getUint32(d+8,g):d+8)+h>b.byteLength)return void console.log("Invalid Exif data: Invalid data offset.");if(1===f)return n.getValue(b,i,g);for(j=[],k=0;f>k;k+=1)j[k]=n.getValue(b,i+k*n.size,g);if(n.ascii){for(l="",k=0;k<j.length&&"\0"!==(m=j[k]);k+=1)l+=m;return l}return j},a.parseExifTag=function(b,c,d,e,f){var g=b.getUint16(d,e);f.exif[g]=a.getExifValue(b,c,d,b.getUint16(d+2,e),b.getUint32(d+4,e),e)},a.parseExifTags=function(a,b,c,d,e){var f,g,h;if(c+6>a.byteLength)return void console.log("Invalid Exif data: Invalid directory offset.");if(f=a.getUint16(c,d),(g=c+2+12*f)+4>a.byteLength)return void console.log("Invalid Exif data: Invalid directory size.");for(h=0;f>h;h+=1)this.parseExifTag(a,b,c+2+12*h,d,e);return a.getUint32(g,d)},a.parseExifData=function(b,c,d,e,f){if(!f.disableExif){var g,h,i,j=c+10;if(1165519206===b.getUint32(c+4)){if(j+8>b.byteLength)return void console.log("Invalid Exif data: Invalid segment size.");if(0!==b.getUint16(c+8))return void console.log("Invalid Exif data: Missing byte alignment offset.");switch(b.getUint16(j)){case 18761:g=!0;break;case 19789:g=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==b.getUint16(j+2,g))return void console.log("Invalid Exif data: Missing TIFF marker.");h=b.getUint32(j+4,g),e.exif=new a.ExifMap,h=a.parseExifTags(b,j,j+h,g,e),h&&!f.disableExifThumbnail&&(i={exif:{}},h=a.parseExifTags(b,j,j+h,g,i),i.exif[513]&&(e.exif.Thumbnail=a.getExifThumbnail(b,j+i.exif[513],i.exif[514]))),e.exif[34665]&&!f.disableExifSub&&a.parseExifTags(b,j,j+e.exif[34665],g,e),e.exif[34853]&&!f.disableExifGps&&a.parseExifTags(b,j,j+e.exif[34853],g,e)}}},a.metaDataParsers.jpeg[65505].push(a.parseExifData)}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image","load-image-exif"],a):a(window.loadImage)}(function(a){"use strict";a.ExifMap.prototype.tags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},a.ExifMap.prototype.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"top-left",2:"top-right",3:"bottom-right",4:"bottom-left",5:"left-top",6:"right-top",7:"right-bottom",8:"left-bottom"}},a.ExifMap.prototype.getText=function(a){var b=this.get(a);switch(a){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[a][b];case"ExifVersion":case"FlashpixVersion":return String.fromCharCode(b[0],b[1],b[2],b[3]);case"ComponentsConfiguration":return this.stringValues[a][b[0]]+this.stringValues[a][b[1]]+this.stringValues[a][b[2]]+this.stringValues[a][b[3]];case"GPSVersionID":return b[0]+"."+b[1]+"."+b[2]+"."+b[3]}return String(b)},function(a){var b,c=a.tags,d=a.map;for(b in c)c.hasOwnProperty(b)&&(d[c[b]]=b)}(a.ExifMap.prototype),a.ExifMap.prototype.getAll=function(){var a,b,c={};for(a in this)this.hasOwnProperty(a)&&(b=this.tags[a])&&(c[b]=this.getText(b));return c}}),function(){"use strict";var isPerformanceMethodSupported,slice=[].slice;isPerformanceMethodSupported=function(method){return window.performance&&_.isFunction(window.performance[method])},this.app.factory("performance",function(){var clearMarks,clearMeasures,getDurationBetweenMarks,getEntriesByName,mark,measure,now;return now=function(){return isPerformanceMethodSupported("now")?performance.now():0},mark=function(name){return isPerformanceMethodSupported("mark")?performance.mark(name):void 0},measure=function(_this){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],isPerformanceMethodSupported("measure")?performance.measure.apply(performance,args):void 0}}(),getEntriesByName=function(_this){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],isPerformanceMethodSupported("getEntriesByName")?performance.getEntriesByName.apply(performance,args):[]}}(),clearMarks=function(_this){return function(){return isPerformanceMethodSupported("clearMarks")?performance.clearMarks():void 0}}(),clearMeasures=function(_this){return function(){return isPerformanceMethodSupported("clearMeasures")?performance.clearMeasures():void 0}}(),getDurationBetweenMarks=function(startMark,endMark){var lastMark,markName;return isPerformanceMethodSupported("measure")?(markName=startMark+"-"+endMark,measure(markName,startMark,endMark),lastMark=_.last(getEntriesByName(markName)),(null!=lastMark?lastMark.duration:void 0)||0):0},{now:now,mark:mark,measure:measure,getEntriesByName:getEntriesByName,clearMarks:clearMarks,clearMeasures:clearMeasures,getDurationBetweenMarks:getDurationBetweenMarks}})}.call(this),function(){"use strict";this.app.factory("confirm",function($document,$sce,ngDialog,i18n){return function(options){var $body,confirmOnKeyup,dialog;return dialog=ngDialog.open({template:"scripts/pages/_partials/confirmation.html",className:options.className?options.className:void 0,controller:function($scope){return function(){return options.confirmMessage=$sce.trustAsHtml(options.confirmMessage),options.confirmTitle||(options.confirmTitle=i18n.translate("dialog.warn_title")),options.confirmYes||(options.confirmYes=i18n.translate("dialog.yes")),options.confirmNo||(options.confirmNo=i18n.translate("dialog.no")),_.assign($scope,options)}},preCloseCallback:function(){$body.off("keyup",confirmOnKeyup)},closeByEscape:!1,preserveFocus:!1}),$body=$document.find("body"),confirmOnKeyup=function(event){if(27===event.keyCode&&(event.stopPropagation(),$body.off("keyup",confirmOnKeyup),dialog.close()),13===event.keyCode)return $body.off("keyup",confirmOnKeyup),"function"==typeof options.confirm&&options.confirm(),dialog.close()},$body.on("keyup",confirmOnKeyup)}})}.call(this),function(){"use strict";this.app.factory("localizeDate",function($filter,i18n){return function(milliseconds){return $filter("date")(milliseconds,i18n.translate("date_format"))}})}.call(this),function(){"use strict";this.app.factory("path",function($state,tabs){var getSelectedTabId,tabsPaths;return tabsPaths={},getSelectedTabId=function(){var selectedTab;return selectedTab=_.find(tabs,function(tab){return $state.includes(tab.state)}),null!=selectedTab?selectedTab.id:void 0},{set:function(newPath){return tabsPaths[getSelectedTabId()]=newPath},get:function(){return tabsPaths[getSelectedTabId()]||[]},setFull:function(fullPath){var pathArray,tabId;if(pathArray=fullPath.split("/"),null!=(tabId=pathArray[0]))return tabsPaths[tabId]=pathArray.slice(1)},getFull:function(){var path,tabId;return tabId=getSelectedTabId(),path=""+tabId,tabsPaths[tabId]&&(path+="/"+tabsPaths[tabId].join("/")),path}}})}.call(this),function(){"use strict";this.app.factory("SelectedEntities",function(){var set;return set=new Set,set.get=function(){var array;return array=[],this.forEach(function(el){return array.push(el)}),array},set})}.call(this),function(){"use strict";this.app.factory("futureArrayFromPromise",function($q){return function(promise){var deferred,futureObj;return futureObj=[],deferred=$q.defer(),futureObj.$resolved=!1,futureObj.$promise=deferred.promise,promise.then(function(entities){return _.forEach(entities,function(e){return futureObj.push(e)}),futureObj.$resolved=!0,deferred.resolve(futureObj)},function(r){return futureObj.$resolved=!0,deferred.reject(r)}),futureObj}})}.call(this),function(){"use strict";this.app.constant("htmlEncode",function(html){return $("<div/>").text(html).html()})}.call(this),function(){"use strict";var slice=[].slice;this.app.filter("unsafe",function(i18n,$sce){return function(){var args,input;return input=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],$sce.trustAsHtml(i18n.translate(input,args))}}),this.app.filter("translate",function(i18n){return function(){var args,input;return input=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],i18n.translate(input,args)}}),this.app.factory("LoadLocales",function($q,$http,$rootScope,i18n){return function(settings){var loadTranslations;return loadTranslations=function(i18nCode){return $http.get("locales/media_gallery_"+i18nCode+".json",{withCredentials:!1}).then(function(response){return i18n.updateTranslations(response.data),i18n.setPrefix(settings.i18nPrefix),i18n.setLang(i18nCode)},function(reason){var d;return d=$q.defer(),d.reject({code:123,message:"Could not load translations"}),d.promise})},"en"===settings.i18nCode?loadTranslations("en"):loadTranslations(settings.i18nCode).then(null,function(){return loadTranslations("en")})}}),this.app.factory("i18n",function(localeOverride,settings){var areLoaded,getAllOverride,getFullKey,getLang,getLocalesValue,getSettingsValue,getTranslation,lang,prefix,prefixRegExp,setLang,setPrefix,translate,translations,updateTranslations;return prefix="",lang="en",translations={},prefixRegExp=/(.*?)_/,areLoaded=function(){return _.size(translations)},updateTranslations=function(newTranslations){return translations=newTranslations},getAllOverride=function(key){return localeOverride.all[key].replace(/%s/,lang)},getLocalesValue=function(key){var ref,ref1;return(null!=(ref=localeOverride[lang])?ref[key]:void 0)||(null!=(ref1=localeOverride.all)?ref1[key]:void 0)&&getAllOverride(key)||translations[key]},getSettingsValue=function(key){return settings.translations[key]},getTranslation=function(key,args,getValue){var value;return value=getValue(key),value.replace(/%{(\d+?)}/g,function(match,index){return args[index]})},getFullKey=function(key,getValue){var currentPrefix;for(currentPrefix=prefix;!getValue(currentPrefix+":"+key)&&prefixRegExp.test(currentPrefix);)currentPrefix=currentPrefix.replace(prefixRegExp,"");return getValue(currentPrefix+":"+key)?currentPrefix+":"+key:getValue(key)?key:void 0},translate=function(key,args,getValue){var fullKey;return fullKey=getFullKey(key,getValue),null!=fullKey?getTranslation(fullKey,args,getValue):getTranslation("no_translation",[key],getValue)},setPrefix=function(value){return prefix=""+value},setLang=function(code){return lang=code},getLang=function(){return lang},{updateTranslations:updateTranslations,areLoaded:areLoaded,translate:function(key,args){var translation;return getFullKey(key,getSettingsValue)?translate(key,args,getSettingsValue):(translation=translate(key,args,getLocalesValue),settings.helpId&&(null!=key?key.indexOf("help_url"):void 0)>=0&&(translation=translation.replace(/(itemId=)(.+)/,"$1"+settings.helpId)),translation)},isTranslatable:function(key){return!!getFullKey(key,getSettingsValue)||!!getFullKey(key,getLocalesValue)},setPrefix:setPrefix,getLang:getLang,setLang:setLang}})}.call(this),function(){"use strict";this.app.value("localeOverride",{all:{date_format:"MM/dd/yyyy",help_contributors_url:"//%s.wix.com/support/html5/article/about-site-contributors",help_url:"//%s.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=4987f658-4243-4d84-8581-1a36f09e0f83","shape:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=da3604d7-39d0-4882-b80d-91d3f4c39f6d","document:help_url":"//%s.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=e637f635-94d3-4a01-854a-d18a666bd643",
"video:help_url":"//%s.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=b80afb39-4814-4e05-ae5c-e4e00ff6c949","music:help_url":"//%s.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=eee746d7-6e5e-4bec-bdce-252d06265195","secure_music:help_url":"//%s.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=eee746d7-6e5e-4bec-bdce-252d06265195"},cs:{date_format:"dd.MM.yyyy"},da:{date_format:"dd/MM/yyyy"},de:{date_format:"dd.MM.yyyy"},en:{help_contributors_url:"//www.wix.com/support/html5/article/about-site-contributors",help_url:"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=4987f658-4243-4d84-8581-1a36f09e0f83","shape:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=da3604d7-39d0-4882-b80d-91d3f4c39f6d","document:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=e637f635-94d3-4a01-854a-d18a666bd643","video:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=b80afb39-4814-4e05-ae5c-e4e00ff6c949","music:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=eee746d7-6e5e-4bec-bdce-252d06265195","secure_music:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=eee746d7-6e5e-4bec-bdce-252d06265195"},es:{date_format:"dd/MM/yyyy"},fi:{date_format:"dd.MM.yyyy"},fr:{date_format:"dd/MM/yyyy"},hi:{date_format:"dd/MM/yyyy"},it:{date_format:"dd/MM/yyyy"},ja:{date_format:"yyyy/MM/dd"},ko:{date_format:"yyyy.MM.dd"},nl:{date_format:"dd-MM-yyyy"},no:{date_format:"dd.MM.yyyy"},pl:{date_format:"dd.MM.yyyy"},pt:{date_format:"dd/MM/yyyy"},ru:{date_format:"dd.MM.yyyy"},sv:{date_format:"yyyy-MM-dd"},tr:{date_format:"dd.MM.yyyy"},zh:{date_format:"yyyy-MM-dd",help_contributors_url:"//www.wix.com/support/html5/article/about-site-contributors",help_url:"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=4987f658-4243-4d84-8581-1a36f09e0f83","shape:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=da3604d7-39d0-4882-b80d-91d3f4c39f6d","document:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=e637f635-94d3-4a01-854a-d18a666bd643","video:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=b80afb39-4814-4e05-ae5c-e4e00ff6c949","music:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=eee746d7-6e5e-4bec-bdce-252d06265195","secure_music:help_url":"//www.wix.com/support/html5/widget/0/cb6480f3-768b-4737-ab8f-10fe2e4fa2ab#/main/view?itemId=eee746d7-6e5e-4bec-bdce-252d06265195"}})}.call(this),function(){"use strict";this.app.factory("editorConnection",function(events){var editorConnection;return editorConnection=new WindowMessenger(window.parent),events.on(events.ITEMS.REMOVE,function(promises,event){return _.forEach(promises,function(promise){return promise.then(function(result){return editorConnection.emit("itemremove",{id:result.data.id,source:event.eventTarget.name})})})}),editorConnection})}.call(this),function(){"use strict";this.app.factory("importItems",function($q,tabs,settings){return function(items,adapterName){var adapter,importItem;return adapter=tabs.private.getAdapter(),settings.maxParallelUploads&&(wixmp.Uploader.maxParallelUploads=settings.maxParallelUploads),importItem=function(item,tag){var filesToUpload;return filesToUpload=wixmp.Uploader.upload([{uploadFn:adapter.item.uploadByUrl,source:{url:item.fileUrl,name:item.name||"Untitled",tags:["_social","_imported","_"+adapterName,tag],mediaType:settings.mediaType}}]),filesToUpload[0].deferred.promise.then(function(res){return res.data})},_.map(items,function(item){var tag;return tag="_"+adapterName+"_"+item.id,adapter.items.searchByTag(tag).then(function(result){var ref;return(null!=(ref=result.data)?ref.length:void 0)?result.data[0]:importItem(item,tag)},function(){return importItem(item,tag)})})}})}.call(this),function(){"use strict";this.app.constant("uploadSizesLimits",{default:26214400,document:26214400,picture:26214400,music:52428800,secureMusic:377487360,video:52428800,secureVideo:1610612736}),this.app.constant("uploadSizesLimitsHard",{default:262144e4,document:262144e4,picture:262144e4,music:524288e4,secureMusic:37748736e3,video:524288e5,secureVideo:161061273600}),this.app.factory("getFileSizeLimit",function(uploadSizesLimits){return function(mediaType){var customMediaTypes;return customMediaTypes={secure_music:"secureMusic",secure_video:"secureVideo"},uploadSizesLimits[mediaType]||uploadSizesLimits[customMediaTypes[mediaType]]||uploadSizesLimits.default}})}.call(this),function(){"use strict";this.app.factory("Cache",function(Adapter,$q){return function(adapter){var addItems,data,dropFolderCache,getFolderKey,getFolders,getItems,setItems;return data={items:{},folders:{}},dropFolderCache=function(folderKey){return delete data.items[folderKey]},getFolderKey=function(folder){return(null!=folder?folder.id:void 0)||(null!=folder?folder.virtualId:void 0)||null},setItems=function(promise,futureItems,folder){return promise.then(function(items){return data.items[getFolderKey(folder)]=_.clone(items)})},addItems=function(promise,futureItems,folder){return promise.then(function(items){return data.items[getFolderKey(folder)]=_.union(data.items[getFolderKey(folder)],items)})},adapter.on("getFolders",function(promise,futureFolders,folder){return promise.then(function(folders){return data.folders[null!=folder?folder.id:void 0]=folders})}),adapter.on("getItems",setItems),adapter.on("getMoreItems",addItems),adapter.on("removeItem",function(promise,item){return promise.then(function(){return _.forEach(data.items,function(cachedFolderArray){return _.remove(cachedFolderArray,item)})})}),adapter.on("removeFolder",function(promise,folder){var folderKey;return folderKey=getFolderKey(folder),promise.then(function(){return dropFolderCache(folderKey),dropFolderCache("AllMedia")})}),adapter.on("uploadFile",function(promise){return promise.then(function(item){return item.folderId&&dropFolderCache(item.folderId),delete data.items.AllMedia})}),adapter.on("moveItem",function(promise,item,folder){return promise.then(function(){return dropFolderCache(item.folderId),dropFolderCache(getFolderKey(folder))})}),adapter.getItems&&(getItems=adapter.getItems,adapter.getItems=function(folder,options){var items;return null==options&&(options={}),options=_.defaults(options,{cache:!0}),items=data.items[getFolderKey(folder)],options.cache&&null!=items?_.assign(items,{$resolved:!0,$promise:$q.when(items)}):getItems.apply(this,arguments)}),adapter.getFolders&&(getFolders=adapter.getFolders,adapter.getFolders=function(folder){var folders;return(folders=data.folders[null!=folder?folder.id:void 0])?_.assign(folders,{$resolved:!0,$promise:$q.when(folders)}):getFolders.apply(this,arguments)}),adapter}})}.call(this),function(){"use strict";this.app.factory("tabs",function($window,settings,wrapSource,supportedMediaTypes,supportedPublicMediaRoots,supportedExternalServices,uploadSizesLimitsHard,supportedExternalSearchServices,settingsPassedAdapter){var bigStockAdapter,canShowTab,collectionAdapter,externalAdapters,externalSearchAdapters,platformAdapter,prevAdapterSettings,privateAdapter,publicAdapter,settingsPassedAdapterWrapped,shutterStockAdapter,shutterStockVideoAdapter;return externalAdapters={},externalSearchAdapters={},prevAdapterSettings={},privateAdapter=null,platformAdapter=null,publicAdapter=null,bigStockAdapter=null,shutterStockAdapter=null,shutterStockVideoAdapter=null,collectionAdapter=null,settingsPassedAdapterWrapped=null,canShowTab=function(tab){return _.includes(settings.tabsList,tab.id)},{private:{id:"private",state:"app.private",translationKey:"private_media_tab",canShow:function(){return canShowTab(this)},getAdapter:function(){var ref,sourceSettings;return sourceSettings={apiUrl:settings.privateMediaRestAPI,filesUrl:settings.privateMediaRestFiles,videoFilesUrl:settings.privateMediaRestVideoFiles,imageOperationsApi:settings.imageOperationsApi,uploadLimits:uploadSizesLimitsHard,refreshTokenUrl:settings.refreshTokenUrl,requestOptions:settings.requestOptions,siteMediaToken:settings.siteMediaToken,vision:settings.vision,blackArrow:settings.blackArrow,asyncFontUpload:settings.asyncFontUpload,asyncUploadByUrl:settings.asyncUploadByUrl,asyncTranscoding:settings.asyncTranscoding},settings.namespace&&_.set(sourceSettings,"requestOptions.params.ns",settings.namespace),_.isEqual(prevAdapterSettings.private,sourceSettings)?(null!=privateAdapter&&null!=(ref=privateAdapter.blackArrow)&&ref.open(),privateAdapter):(prevAdapterSettings.private=_.clone(sourceSettings),privateAdapter=wrapSource(new wixmp.Source(wixmp.sources.PRIVATE,sourceSettings)),privateAdapter.blackArrow.open(),"debug"===settings.mode&&($window.private=privateAdapter),privateAdapter)}},platform:{id:"platform",state:"app.platform",translationKey:"private_media_tab",canShow:function(){return canShowTab(this)},getAdapter:function(){var ref,sourceSettings;return sourceSettings={apiUrl:settings.platformRestAPI,filesUrl:settings.platformRestFiles,videoFilesUrl:settings.platformRestVideoFiles,imageOperationsApi:settings.imageOperationsApi,uploadLimits:uploadSizesLimitsHard,refreshTokenUrl:settings.refreshTokenUrl,requestOptions:settings.requestOptions,blackArrow:settings.blackArrow},_.isEqual(prevAdapterSettings.platform,sourceSettings)?(null!=platformAdapter&&null!=(ref=platformAdapter.blackArrow)&&ref.open(),platformAdapter):(prevAdapterSettings.platform=_.clone(sourceSettings),platformAdapter=wrapSource(new wixmp.Source(wixmp.sources.PLATFORM,sourceSettings)),platformAdapter.blackArrow.open(),"debug"===settings.mode&&($window.private=platformAdapter),platformAdapter)}},public:{id:"public",state:"app.public",translationKey:"public_media_tab",canShow:function(){return canShowTab(this)},getAdapter:function(){var sourceSettings;return sourceSettings={apiUrl:settings.publicMediaRestAPI,filesUrl:settings.publicMediaRestFiles,imageOperationsApi:settings.imageOperationsApi,wixUser:settings.isEmailWithWixDomain},_.isEqual(prevAdapterSettings.public,sourceSettings)?publicAdapter:(prevAdapterSettings.public=_.clone(sourceSettings),publicAdapter=wrapSource(new wixmp.Source(wixmp.sources.PUBLIC,sourceSettings)),"debug"===settings.mode&&($window.public=publicAdapter),publicAdapter)}},photoStock:{id:"photoStock",state:"app.photoStock",translationKey:"photo_stock_tab",canShow:function(){return canShowTab(this)},getAdapter:function(){var sourceSettings;return sourceSettings={apiUrl:settings.bigStockSearchAPI},_.isEqual(prevAdapterSettings.photoStock,sourceSettings)?bigStockAdapter:(prevAdapterSettings.photoStock=_.clone(sourceSettings),bigStockAdapter=wrapSource(new wixmp.Source(wixmp.sources.BIGSTOCK,sourceSettings)))}},shutterStock:{id:"shutterStock",state:"app.shutterStock",translationKey:"shutterstock_tab",canShow:function(){return!1},getAdapter:function(){var sourceSettings;return sourceSettings={apiUrl:settings.shutterStockSearchAPI},_.isEqual(prevAdapterSettings.shutterStock,sourceSettings)?shutterStockAdapter:(prevAdapterSettings.shutterStock=_.clone(sourceSettings),shutterStockAdapter=wrapSource(new wixmp.Source(wixmp.sources.SHUTTERSTOCK,sourceSettings)))}},shutterStockVideo:{id:"shutterStockVideo",state:"app.shutterStockVideo",translationKey:"shutterstock_video_tab",canShow:function(){return!1},getAdapter:function(){return shutterStockVideoAdapter||(shutterStockVideoAdapter=wrapSource(new wixmp.Source(wixmp.sources.SHUTTERSTOCK_VIDEO)))}},externalSearch:{id:"externalSearch",state:"app.externalSearch",translationKey:"external_free_images_tab",canShow:function(){return!1},getAdapters:function(){return null!=externalSearchAdapters[settings.mediaType]?externalSearchAdapters[settings.mediaType]:externalSearchAdapters[settings.mediaType]=_(supportedExternalSearchServices).filter(function(service){return _.includes(settings.servicesList,service.name)&&_.includes(service.mediaTypes,settings.mediaType)}).map(function(service){var id;return id=_.snakeCase(service.name).toUpperCase(),wrapSource(new wixmp.Source(wixmp.sources[id]))}).value()}},external:{id:"external",state:"app.external",translationKey:"external_media_tab",canShow:function(){return!1},getAdapters:function(){return null!=externalAdapters[settings.mediaType]?externalAdapters[settings.mediaType]:externalAdapters[settings.mediaType]=_(settings.servicesList).filter(function(serviceName){return _.some(supportedExternalServices,function(externalService){return externalService.name===serviceName&&_.includes(externalService.mediaTypes,settings.mediaType)})}).map(function(serviceName){var id;return id=_.snakeCase(serviceName).toUpperCase(),"PICASA"===id&&(id="GOOGLE_PHOTOS"),wrapSource(new wixmp.Source(wixmp.sources[id]))}).value()}},collection:{id:"collection",state:"app.collection",translationKey:"collection_tab",canShow:function(){return canShowTab(this)},getAdapter:function(){var sourceSettings;return sourceSettings={apiUrl:settings.collectionsAPI,collectionId:settings.collectionId,filesUrl:settings.privateMediaRestFiles,imageOperationsApi:settings.imageOperationsApi},_.isEqual(prevAdapterSettings.collection,sourceSettings)?collectionAdapter:(prevAdapterSettings.collection=_.clone(sourceSettings),collectionAdapter=wrapSource(new wixmp.Source(wixmp.sources.COLLECTION,sourceSettings)))}},settingsPassed:{id:"settingsPassed",state:"app.settingsPassed",translationKey:"settings_passed_tab",canShow:function(){return canShowTab(this)},getAdapter:function(){return null!=settingsPassedAdapterWrapped?settingsPassedAdapterWrapped:settingsPassedAdapterWrapped=wrapSource(settingsPassedAdapter)}},custom:{id:"custom",state:"app.custom",getTitle:function(){var ref;return(null!=(ref=settings.customData)?ref.title:void 0)||""},canShow:function(){return canShowTab(this)}},empty:{id:"empty",state:"app.empty",canShow:function(){return!0},getAdapter:function(){var ref;return null!=privateAdapter&&null!=(ref=privateAdapter.blackArrow)?ref.close():void 0}}}})}.call(this),function(){"use strict";this.app.factory("NormalizeUri",function(){return function(url){return new URI(url).normalize()._string}}),this.app.factory("UrlSanitizeInterceptor",function($q,NormalizeUri){return{request:function(config){var deferred;return deferred=$q.defer(),config.url=NormalizeUri(config.url),deferred.resolve(config),deferred.promise}}})}.call(this),function(){"use strict";var slice=[].slice;this.app.factory("Notifications",function($timeout,$rootScope,editorConnection){var expireNotification,notifications,purgeNotifications,safeApply,sendNotification;return safeApply=function(callback){return $rootScope.$$phase?callback():$rootScope.$apply(function(){return callback()})},notifications=[],sendNotification=function(message,timeout,type){var messageId;return null==timeout&&(timeout=5e3),null==type&&(type="error"),messageId=UUID.generate(),message={id:messageId,message:message,type:type},notifications.push(message),timeout&&$timeout(function(){return expireNotification(messageId)},timeout),$rootScope.$emit("UiNotificationReceived",notifications),messageId},expireNotification=function(id){return _.remove(notifications,function(notification){return notification.id===id}),$rootScope.$emit("UiNotificationExpired",notifications)},purgeNotifications=function(){return notifications.length=0,$rootScope.$emit("UiNotificationsPurged",notifications)},window.purge=purgeNotifications,{send:function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],safeApply(function(){return sendNotification.apply(null,args)})},expire:function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],safeApply(function(){return expireNotification.apply(null,args)})},get:function(){return safeApply(function(){return notifications})}}})}.call(this),function(){this.app.constant("parseSiteToken",function(token){var parsed;parsed={};try{parsed=JSON.parse(JSON.parse(atob(token.split(".")[2])).data)}catch(error){return error,{userId:null,metasiteId:null}}return{userId:parsed.userId,metasiteId:parsed.metasiteId&&parsed.metasiteId.replace("_template_","")}})}.call(this),function(){"use strict";this.app.factory("MediaStudio",function($rootScope,tabs,i18n,settings,parseSiteToken,biReport){var mediaImageStudio;return mediaImageStudio=new MediaImageStudio.MediaImageStudio({initiator:"media-gallery-g5",siteToken:settings.siteMediaToken,metasiteId:parseSiteToken(settings.siteMediaToken).metaSiteId,mediaRoot:settings.publicMediaRoot,isUserLevelFile:!0}),{edit:function(image,folder){var imageDataSubscription;return imageDataSubscription=mediaImageStudio.once(MediaImageStudio.MediaImageStudioEvents.ImageData,function(imageData){var ext,file,filesToUpload,newName,parts;return parts=image.name.split("."),ext=imageData.type?imageData.type.split("/").pop().replace("jpeg","jpg"):parts.slice(-1).pop().toLowerCase(),newName=parts.slice(0,-1).join(".")+"_edited."+ext,imageData.name=newName,imageData.size||(imageData.size=0),file={uploadFn:tabs.private.getAdapter().item.upload,source:{file:imageData,name:newName,size:imageData.size,folderId:folder.id,folderName:folder.name,mediaType:settings.mediaType,tags:["edited"]},options:{isFromMediaStudio:!0}},settings.maxParallelUploads&&(wixmp.Uploader.maxParallelUploads=settings.maxParallelUploads),filesToUpload=wixmp.Uploader.upload([file]),_.last(filesToUpload).deferred.promise.then(function(res){return mediaImageStudio.hide(),res}),$rootScope.$apply(),biReport("uploadStarted",{files:1,media_type:settings.mediaType,mode:"media-studio"})}),mediaImageStudio.once(MediaImageStudio.MediaImageStudioEvents.Close,function(){return imageDataSubscription.remove()}),mediaImageStudio.show({fileId:image.id,mode:MediaImageStudio.MediaImageStudioMode.Transform})}}})}.call(this),function(){"use strict";this.app.factory("stockPayment",function($q,$rootScope,tabs,settings){return function(stockName){var getBoughtImage;return getBoughtImage=function(id,maxTryCount,tryCount){return null==maxTryCount&&(maxTryCount=7),null==tryCount&&(tryCount=0),tryCount++,tryCount>maxTryCount?$q.reject():tabs.private.getAdapter().items.searchByTag("_"+stockName+"_"+id).then(function(result){var deferred,items;return items=result.data,(null!=items?items.length:void 0)?items[0]:(deferred=$q.defer(),setTimeout(function(){return deferred.resolve()},2e3),deferred.promise.then(function(){return getBoughtImage(id,maxTryCount,tryCount)}))},function(){return getBoughtImage(id,maxTryCount,tryCount)})},{buyImage:function(item){var deferred,popup,url;return deferred=$q.defer(),"bigstock"===stockName?url=settings.bigStockPaymentAPI+"/services/bigstock/start_purchase?image_id="+item.id+"&size_code=l&altsku="+settings.bigStockAltSku:"shutterstock"===stockName?url=settings.bigStockPaymentAPI+"/services/shutterstock/start_purchase?image_id="+item.id+"&altsku="+settings.bigStockAltSku:"shutterStockVideo"===stockName&&(url=settings.shutterStockPaymentAPI+"/services/shutterstock/video/start_purchase?video_id="+item.id),popup=window.open(url,"purchase","width=1000,height=550,scrollbars=1"),popup.blur(),window.focus(),getBoughtImage(item.id,1).then(function(){return popup.close(),deferred.resolve({success:!0})},function(){var isCompleted;return popup.focus(),isCompleted=!1,window.processPayment=function(data){if(null==data&&(data={}),!isCompleted)return $rootScope.$apply(function(){return isCompleted=!0,"string"==typeof data&&(data=JSON.parse(data)),data.success?deferred.resolve(data):deferred.reject(data)})},window.addEventListener("message",function(event){if(window.debug&&console.log(event),/premium\./i.test(event.origin))return window.processPayment(event.data)},!1)}),deferred.promise},getBoughtImage:function(itemOrId){return getBoughtImage((null!=itemOrId?itemOrId.id:void 0)||itemOrId)}}}})}.call(this),function(){"use strict";this.app.factory("submitItems",function(settings,editorConnection,path,mediaTypes){var filterDomain,filterFileUrl;return filterDomain=function(string){var regexp;return regexp=/(http:\/\/[^\/]+\/)/i,string.replace(regexp,"")},filterFileUrl=function(fileUrl){return fileUrl.replace(/.*\//,"")},function(items){var result;return result={path:path.getFull(),items:_.map(items,function(item){var fileUrl,mapped,preview,ref;return fileUrl=item.fileUrl||"",mapped={id:item.id,mediaType:item.mediaType,fileName:filterFileUrl(fileUrl),uri:filterFileUrl(fileUrl),fileUrl:fileUrl,title:item.name.length>40?item.name.substr(0,40):item.name},_.includes([mediaTypes.PICTURE,mediaTypes.SECURE_PICTURE,mediaTypes.SWF,mediaTypes.VIDEO],mapped.mediaType)&&(mapped.width=item.width,mapped.height=item.height),"secure_music"===item.mediaType&&(mapped.sampleUrl=item.sampleUrl),item.fileInput&&(mapped.fileInput=item.fileInput),item.fileOutput&&(mapped.fileOutput=item.fileOutput),"secure_music"===item.mediaType&&(preview=_.find(null!=(ref=item.fileOutput)?ref.audio:void 0,function(audio){return"preview"===audio.tag}),mapped.previewFileName=null!=preview?preview.url.replace(/.*\//,""):void 0),"video"===item.mediaType&&(mapped.fileBaseUrl=fileUrl.split("/").slice(0,2).join("/"),item.embedHtml&&(mapped.embedHtml=item.embedHtml),item.externalSources&&(mapped.externalSources=item.externalSources)),_.forEach(settings.additionalItemAttributes,function(attrName){if(null==mapped[attrName])return mapped[attrName]=/Url/i.test(attrName)?filterDomain(item[attrName]):item[attrName]}),mapped})},editorConnection.emit("items",result)}})}.call(this),function(){"use strict";this.app.factory("RejectError",function(){var RejectError;return RejectError=function(){function RejectError(data,caller){this.caller=caller,"string"==typeof data&&(data={message:data}),_.assign(this,data)}return RejectError.prototype.toString=function(){return null!=this.caller?this.caller+": "+this.message:this.message},RejectError}(),_.assign(RejectError,{alreadyLoading:{code:-400,message:"Already loading"},tooShortCallInterval:{code:-401,message:"Too short call interval"},cantLoadMore:{code:-402,message:"No entities for load more"},noMethod:{code:-403,message:"Method is undefined or misspelled"},invalidFileSize:{code:-404,message:"Invalid file size"},noActionSubject:{code:-405,message:"No action subject"}})})}.call(this),function(){"use strict";var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};this.app.factory("LoadingHelper",function(){return function(){function LoadingHelper(obj,options){this.obj=obj,this.attach=bind(this.attach,this),this.loadTimeout=null,_.assign(this.options,options),this.obj[this.options.attributeName]}return LoadingHelper.prototype.options={minLoadInterval:1e3,attributeName:"isLoading"},LoadingHelper.prototype.isDeniedByInterval=function(){return null!=this.loadTimeout},LoadingHelper.prototype.attach=function(promise){return this.loadTimeout=setTimeout(function(_this){return function(){return _this.loadTimeout=null}}(this),this.options.minLoadInterval),this.obj[this.options.attributeName]=!0,promise.then(function(_this){return function(){return _this.obj[_this.options.attributeName]=!1}}(this),function(_this){return function(){return _this.obj[_this.options.attributeName]=!1}}(this))},LoadingHelper}()})}.call(this),function(){"use strict";this.app.factory("serviceRedirectUrl",function($location){return function(){return $location.absUrl().replace($location.url(),"").replace(/\/[^\/]+?$/,"/service_connected.html")}})}.call(this),function(){"use strict";this.app.constant("getThumbnailsSizes",function(){return window.devicePixelRatio>1.5?{thumbnail:{width:440,height:440,mode:"fill"},preview:{width:750,height:750,mode:"fit"}}:{thumbnail:{width:220,height:220,mode:"fill"},preview:{width:375,height:375,mode:"fit"}}})}.call(this),function(){"use strict";this.app.value("nestedMethod",{get:function(obj,namespace){var method;return method=obj,_.forEach(namespace.split("."),function(ns){if(null==(method=method[ns]))return!1}),method},set:function(obj,namespace,method){var nsList,originalMethod;return originalMethod=obj,nsList=namespace.split("."),_.forEach(nsList,function(ns,index){return originalMethod[ns]||(originalMethod[ns]={}),index===nsList.length-1?originalMethod[ns]=method:originalMethod=originalMethod[ns]}),obj}})}.call(this),function(){"use strict";this.app.factory("paginatedItemsListLoader",function($q,RejectError,getThumbnailsSizes){return function(adapter,getParentFolder,getSortOptions){var getOptions,paging;return paging=null,getOptions=function(){return _.assign({thumbnails:getThumbnailsSizes(),paging:paging},"function"==typeof getSortOptions?getSortOptions():void 0)},function(isFirstPage){var parentFolder,promise;return isFirstPage||(null!=paging?paging.cursor:void 0)?(isFirstPage&&(paging=null),parentFolder="function"==typeof getParentFolder?getParentFolder():void 0,promise=parentFolder?getParentFolder().itemsList(getOptions()):adapter.items.lightList?adapter.items.lightList(null,getOptions()):adapter.items.list(null,getOptions()),promise.then(function(list){return paging=list.paging,list})):$q.reject(new RejectError(RejectError.cantLoadMore,"EntitiesCtrl"))}}})}.call(this),function(){"use strict";this.app.factory("paginatedItemsSearchLoader",function(getThumbnailsSizes,$q,RejectError){return function(adapter,getParentFolder,getSortOptions){var getOptions,paging;return paging=null,getOptions=function(){return _.assign({thumbnails:getThumbnailsSizes(),paging:paging},"function"==typeof getSortOptions?getSortOptions():void 0)},function(query,isFirstPage){var parentFolder,promise;return isFirstPage||(null!=paging?paging.cursor:void 0)?(isFirstPage&&(paging=null),parentFolder="function"==typeof getParentFolder?getParentFolder():void 0,promise=parentFolder?getParentFolder().itemsSearch(query,getOptions()):adapter.items.search(null,query,getOptions()),promise.then(function(list){return paging=list.paging,list})):$q.reject(new RejectError(RejectError.cantLoadMore,"EntitiesCtrl"))}}})}.call(this),function(){"use strict";this.app.factory("getReadableFileSize",function(i18n){var fileSizes;return fileSizes=["bytes","kilobytes","megabytes","gigabytes","terabytes"],function(fileSize){var i,il;for(i=0,il=fileSizes.length;i<il&&(fileSize/=1024,i++,!(fileSize/1024<1)););return{size:fileSize,sizeType:i18n.translate("uploader."+fileSizes[i])}}})}.call(this),function(){"use strict";this.app.constant("productionSettings",{baseHost:"wix.com",uploadAdapterName:"private",windowStyle:"fullscreen",showTabs:!0,submitItems:!0,disableUpload:!1,selectionType:"multiple",mediaType:"picture",publicMediaRoot:"photos",i18nCode:"en",i18nPrefix:"",namespace:"",translations:{},cssUrl:"",hasPurchased:!0,hasFavorites:!1,hasSubfolders:!1,hasTrash:!1,canSubmitUntranscoded:!1,mp4PreviewsOnly:!0,useFastTranscoding:!1,biImageLoadSpeed:!1,bi:!0,experiments:!0,closeWindowOnEscape:!0,mode:"production",tabsList:["private","external","public","photoStock"],servicesList:["facebook","instagram","drive","flickr","picasa","deviantart","flickrSearch","googleSearch"],additionalItemAttributes:["sourceName","tags","tagsEn","labels","face","vendor","creator","reference"],maxParallelUploads:4,path:"",collectionId:"",recommendedPublicCategoryId:"630c9ae8-c079-409e-92a0-bb50fb9ab037",helpId:"",imageOperationsApi:"vanbrandt",privateMediaRestFiles:"//static.wixstatic.com",settingsPassedFiles:"//static.wixstatic.com",privateMediaRestVideoFiles:"//video.wixstatic.com",privateMediaRestDocumentFiles:"//docs.wixstatic.com",publicMediaRestFiles:"//static.wixstatic.com",publicMediaRestVideoFiles:"//video.wixstatic.com",privateMediaRestAPI:"https://files.wix.com",publicMediaRestAPI:"https://publicmedia.wix.com/public",bigStockPaymentAPI:"https://pix.wix.com",bigStockSearchAPI:"https://pix.wix.com/services/bigstock",shutterStockPaymentAPI:"https://pix.wix.com",shutterStockSearchAPI:"https://pix.wix.com/services/shutterstock",bigStockPriceUrl:"/_api/wix/digitalGoodsPriceQuote?digitalGoodsSkuGuid=31396262-3737-3438-2d31-3131312d3434",bigStockAltSku:"0",shutterStockPriceUrl:"/_api/wix/digitalGoodsPriceQuote?digitalGoodsSkuGuid=32313337-3765-3164-2D66-6164332D3131",collectionsAPI:"//collections.wixstatic.com/collections",videoEncodingProfile:"mp4-only",resumableUpload:!1,blackArrow:{enabled:!0},blackArrowTests:!1,asyncFontUpload:!1,asyncUploadByUrl:!1,asyncTranscoding:!0,isEmailWithWixDomain:!1,stockShutterOn:"0",shutterStockVideoTabOn:"0"})}.call(this),function(){"use strict";this.app.constant("testSettings",{baseHost:"ten.wixpress.com",uploadAdapterName:"private",windowStyle:"fullscreen",showTabs:!0,submitItems:!0,disableUpload:!1,selectionType:"multiple",mediaType:"picture",publicMediaRoot:"photos",i18nCode:"en",i18nPrefix:"",namespace:"",translations:{},cssUrl:"",hasPurchased:!0,hasFavorites:!1,hasSubfolders:!1,hasTrash:!1,canSubmitUntranscoded:!1,mp4PreviewsOnly:!0,useFastTranscoding:!1,biImageLoadSpeed:!1,bi:!0,experiments:!0,closeWindowOnEscape:!0,mode:"test",tabsList:["private","external","public","photoStock","externalSearch","collection"],servicesList:["facebook","instagram","dropbox","drive","flickr","picasa","deviantart","flickrSearch","googleSearch"],additionalItemAttributes:["sourceName","tags","tagsEn","labels","vendor","creator","reference"],maxParallelUploads:4,path:"",collectionId:"",recommendedPublicCategoryId:"630c9ae8-c079-409e-92a0-bb50fb9ab037",helpId:"",imageOperationsApi:"vangogh",privateMediaRestFiles:"//static.{baseHost}",settingsPassedFiles:"//static.{baseHost}",privateMediaRestVideoFiles:"//video.{baseHost}",privateMediaRestDocumentFiles:"//docs.wixstatic.com",publicMediaRestFiles:"//static.{baseHost}",publicMediaRestVideoFiles:"//video-dev.{baseHost}",privateMediaRestAPI:"https://files.{baseHost}",publicMediaRestAPI:"https://publicmedia.{baseHost}/public",bigStockPaymentAPI:"https://pix.wix.com",bigStockSearchAPI:"https://pix.wix.com/services/bigstock",shutterStockPaymentAPI:"https://pix.wix.com",collectionsAPI:"//collections.wixstatic.com/collections",videoEncodingProfile:"mp4-only",resumableUpload:!1,blackArrow:{enabled:!1},blackArrowTests:!1})}.call(this),function(){"use strict";this.app.constant("openSettings",{baseHost:"open.wixmp.com",uploadAdapterName:"platform",windowStyle:"fullscreen",showTabs:!0,submitItems:!0,disableUpload:!1,selectionType:"multiple",mediaType:"picture",publicMediaRoot:"photos",i18nCode:"en",i18nPrefix:"",namespace:"",translations:{},cssUrl:"",hasPurchased:!0,hasFavorites:!1,hasSubfolders:!1,hasTrash:!1,canSubmitUntranscoded:!1,mp4PreviewsOnly:!0,useFastTranscoding:!1,biImageLoadSpeed:!1,bi:!1,experiments:!1,closeWindowOnEscape:!0,mode:"production",tabsList:["platform"],servicesList:[],additionalItemAttributes:["sourceName","tags","labels","meta"],path:"",collectionId:"",recommendedPublicCategoryId:"630c9ae8-c079-409e-92a0-bb50fb9ab037",helpId:"",platformRestAPI:"//wixmp-8cbe8e680e95a22c77c8d3d0.appspot.com/mmgr/",platformRestFiles:"//images-wixmp-8cbe8e680e95a22c77c8d3d0.wixmp.com",platformRestVideoFiles:"",imageOperationsApi:"vanbrandt",privateMediaRestFiles:"//static.wixstatic.com",settingsPassedFiles:"//static.wixstatic.com",privateMediaRestVideoFiles:"//video.wixstatic.com",privateMediaRestDocumentFiles:"//docs.wixstatic.com",publicMediaRestFiles:"//static.wixstatic.com",publicMediaRestVideoFiles:"//video.wixstatic.com",privateMediaRestAPI:"https://files.wix.com",publicMediaRestAPI:"https://publicmedia.wix.com/public",bigStockPaymentAPI:"https://pix.wix.com",bigStockSearchAPI:"https://pix.wix.com/services/bigstock",shutterStockPaymentAPI:"https://pix.wix.com",bigStockPriceUrl:"",collectionsAPI:"//collections.wixstatic.com/collections",videoEncodingProfile:"mp4-only",resumableUpload:!1,blackArrow:{enabled:!0},blackArrowTests:!1})}.call(this),
function(){"use strict";this.app.factory("getDefaultSettings",function(productionSettings,testSettings,openSettings){var baseHostRule;return baseHostRule=/\{baseHost\}/i,function(baseHost,mediaType){var defaultSettings;return null==baseHost&&(baseHost=""),null==mediaType&&(mediaType=""),defaultSettings=/\.wixpress\.com/i.test(baseHost)?testSettings:/open\.wixmp\.com/i.test(baseHost)?openSettings:productionSettings,defaultSettings=_.cloneDeep(defaultSettings),_.forEach(defaultSettings,function(value,key){return"string"==typeof value&&baseHostRule.test(value)&&(defaultSettings[key]=value.replace(baseHostRule,baseHost)),!0}),"secure_picture"===mediaType&&(defaultSettings.privateMediaRestFiles=defaultSettings.privateMediaRestAPI+"/secure-image"),defaultSettings}})}.call(this),function(){"use strict";this.app.service("getExperimentsSettings",function($q,$http){var TIMEOUT,currentSettings,experimentsSettings;return experimentsSettings={blackArrowTestsExp:{blackArrowTests:!0},resumableUpload:{resumableUpload:!0},publicMediaCDN:{publicMediaRestAPI:"https://publicmedia.wixmp.com/public"},stockBigPrice:{bigStockPriceUrl:"/_api/wix/digitalGoodsPriceQuote?digitalGoodsSkuGuid=32366262-3737-3438-2D38-3537332D3333",bigStockAltSku:"1"},stockShutter:{stockShutterOn:"1"},"specs.mmg5.ShutterStockVideoTab":{shutterStockVideoTabOn:"1"},"specs.mmg5.DisplayCropEditButton":{canDisplayCropEditButton:"1"}},currentSettings=null,TIMEOUT=1e3,function(settings){var hostname,url;return!settings.experiments||currentSettings?$q.when(currentSettings):_.isEmpty(_(settings.laboratory).values().filter().value())?(hostname=window.BASE_HOST?window.BASE_HOST:-1!==location.host.indexOf("local")?"www.wix.com":location.host,url="https://"+hostname+"/_api/wix-laboratory-server/laboratory/conductAllInScope?scope=media-manager",$http.get(url,{timeout:TIMEOUT}).then(function(res){var jsonSettings;return jsonSettings=res.data,_.forEach(jsonSettings,function(experimentValue,experimentName){if(null!=experimentsSettings[experimentName]&&("true"===experimentValue||"new"===experimentValue))return currentSettings=_.merge({},currentSettings,experimentsSettings[experimentName])}),currentSettings},function(){return $q.reject(currentSettings)})):(_.forEach(settings.laboratory,function(experimentValue,experimentName){if(null!=experimentsSettings[experimentName]&&experimentValue)return currentSettings=_.merge({},currentSettings,experimentsSettings[experimentName])}),$q.when(currentSettings))}})}.call(this),function(){"use strict";this.app.value("settings",{}),this.app.factory("Settings",function(_this){return function($rootScope,$q,$window,$state,$stateParams,performance,perfMarks,biReport,biFirst,getDefaultSettings,editorConnection,settings,tabs,path,getExperimentsSettings){var deferred,fedopsLogger,isFirstOpen,logger,prepare,redirectToPathOrFirstTab,ref,ref1,reload,replaceBigstockTabWithShutterstock,sendOpenSettingsBiReport,setSettings;return logger=new Logger("Settings"),biReport("dialogOpened",{version:$window.VERSION},null,!0),(null!=(ref=window.fedops)&&null!=(ref1=ref.logger)?ref1.create:void 0)&&(fedopsLogger=window.fedops.logger.create("media-manager-g5"),fedopsLogger.appLoaded()),redirectToPathOrFirstTab=function(currentPath){var splittedPath,tabToShow;return splittedPath=currentPath.split("/"),tabToShow=tabs[splittedPath[0]],(null!=tabToShow?tabToShow.canShow():void 0)||(tabToShow=_.find(tabs,function(tab){return tab.canShow()})),tabToShow?($state.transitionTo(tabToShow.state,$stateParams,{reload:!0,inherit:!1,notify:!0,location:"replace"}),path.setFull(currentPath)):(console.error("Can not find any tab to show."),console.warn(settings))},prepare=function(newSettings){var defaultSettings,set;return defaultSettings=getDefaultSettings(newSettings.baseHost,newSettings.mediaType),set=_.merge(defaultSettings,newSettings,function(defaultOption,currentOption){return _.isArray(defaultOption)?currentOption:_.isObject(defaultOption)&&_.isObject(currentOption)?_.merge(defaultOption,currentOption):_.isUndefined(currentOption)||_.isNull(currentOption)||""===currentOption?defaultOption:currentOption}),_.isString(set.tabsList)&&(set.tabsList=set.tabsList.split(",")),_.isString(set.servicesList)&&(set.servicesList=set.servicesList.split(",")),null!=newSettings.publicMediaFile&&(set.publicMediaRoot=newSettings.publicMediaFile),"default"===set.publicMediaRoot&&(set.publicMediaRoot=defaultSettings.publicMediaRoot),null!=newSettings.canShowTabs&&(set.showTabs=newSettings.canShowTabs),null!=newSettings.canShowSelectButton&&(set.submitItems=newSettings.canShowSelectButton),null!=newSettings.showSelectButton&&(set.submitItems=newSettings.showSelectButton),_.isString(newSettings.translations)&&newSettings.translations&&(set.translations=JSON.parse(newSettings.translations)),_.forEach(set,function(val,key){if("true"===val&&(set[key]=!0),"false"===val)return set[key]=!1}),set},deferred=$q.defer(),setSettings=function(newSettings,settings,experimentsSettings){return settings=_(settings).extend(newSettings).merge(experimentsSettings).value(),deferred.resolve(settings),logger.log("Settings was set",settings)},replaceBigstockTabWithShutterstock=function(settings){if(settings.tabsList.indexOf("photoStock")>=0)return _.remove(settings.tabsList,function(tabName){return"shutterStock"===tabName}),settings.tabsList.splice(settings.tabsList.indexOf("photoStock"),1,"shutterStock")},isFirstOpen=biFirst("MMOpenSettings"),sendOpenSettingsBiReport=function(experimentsLoaded){return performance.mark(perfMarks.OPEN_END),biReport("MMOpenSettings",{loadingTime:Math.round(performance.getDurationBetweenMarks(perfMarks.OPEN_START,perfMarks.OPEN_END)),media_type:settings.mediaType,session_id:window.sessionId,site_id:window.siteId,source:settings.openSource,origin:settings.origin,tab_name:settings.path.split("/")[0],isFirst:isFirstOpen.get()},"media-mr"),isFirstOpen.set(!1)},reload=function(newSettings){var ref2;return isFirstOpen||(performance.mark(perfMarks.LOAD_START),performance.mark(perfMarks.OPEN_START)),logger.log("New settings received",newSettings),null!=(ref2=_this.appLoadNotifiers)&&ref2.settingsReceivedFromProtocol(),newSettings=prepare(newSettings),getExperimentsSettings(newSettings).then(function(experimentsSettings){return setSettings(newSettings,settings,experimentsSettings),replaceBigstockTabWithShutterstock(settings),sendOpenSettingsBiReport(!0),"1"===settings.shutterStockVideoTabOn&&"video"===settings.mediaType&&-1===settings.tabsList.indexOf("shutterStockVideo")&&settings.tabsList.push("shutterStockVideo"),redirectToPathOrFirstTab(settings.path)}).catch(function(experimentsSettings){return setSettings(newSettings,settings,experimentsSettings),replaceBigstockTabWithShutterstock(settings),sendOpenSettingsBiReport(!1),redirectToPathOrFirstTab(settings.path)}).then(function(){return setTimeout(function(){return editorConnection.emit("settingsReady",!0)},500)})},editorConnection.on("settings",reload),editorConnection.on("empty",function(){return $state.go("app.empty")}),{reload:reload,isLoaded:deferred.promise}}}(this))}.call(this),function(){"use strict";this.app.constant("BIEventsIds",{dialogOpen:100,dialogOpened:101,uploadStarted:103,uiEvent:134,imageLoadSpeed:143,webSockets:145,MMOpenSettings:500,MMLoaded:502,feedbackTrigger:199})}.call(this),function(){"use strict";this.app.service("biUiEvents",function(biReport,settings,path){return function(eventName,options){return options.eventName=eventName,options.mediaType=settings.mediaType,options.i18nCode=settings.i18nCode,options.publicMediaRoot=settings.publicMediaRoot,options.path||(options.path=path.getFull()),biReport("uiEvent",options)}})}.call(this),function(){"use strict";this.app.service("biFirst",function(){var cache;return cache={},function(key){return"boolean"!=typeof cache[key]&&(cache[key]=!0),{get:function(){return cache[key]},set:function(value){return cache[key]=Boolean(value)}}}})}.call(this),function(){"use strict";this.app.service("biReport",function(_this){return function(BIEventsIds,settings){return function(eventName,data,projectSrc,force){var image;if(null==projectSrc&&(projectSrc="mg"),null==force&&(force=!1),settings.bi||force)return data=_.assign({evid:BIEventsIds[eventName]},data),image=new Image,image.src=_this.BIURL+"/"+projectSrc+"?src=26&"+$.param(data)+"&_="+(new Date).getTime()}}}(this))}.call(this),function(){"use strict";this.app.service("biSubscribeUpload",function(biReport){var filesToUpload,getCurrentTime,send,uploadSessionId,uploadStartTime;return filesToUpload=[],uploadStartTime=0,uploadSessionId=null,getCurrentTime=function(){return(new Date).getTime()},send=function(eventName,options){var data;return data={usi:uploadSessionId,did:window.siteId||window.sessionId,src:26},biReport(eventName,_.assign(data,options))},function(){return wixmp.Uploader.on("uploadQueueStarted",function(queue){return uploadSessionId=UUID.generate(),uploadStartTime=getCurrentTime(),filesToUpload=_.filter(queue,function(file){return"waiting"===file.status}),send("uploadQueueStarted",{files:filesToUpload.length,mode:"html5"})}),wixmp.Uploader.on("uploadQueueFinished",function(){var eventName,failsCount,speed,successBytes,uploadingTimeSec;if(!((uploadingTimeSec=(getCurrentTime()-uploadStartTime)/1e3)<1||(successBytes=_.sum(filesToUpload,function(fileToUpload){return"failed"!==fileToUpload.status?fileToUpload.source.file.size:0}))<10240))return failsCount=_.sum(filesToUpload,function(fileToUpload){return"failed"===fileToUpload.status?1:0}),eventName=failsCount>0?"uploadQueueFail":"uploadQueueSuccess",speed=Math.floor(successBytes/uploadingTimeSec),speed<=0&&(speed=-1),send(eventName,{files:filesToUpload.length,errors:failsCount,speedBytesPerSecond:speed})})}})}.call(this),function(){this.app.factory("biMeasureImageLoadSpeed",function($http,biReport,settings){return function(){if(settings.biImageLoadSpeed&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))return $http.get("//collections.wixstatic.com/collections/931f1bd1-2757-447f-a581-34517630a80c.json",{withCredentials:!1}).then(function(res){var canMeasure,minResponseTimeMs,promise,ref,ref1,ref2,ref3,runTestPercent,start;if(runTestPercent=(null!=(ref=res.data.collection)&&null!=(ref1=ref.public_properties)?ref1.run_test_percent:void 0)||10,canMeasure="debug"===settings.mode||/local(\.|host)/i.test(document.location.host)||100*Math.random()<runTestPercent,minResponseTimeMs=(null!=(ref2=res.data.collection)&&null!=(ref3=ref2.public_properties)?ref3.min_response_time_ms:void 0)||10,canMeasure)return start=null,promise=new Promise(function(resolve){return start=resolve}),_.forEach(_.shuffle(res.data.collection.items),function(item){var cdnid,headers,iframeUrl,itemid,sever,url;if(itemid=item.id+"",url=item.public_properties.url)return headers=item.public_properties.headers,sever=/^((https?:)?\/\/[^\/]+)/i.exec(url)[1],iframeUrl=item.public_properties.iframe_url||sever+"/image_load_speed_v4.html",cdnid=item.public_properties.cdnid,promise=promise.then(function(){var $iframe,connection;return $iframe=$("<iframe>"),$iframe.css({display:"none"}),$iframe.prop({src:iframeUrl}),$iframe.appendTo("body"),connection=new WindowMessenger($iframe[0].contentWindow),connection.on("loadSpeed.readyForRequest",function(){return connection.emit("loadSpeed.measure",{url:url,headers:headers,itemid:itemid,cdnid:cdnid})}),connection.on("loadSpeed.result",function(data){var biData,getHeaderValue,hasHeader,ref4,response_size,response_speed,response_time_ms;if(data.options.itemid===itemid&&!(data.responseTimeMS<minResponseTimeMs)&&data.isSuccess&&200===data.responseCode&&(headers=data.responseHeaders.toLowerCase(),response_size=(null!=(ref4=headers.match(/content-length: ([0-9]+)/))?ref4[1]:void 0)||0,response_time_ms=data.responseTimeMS||0,response_speed=response_time_ms&&1e3*response_size/response_time_ms||0,!(response_size<1)))return biData={file_name:url,origin:"",cdn:"none",is_cache_hit:"false",response_size:response_size,response_time_ms:Math.round(response_time_ms),response_speed:Math.round(response_speed),description:JSON.stringify(headers)},getHeaderValue=function(headerName){var ref5;return null!=(ref5=new RegExp(headerName+": ?([^\n\r]+)").exec(headers))?ref5[1]:void 0},hasHeader=function(header){return headers.indexOf(header)>=0},hasHeader("x-goog-")?biData.origin="google":(hasHeader("x-amz-")||hasHeader("x-amz-"))&&(biData.origin="amazon"),/google/.test(getHeaderValue("via"))?(biData.cdn="google",biData.is_cache_hit=+getHeaderValue("age")>0?"true":"false"):hasHeader("x-akamai-request-id")?(biData.cdn="akamai",biData.is_cache_hit=/hit/.test(getHeaderValue("x-cache"))||/hit/.test(getHeaderValue("x-cache-remote"))?"true":"false"):/varnish/.test(getHeaderValue("via"))?(biData.cdn="fastly",biData.is_cache_hit=/hit/.test(getHeaderValue("x-cache"))?"true":"false"):/cloudfront/i.test(getHeaderValue("via"))&&(biData.cdn="cloudfront",biData.is_cache_hit=/hit/.test(getHeaderValue("x-cache"))?"true":"false"),biData.cdn+=":"+data.options.cdnid,biReport("imageLoadSpeed",biData)})})}),start(),promise})}})}.call(this),function(){"use strict";this.app.factory("TestWebsocket",function($q,biReport,openSettings){return function(adapter,settings){var TIMEOUT_TO_ERROR,TIME_START,blackArrow,convertTime,errorTimeoutId,getCurrentTime,messageToSend,onMessage,sendBi,sendErrorAfterTimeLimit;if(!_.isEqual(settings.baseHost,openSettings.baseHost)&&adapter.blackArrow&&_.get(settings,"blackArrow.enabled"))return TIME_START=0,TIMEOUT_TO_ERROR=3e4,errorTimeoutId=null,blackArrow=adapter.blackArrow,messageToSend={uniqueId:""+_.random(1,Number.MAX_SAFE_INTEGER)},getCurrentTime=function(){return(new Date).getTime()},convertTime=function(time){if(time)return time<=1e3?1:time<=5e3?5:time<=1e4?10:time<=3e4?30:time>3e4?100:void 0},sendBi=function(eventStatus,time){var data,timeConverted;return data={eventName:"ws_test",eventStatus:eventStatus+"_"+blackArrow.getStatus()},timeConverted=convertTime(time),timeConverted&&(data.time=timeConverted),biReport("webSockets",data)},onMessage=function(message){if(_.isEqual(message,messageToSend))return sendBi("message_received",getCurrentTime()-TIME_START),clearTimeout(errorTimeoutId),blackArrow.off("message",onMessage)},sendErrorAfterTimeLimit=function(){return errorTimeoutId=setTimeout(function(){if(blackArrow.getOpenStarted())return sendBi("message_error",getCurrentTime()-TIME_START),blackArrow.off("message",onMessage)},TIMEOUT_TO_ERROR)},setTimeout(function(){if(blackArrow.getOpenStarted())return blackArrow.send(messageToSend,null,"post"),TIME_START=getCurrentTime(),sendBi("message_sent"),sendErrorAfterTimeLimit()},2e4),blackArrow.on("message",onMessage)}})}.call(this),function(){"use strict";this.app.factory("bigstockPrice",function($q,$http,settings){return function(){var price,priceUrl;return(price=void 0)?$q.when(price):(priceUrl=settings.bigStockPriceUrl,$http.get(priceUrl+"&locale="+settings.i18nCode,{withCredentials:!1}).then(function(response){return price=response.data}))}})}.call(this),function(){"use strict";this.app.factory("shutterStockPrice",function($q,$http,settings){return function(){var price,priceUrl;return(price=void 0)?$q.when(price):(priceUrl=settings.shutterStockPriceUrl,$http.get(priceUrl+"&locale="+settings.i18nCode,{withCredentials:!1}).then(function(response){return price=response.data}))}})}.call(this),function(){this.app.factory("settingsPassedAdapter",function(editorConnection,settings){var addThumbnailsToItem,getLoader,itemsLoader;return getLoader=function(name){return function(){var args,requestId;return requestId=_.uniqueId(),args=Array.prototype.slice.call(arguments),new Promise(function(resolve,reject){var onReject,onResolve,unsubscribe;return unsubscribe=function(){return editorConnection.off("adapter."+name+".resolve",onResolve),editorConnection.off("adapter."+name+".reject",onReject)},onResolve=function(data){if(data.requestId===requestId)return unsubscribe(),resolve(data)},onReject=function(data){if(data.requestId===requestId)return unsubscribe(),reject(data)},editorConnection.on("adapter."+name+".resolve",onResolve),editorConnection.on("adapter."+name+".reject",onReject),editorConnection.emit("adapter."+name,{requestId:requestId,arguments:args})})}},addThumbnailsToItem=function(options,item){return _.extend(wixmp.thumbnailGenerator.getWixThumbnailsUrls(item,options.thumbnails,{filesUrl:settings.settingsPassedFiles,imageOperationsApi:settings.imageOperationsApi}),item)},itemsLoader=getLoader("itemsList"),{name:"settingsPassed",folders:{list:getLoader("foldersList")},items:{list:function(folderId,options){return itemsLoader.apply(this,arguments).then(function(res){return res.data=_.map(res.data,_.partial(addThumbnailsToItem,options)),res})}}}})}.call(this),function(){"use strict";this.app.factory("wrapSource",function(settings,events,digest,defaultOptions,virtualActions,nestedFoldersList,allMediaFolder,siteMediaFolder,favoritesFolder,trashFolder,unsortedFolder,purchasedFolder,canDoAction,wrapItems,wrapFolders){return function(source){var adapter;return adapter=_.cloneDeep(source),_.merge(adapter,events.integrateSource(source)),_.merge(adapter,defaultOptions(adapter)),_.merge(adapter,virtualActions(adapter)),_.merge(adapter,digest(adapter)),_.merge(adapter,canDoAction(adapter)),_.merge(adapter,unsortedFolder(adapter)),settings.hasSubfolders&&_.merge(adapter,nestedFoldersList(adapter)),settings.siteMediaToken&&_.merge(adapter,siteMediaFolder(adapter)),_.merge(adapter,allMediaFolder(adapter)),settings.hasPurchased&&_.merge(adapter,purchasedFolder(adapter)),settings.hasFavorites&&_.merge(adapter,favoritesFolder(adapter)),settings.hasTrash&&_.merge(adapter,trashFolder(adapter)),_.merge(adapter,wrapItems(adapter)),_.merge(adapter,wrapFolders(adapter))}})}.call(this),function(){"use strict";this.app.factory("appLoad",function(_this){return function(events){return{integrate:function(){return events.on(events.FOLDERS.LIST,function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.foldersLoaded():void 0}),events.on(events.FOLDERS.TRASH.LIST,function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.foldersLoaded():void 0}),events.on(events.ITEMS.LIST,function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.itemsLoaded():void 0}),events.on(events.ITEMS.SEARCH,function(){var ref;return null!=(ref=_this.appLoadNotifiers)?ref.itemsLoaded():void 0})}}}}(this))}.call(this),function(){"use strict";this.app.factory("canDoAction",function(settings){return function(adapter){return{can:{items:{list:function(){var ref;return null!=(ref=adapter.items)?ref.hasOwnProperty("list"):void 0},search:function(){var ref;return null!=(ref=adapter.items)?ref.hasOwnProperty("search"):void 0},remove:function(){var ref;return null!=(ref=adapter.items)?ref.hasOwnProperty("remove"):void 0},restore:function(){var ref,ref1;return settings.hasTrash&&(null!=(ref=adapter.items)&&null!=(ref1=ref.trash)?ref1.hasOwnProperty("restore"):void 0)},removeFromTrash:function(){var ref,ref1;return settings.hasTrash&&(null!=(ref=adapter.items)&&null!=(ref1=ref.trash)?ref1.hasOwnProperty("remove"):void 0)}},folders:{remove:function(){var ref;return null!=(ref=adapter.folders)?ref.hasOwnProperty("remove"):void 0},removeFromTrash:function(){var ref,ref1;return settings.hasTrash&&(null!=(ref=adapter.folders)&&null!=(ref1=ref.trash)?ref1.hasOwnProperty("remove"):void 0)},restore:function(){var ref,ref1;return settings.hasTrash&&(null!=(ref=adapter.folders)&&null!=(ref1=ref.trash)?ref1.hasOwnProperty("restore"):void 0)}},folder:{create:function(){var ref;return null!=(ref=adapter.folder)?ref.hasOwnProperty("create"):void 0},rename:function(){var ref;return null!=(ref=adapter.folder)?ref.hasOwnProperty("update"):void 0},move:function(){var ref;return settings.hasSubfolders&&(null!=(ref=adapter.folder)?ref.hasOwnProperty("update"):void 0)}},item:{upload:function(){var ref;return null!=(ref=adapter.item)?ref.hasOwnProperty("upload"):void 0},uploadByUrl:function(){var ref;return null!=(ref=adapter.item)?ref.hasOwnProperty("uploadByUrl"):void 0},rename:function(){var ref;return null!=(ref=adapter.item)?ref.hasOwnProperty("update"):void 0},move:function(){var ref;return null!=(ref=adapter.item)?ref.hasOwnProperty("update"):void 0},makeFavorites:function(){var ref;return settings.hasFavorites&&(null!=(ref=adapter.item)?ref.hasOwnProperty("makeFavorites"):void 0)},transcode:function(){return _.includes(["secure_music","video","secure_video"],settings.mediaType)&&adapter.hasOwnProperty("blackArrow")},getDownloadLink:function(){return"private"===adapter.name},skipImport:function(){return _.includes(["video","secure_video"],settings.mediaType)}}}}}})}.call(this),function(){"use strict";this.app.factory("digest",function($q,nestedMethod){return function(adapter){var addDigest,eventNames,getEventNames,methodsWithDigest;return getEventNames=function(obj,eventsNames){return null==eventsNames&&(eventsNames=[]),_.forEach(obj,function(eventName){return"string"==typeof eventName?eventsNames.push(eventName):getEventNames(eventName,eventsNames)}),eventsNames},addDigest=function(promise){return _.isArray(promise)?_.forEach(promise,function(promise){return $q.when(promise)}):$q.when(promise),promise},methodsWithDigest={},eventNames=getEventNames(adapter.events),_.forEach(eventNames,function(eventName){var method;if(adapter.events.on(eventName,addDigest),"function"==typeof(method=nestedMethod.get(adapter,eventName)))return nestedMethod.set(methodsWithDigest,eventName,function(){var promise;return promise=method.apply(this,arguments),addDigest(promise)})}),methodsWithDigest}})}.call(this),function(){"use strict";this.app.factory("events",function(_this){return function($window,$q){var addListener,callListeners,eventsList,globalListeners,integrateSource,logEvent,logger;return"function"==typeof wixmp.bi&&wixmp.bi(!0,{siteId:siteId,version:$window.VERSION}),logger=new _this.Logger("EVENTS"),logEvent=function(promises,event){var promisesList;return logger.log(event.eventTarget.name+"."+event.eventName+" emited",event.arguments),promisesList=_.isArray(promises)?promises:[promises],_.forEach(promisesList,function(promise){return promise.then(function(res){return logger.log(event.eventTarget.name+"."+event.eventName+" succeed",res),res},function(res){return logger.log(event.eventTarget.name+"."+event.eventName+" failed",res),res})}),promises},globalListeners=[],eventsList=_.cloneDeep(wixmp.events),eventsList.FOLDER.RENAME="folder.rename",eventsList.FOLDER.MOVE="folder.move",eventsList.ITEM.RENAME="item.rename",eventsList.ITEM.MOVE="item.move",eventsList.ITEM.MAKE_FAVORITES="item.makeFavorites",eventsList.ITEM.UMMAKE_FAVORITES="item.unmakeFavorites",callListeners=function(listeners,promise,event,wrap){return null==wrap&&(wrap=!0),_.forEach(listeners,function(listener){return wrap?_.isArray(promise)?listener(_.map(promise,$q.when),_.clone(event)):listener($q.when(promise),_.clone(event)):listener(promise,event)})},addListener=function(listeners,eventsNames,fn){return _.isString(eventsNames)&&(eventsNames=[eventsNames]),_.forEach(eventsNames,function(eventName){return listeners[eventName]||(listeners[eventName]=[]),listeners[eventName].push(fn)})},integrateSource=function(source){var emit,emitOnAddTag,emitOnAttrChanged,emitOnRemoveTag,getEventNames,onCurrentSource,sourceInterceptors,sourceListeners;return sourceListeners=[],sourceInterceptors=[],onCurrentSource=function(eventName,fn){return wixmp.events.on(eventName,function(promise,event){if(event.eventTarget===source)return fn.apply(this,arguments)})},emit=function(promise,event){return logEvent(promise,event),callListeners(sourceInterceptors[event.eventName],promise,event,!1),callListeners(sourceListeners[event.eventName],promise,event),callListeners(globalListeners[event.eventName],promise,event)},emitOnAttrChanged=function(attrName,newEventName,promise,event){var changes,newEvent,original;if(original=event.arguments[0],changes=event.arguments[1],null!=changes[attrName]&&original[attrName]!==changes[attrName])return newEvent=_.assign({},event,{eventName:newEventName}),emit.call(this,promise,newEvent)},emitOnAddTag=function(tagName,newEventName,promise,event){var changes,newEvent,originalData;if(originalData=event.arguments[0],changes=event.arguments[1],!_.includes(originalData.tags||[],tagName)&&_.includes(changes.tags||[],tagName))return newEvent=_.assign({},event,{eventName:newEventName}),emit.call(this,promise,newEvent)},emitOnRemoveTag=function(tagName,newEventName,promise,event){var changes,newEvent,originalData;if(originalData=event.arguments[0],changes=event.arguments[1],_.includes(originalData.tags||[],tagName)&&!_.includes(changes.tags||[],tagName))return newEvent=_.assign({},event,{eventName:newEventName}),emit.call(this,promise,newEvent)},getEventNames=function(obj,eventsNames){return null==eventsNames&&(eventsNames=[]),_.forEach(obj,function(eventName){return"string"==typeof eventName?eventsNames.push(eventName):getEventNames(eventName,eventsNames)}),eventsNames},_.forEach(getEventNames(wixmp.events),function(eventName){return onCurrentSource(eventName,emit)}),onCurrentSource(wixmp.events.FOLDER.UPDATE,_.partial(emitOnAttrChanged,"name",eventsList.FOLDER.RENAME)),onCurrentSource(wixmp.events.FOLDER.UPDATE,_.partial(emitOnAttrChanged,"parentId",eventsList.FOLDER.MOVE)),onCurrentSource(wixmp.events.ITEM.UPDATE,_.partial(emitOnAttrChanged,"name",eventsList.ITEM.RENAME)),onCurrentSource(wixmp.events.ITEM.UPDATE,_.partial(emitOnAttrChanged,"folderId",eventsList.ITEM.MOVE)),onCurrentSource(wixmp.events.ITEM.UPDATE,_.partial(emitOnAddTag,"_favorites",eventsList.ITEM.MAKE_FAVORITES)),onCurrentSource(wixmp.events.ITEM.UPDATE,_.partial(emitOnRemoveTag,"_favorites",eventsList.ITEM.UMMAKE_FAVORITES)),{events:_.assign({},eventsList,{on:_.partial(addListener,sourceListeners),intercept:_.partial(addListener,sourceInterceptors)})}},_.assign({},eventsList,{integrateSource:integrateSource,on:_.partial(addListener,globalListeners)})}}(this))}.call(this),function(){"use strict";this.app.factory("Folder",function(modelsMethodsWrappers,settings){var $$;return $$=modelsMethodsWrappers,function(){function Folder(adapter,data){var foldersList,foldersListAtTrash,itemsList,itemsListAtTrash,ref,ref1,remove,removeFromTrash;Object.defineProperty(this,"_isProcessing",{writable:!0,value:!1}),this.can={rename:function(_this){return function(){return!_this.isInTrash&&adapter.can.folder.rename()}}(this),moveItemIn:function(_this){return function(){return!_this.isInTrash&&adapter.can.item.move()}}(this),moveFolderIn:function(_this){return function(){return!_this.isInTrash&&adapter.can.folder.move()}}(this),uploadIn:function(_this){return function(){return!_this.isInTrash&&adapter.can.item.upload()}}(this),select:function(_this){return function(){return adapter.can.folder.move()}}(),submit:function(_this){return function(){return!1}}(),move:function(_this){return function(){return!_this.isInTrash&&adapter.can.folder.move()}}(this),restore:function(_this){return function(){return adapter.can.folders.restore()&&_this.isInTrash}}(this),remove:function(_this){return function(){return _this.isInTrash?adapter.can.folders.removeFromTrash():adapter.can.folders.remove()}}(this)},_.merge(this,data),this.mediaType||(this.mediaType=settings.mediaType),null!=this.thumbnailUrl&&0!==this.filesCount||(this.thumbnailUrl="images/thumbnails/subfolder.svg"),this.rename||(this.rename=$$.partialIfExists(adapter,"folder.rename",this.id)),this.restore||(this.restore=$$.partialIfExists(adapter,"folders.trash.restore",[this.id])),remove=$$.partialIfExists(adapter,"folders.remove",[this.id]),removeFromTrash=$$.partialIfExists(adapter,"folders.trash.remove",[this.id]),this.remove||(this.remove=function(_this){return function(){return _this.isInTrash?removeFromTrash.apply(_this,arguments):remove.apply(_this,arguments)}}(this)),null!=(null!=(ref=adapter.item)?ref.move:void 0)&&(this.moveItemIn||(this.moveItemIn=function(_this){return function(item){return adapter.item.move(item,_this.id)}}(this))),null!=(null!=(ref1=adapter.folder)?ref1.move:void 0)&&(this.moveFolderIn||(this.moveFolderIn=function(_this){return function(folder){return adapter.folder.move(folder,_this.id)}}(this))),foldersList=$$.partialIfExists(adapter,"folders.list",this.id),foldersListAtTrash=$$.partialIfExists(adapter,"folders.trash.list",this.id),this.foldersList||(this.foldersList=function(_this){return function(){return _this.isInTrash?foldersListAtTrash.apply(_this,arguments):foldersList.apply(_this,arguments)}}(this)),itemsList=_.get(adapter,"items.lightList")?$$.partialIfExists(adapter,"items.lightList",this.id):$$.partialIfExists(adapter,"items.list",this.id),itemsListAtTrash=$$.partialIfExists(adapter,"items.trash.list",this.id),this.itemsList||(this.itemsList=function(_this){return function(){return _this.isInTrash?itemsListAtTrash.apply(_this,arguments):itemsList.apply(_this,arguments)}}(this)),this.itemsSearch||(this.itemsSearch=$$.partialIfExists(adapter,"items.search",this.id)),_.forEach(["rename","remove"],function(_this){return function(actionName){return _this.can[actionName]=$$.disableAtProcessing(_this,_this.can[actionName])}}(this))}return Folder}()}),this.app.factory("wrapFolders",function(Folder,nestedMethod){return function(adapter){var folderCreate,foldersList,mapFolder,mapFoldersList,methods,ref,ref1,ref2,ref3,trashList;return mapFolder=function(res){return res.data=new Folder(adapter,res.data),res},mapFoldersList=function(list){return list.data=_.map(list.data,function(folderData){return new Folder(adapter,folderData)}),list},folderCreate=null!=(ref=adapter.folder)?ref.create:void 0,foldersList=null!=(ref1=adapter.folders)?ref1.list:void 0,trashList=null!=(ref2=adapter.folders)&&null!=(ref3=ref2.trash)?ref3.list:void 0,adapter.events.intercept([adapter.events.FOLDER.CREATE],function(promise){return promise.then(mapFolder)}),methods={},null!=folderCreate&&nestedMethod.set(methods,"folder.create",function(){return folderCreate.apply(this,arguments).then(mapFolder)}),null!=foldersList&&nestedMethod.set(methods,"folders.list",function(){return foldersList.apply(this,arguments).then(mapFoldersList)}),null!=trashList&&nestedMethod.set(methods,"folders.trash.list",function(){return trashList.apply(this,arguments).then(mapFoldersList)}),methods}})}.call(this),function(){"use strict";this.app.factory("Item",function(settings,mediaTypes,modelsMethodsWrappers,NormalizeUri,itemThumbnailExtender){var $$;return $$=modelsMethodsWrappers,function(){function Item(adapter,data){var asyncDownloading,canBuy,canEdit,canGetDownloadLink,canShowExternalVideoPreview,canShowImagePreview,canShowSvgInlinePreview,canShowVideoPreview,canTranscode,isDownloadSupportedByApi,remove,removeFromSiteMedia,removeFromTrash,untranscoded;this.sourceName=adapter.name,Object.defineProperty(this,"_isProcessing",{writable:!0,value:!1}),isDownloadSupportedByApi=function(){return"rembrandt"!==settings.imageOperationsApi},canEdit=function(_this){return function(){return!!settings.canDisplayCropEditButton&&(!_this.isInTrash&&!untranscoded()&&isDownloadSupportedByApi()&&"private"===adapter.name&&_.includes(["picture","watermark","site_icon"],_this.mediaType))}}(this),canShowImagePreview=function(_this){return function(){return!untranscoded()&&_.includes(["picture","secure_picture","watermark","site_icon","ufont","shape"],_this.mediaType)}}(this),canShowVideoPreview=function(_this){return function(){var ref;return(null!=(ref=data.videoPreviewUrls)?ref.length:void 0)&&!untranscoded()&&_.includes(["video","secure_video"],_this.mediaType)}}(this),canShowExternalVideoPreview=function(_this){return function(){return data.iframeSrc&&_.includes(["video","secure_video"],_this.mediaType)}}(this),canShowSvgInlinePreview=function(_this){return function(){return _.includes(["shape","secure_shape"],_this.mediaType)}}(this),canGetDownloadLink=function(_this){return function(){
return!_this.isInTrash&&!untranscoded()&&isDownloadSupportedByApi()&&adapter.can.item.getDownloadLink()&&!_.includes(["secure_music","secure_video","video","secure_picture","secure_document","secure_archive"],_this.mediaType)}}(this),canBuy=function(_this){return function(){return!untranscoded()&&_.includes(["shutterstock","shutterStockVideo"],adapter.name)}}(),untranscoded=function(_this){return function(){return _this.can.transcode()&&!_this.isTranscoded()}}(this),canTranscode=function(_this){return function(){return!_this.isInTrash&&adapter.can.item.transcode()&&null!=_this.transcodingStatus}}(this),asyncDownloading=function(_this){return function(){return"private"===adapter.name&&_.includes(["picture","secure_picture"],_this.mediaType)&&(!_this.width||!_this.height)}}(this),this.can={rename:function(_this){return function(){return!_this.isInTrash&&!untranscoded()&&adapter.can.item.rename()&&!_this.isInSiteMedia}}(this),move:function(_this){return function(){return!_this.isInTrash&&!untranscoded()&&adapter.can.item.move()}}(this),makeFavorites:function(_this){return function(){return!_this.isInTrash&&!untranscoded()&&settings.hasFavorites&&adapter.can.item.makeFavorites()}}(this),unmakeFavorites:function(_this){return function(){return!_this.isInTrash&&!untranscoded()&&settings.hasFavorites&&adapter.can.item.makeFavorites()&&_this.isFavorites()}}(this),transcode:function(_this){return function(){return canTranscode()}}(),submit:function(_this){return function(){return settings.submitItems&&!_this.isInTrash&&(!canTranscode()||(settings.canSubmitUntranscoded||"READY"===_this.transcodingStatus))&&!_this._isProcessing&&!asyncDownloading()}}(this),select:function(_this){return function(){return!0}}(),restore:function(_this){return function(){return adapter.can.items.restore()&&!untranscoded()&&_this.isInTrash}}(this),remove:function(_this){return function(){return _this.isInTrash?adapter.can.items.removeFromTrash():!_this.isInSiteMedia&&adapter.can.items.remove()}}(this),removeFromFolder:function(_this){return function(){return _this.isInSiteMedia&&(_this.isSiteOwner||!_this.isReadOnly(data))}}(this),edit:canEdit,showImagePreview:canShowImagePreview,showVideoPreview:canShowVideoPreview,showExternalVideoPreview:canShowExternalVideoPreview,showSvgInlinePreview:canShowSvgInlinePreview,getDownloadLink:canGetDownloadLink,buy:canBuy},_.merge(this,data),this.mediaType||(this.mediaType=settings.mediaType),_.assign(this,itemThumbnailExtender(this));try{this.name=decodeURIComponent(this.name)}catch(undefined){}this.rename||(this.rename=$$.partialIfExists(adapter,"item.rename",this.id)),remove=$$.partialIfExists(adapter,"items.remove",[this.id]),removeFromTrash=$$.partialIfExists(adapter,"items.trash.remove",[this.id]),removeFromSiteMedia=$$.partialIfExists(adapter,"items.siteMedia.remove",[this.id]),this.remove||(this.remove=function(_this){return function(){return _this.isInTrash?removeFromTrash.apply(_this,arguments):_this.isInSiteMedia?removeFromSiteMedia.apply(_this,arguments):remove.apply(_this,arguments)}}(this)),this.restore||(this.restore=$$.partialIfExists(adapter,"items.trash.restore",[this.id])),this.makeFavorites||(this.makeFavorites=$$.partialIfExists(adapter,"item.makeFavorites",this)),this.unmakeFavorites||(this.unmakeFavorites=$$.partialIfExists(adapter,"item.unmakeFavorites",this)),this.addToSiteMedia||(this.addToSiteMedia=$$.partialIfExists(adapter,"items.siteMedia.add",[this.id])),this.getDownloadLink||(this.getDownloadLink=function(){var currentExtension,downloadDomain,downloadName,getExtension,originalExtension;return downloadDomain=settings.privateMediaRestFiles,this.mediaType===mediaTypes.DOCUMENT&&(downloadDomain=settings.privateMediaRestDocumentFiles),getExtension=function(fileName){return/[^.]*$/.exec(fileName)[0]},originalExtension=getExtension(this.originalUrl),currentExtension=getExtension(this.name),downloadName=currentExtension===originalExtension?this.name:this.name+"."+originalExtension,NormalizeUri(downloadDomain+"/"+this.fileUrl+"?dn="+downloadName)}),_.forEach(["rename","remove","move","edit","getDownloadLink"],function(_this){return function(actionName){return _this.can[actionName]=$$.disableAtProcessing(_this,_this.can[actionName])}}(this))}return Item.prototype.isFavorites=function(){return _.includes(this.tags,"_favorites")},Item.prototype.isTranscoded=function(){return"READY"===this.transcodingStatus},Item.prototype.isReadOnly=function(entity){return entity.readOnly},Item}()}),this.app.factory("wrapItems",function(Item,editorConnection,nestedMethod,itemThumbnailExtender){return function(adapter){var itemsLightList,itemsList,itemsSearch,itemsSearchByTag,itemsSiteMediaList,itemsTrashList,mapItem,mapItemsList,methods,ref,ref1,ref2,ref3,ref4,ref5,ref6,ref7,ref8,ref9,upload,uploadByUrl;return mapItem=function(res){return res.data=new Item(adapter,res.data),res},mapItemsList=function(res){return res.data=_.map(res.data,function(itemData){return new Item(adapter,itemData)}),res},adapter.events.intercept([adapter.events.ITEMS.UPLOAD,adapter.events.ITEMS.UPLOAD_BY_URL],function(promises){return _.map(promises,function(promise){return promise.then(mapItem)})}),adapter.events.intercept(adapter.events.ITEM.UPDATE,function(promise){return promise.then(function(res){return _.extend(res.data,itemThumbnailExtender(res.data)),res})}),upload=null!=(ref=adapter.item)?ref.upload:void 0,uploadByUrl=null!=(ref1=adapter.item)?ref1.uploadByUrl:void 0,itemsList=null!=(ref2=adapter.items)?ref2.list:void 0,itemsLightList=null!=(ref3=adapter.items)?ref3.lightList:void 0,itemsTrashList=null!=(ref4=adapter.items)&&null!=(ref5=ref4.trash)?ref5.list:void 0,itemsSiteMediaList=null!=(ref6=adapter.items)&&null!=(ref7=ref6.siteMedia)?ref7.list:void 0,itemsSearch=null!=(ref8=adapter.items)?ref8.search:void 0,itemsSearchByTag=null!=(ref9=adapter.items)?ref9.searchByTag:void 0,methods={},null!=upload&&nestedMethod.set(methods,"item.upload",function(){var promise,wrapped;return promise=upload.apply(this,arguments),wrapped=promise.then(function(data){return editorConnection.emit("uploadSingleFile",{data:_.assign({},data),source:adapter.name}),data}).then(mapItem),promise.progress(function(data){return wrapped.notify(data)}),wrapped}),null!=uploadByUrl&&nestedMethod.set(methods,"item.uploadByUrl",function(){return uploadByUrl.apply(this,arguments).then(mapItem)}),null!=itemsList&&nestedMethod.set(methods,"items.list",function(){return itemsList.apply(this,arguments).then(mapItemsList)}),null!=itemsLightList&&nestedMethod.set(methods,"items.lightList",function(){return itemsLightList.apply(this,arguments).then(mapItemsList)}),null!=itemsTrashList&&nestedMethod.set(methods,"items.trash.list",function(){return itemsTrashList.apply(this,arguments).then(mapItemsList)}),null!=itemsSiteMediaList&&nestedMethod.set(methods,"items.siteMedia.list",function(){return itemsSiteMediaList.apply(this,arguments).then(mapItemsList)}),null!=itemsSearch&&nestedMethod.set(methods,"items.search",function(){return itemsSearch.apply(this,arguments).then(mapItemsList)}),null!=itemsSearchByTag&&nestedMethod.set(methods,"items.searchByTag",function(){return itemsSearchByTag.apply(this,arguments).then(mapItemsList)}),methods}})}.call(this),function(){"use strict";var slice=[].slice;this.app.factory("itemThumbnailExtender",function(settings,mediaTypes,supportedArchiveTypes,supportedDocsTypes){var extras,getComplexThumbnails,getDocumentExtension,getPictureThumbnails,getSecureMusicThumbnails,getSecurePictureThumbnails,getThumbnails,getVideoThumbnails,obj;return getDocumentExtension=function(fileUrl){return fileUrl.split(".")<3?"":fileUrl.split(".").pop()},getThumbnails=function(item){return{thumbnailUrl:"images/thumbnails/"+item.mediaType+".svg",thumbnail2xUrl:"images/thumbnails/"+item.mediaType+".svg"}},getSecureMusicThumbnails=function(){return{thumbnailUrl:"images/thumbnails/music.svg",thumbnail2xUrl:"images/thumbnails/music.svg"}},getPictureThumbnails=function(item){if(_.isNull(item.thumbnailUrl))return{thumbnailUrl:"images/thumbnails/Images.svg"}},getVideoThumbnails=function(item){return{fileOutput:item.fileOutput}},getSecurePictureThumbnails=function(item){if(settings.namespace)return{thumbnailUrl:item.thumbnailUrl+"?ns="+settings.namespace,previewUrl:item.previewUrl+"?ns="+settings.namespace}},getComplexThumbnails=function(item){var extension;if(extension=getDocumentExtension(item.fileUrl),_.includes(slice.call(supportedArchiveTypes).concat(slice.call(supportedDocsTypes)),extension))return{thumbnailUrl:"images/thumbnails/"+item.mediaType+"-"+extension+".svg",thumbnail2xUrl:"images/thumbnails/"+item.mediaType+"-"+extension+".svg"}},obj={},obj[""+mediaTypes.ARCHIVE]=getComplexThumbnails,obj[""+mediaTypes.DOCUMENT]=getComplexThumbnails,obj[""+mediaTypes.MUSIC]=getThumbnails,obj[""+mediaTypes.PICTURE]=getPictureThumbnails,obj[""+mediaTypes.SECURE_MUSIC]=getSecureMusicThumbnails,obj[""+mediaTypes.SECURE_PICTURE]=getSecurePictureThumbnails,obj[""+mediaTypes.SWF]=getThumbnails,obj[""+mediaTypes.VIDEO]=getVideoThumbnails,extras=obj,function(item){return extras[item.mediaType]?extras[item.mediaType](item):{}}})}.call(this),function(){"use strict";var slice=[].slice;this.app.factory("modelsMethodsWrappers",function(nestedMethod){return{setProcessing:function(model,method){return function(){var promise;return model._isProcessing=!0,promise=method.apply(this,arguments),promise.finally(function(){return model._isProcessing=!1})}},withModelUpdate:function(model,method){return function(){return method.apply(this,arguments).then(function(res){return _.assign(model,res.data)})}},disableAtProcessing:function(model,canAction){return function(){return!model._isProcessing&&canAction()}},partialIfExists:function(){var adapter,args,method,namespace;if(adapter=arguments[0],namespace=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[],null!=(method=nestedMethod.get(adapter,namespace)))return _.partial.apply(_,[method].concat(slice.call(args)))}}})}.call(this),function(){"use strict";this.app.factory("virtualActions",function(){return function(adapter){var folderUpdate,itemUpdate,methods,ref,ref1;return folderUpdate=null!=(ref=adapter.folder)?ref.update:void 0,itemUpdate=null!=(ref1=adapter.item)?ref1.update:void 0,methods={},null!=folderUpdate&&(methods.folder={rename:function(folderId,newName){return folderUpdate({id:folderId},{name:newName})},move:function(folder,moveToFolderId){return folderUpdate({id:folder.id,parentId:folder.parentId},{parentId:moveToFolderId})}}),null!=itemUpdate&&(methods.item={rename:function(itemId,newName){return itemUpdate({id:itemId},{name:newName})},move:function(item,moveToFolderId){return itemUpdate({id:item.id,folderId:item.folderId},{folderId:moveToFolderId})},makeFavorites:function(item){var tagsArr;return tagsArr=Array.prototype.slice(item.tags||[]),tagsArr.push("_favorites"),tagsArr=_.uniq(tagsArr),itemUpdate({id:item.id,tags:item.tags},{tags:tagsArr})},unmakeFavorites:function(item){var tagsArr;return tagsArr=Array.prototype.slice(item.tags||[]),tagsArr=_.without(tagsArr,"_favorites"),itemUpdate({id:item.id,tags:item.tags},{tags:tagsArr})}}),methods}})}.call(this),function(){"use strict";this.app.factory("defaultOptions",function(settings,nestedMethod){return function(adapter){var extendArgument,language,languageMediaType,mediaType,methods;return methods={},extendArgument=function(namespace,argumentIndex,geArg){var originalMethod;if(originalMethod=nestedMethod.get(adapter,namespace))return nestedMethod.set(methods,namespace,function(){var args;return args=Array.prototype.slice.call(arguments),_.isArray(args[argumentIndex])?args[argumentIndex]=_.map(args[argumentIndex],function(entity){return _.assign(geArg(),entity)}):args[argumentIndex]=_.assign(geArg(),args[argumentIndex]),originalMethod.apply(this,args)})},mediaType=function(){return{mediaType:settings.mediaType}},language=function(){return{language:settings.i18nCode}},languageMediaType=function(){return{language:settings.i18nCode,mediaType:settings.mediaType}},extendArgument("folders.list",1,mediaType),extendArgument("folders.trash.list",1,mediaType),extendArgument("folder.create",1,mediaType),extendArgument("items.list",1,mediaType),extendArgument("items.trash.list",1,mediaType),extendArgument("items.siteMedia.list",1,mediaType),extendArgument("items.searchByTag",1,mediaType),extendArgument("items.search",2,mediaType),extendArgument("items.upload",0,mediaType),extendArgument("items.uploadByUrl",0,mediaType),"public"===adapter.name&&(extendArgument("folders.list",1,language),extendArgument("item.get",1,language),extendArgument("items.list",1,languageMediaType),extendArgument("items.lightList",1,languageMediaType),extendArgument("items.search",2,languageMediaType)),"shutterstock"!==adapter.name&&"shutterStockVideo"!==adapter.name||(extendArgument("items.list",1,language),extendArgument("items.search",2,language)),methods}})}.call(this),function(){"use strict";var slice=[].slice,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};this.app.factory("nestedFoldersList",function(nestedMethod,externalAdaptersWithNestedSupport){var filterResByParentId;return filterResByParentId=function(parentId,promise){return promise.then(function(res){var foldersIds,unsorted;return parentId||(unsorted=_.find(res.data,function(folder){return null===folder.parentId}),parentId=null!=unsorted?unsorted.id:void 0),parentId?res.data=_.filter(res.data,function(folder){return folder.parentId===parentId||folder===unsorted}):(foldersIds=_.pluck(res.data,"id"),_.remove(res.data,function(folder){return _.includes(foldersIds,folder.parentId)})),res})},function(adapter){var adaptersWithNestedSupport,foldersList,foldersTrashList,methods,ref,ref1,ref2,ref3;return adaptersWithNestedSupport=["private"].concat(slice.call(externalAdaptersWithNestedSupport)),ref=adapter.name,indexOf.call(adaptersWithNestedSupport,ref)<0?{}:(adapter.events.intercept([adapter.events.FOLDERS.LIST],function(promise,event){var parentId;return parentId=event.arguments[0],filterResByParentId(parentId,promise)}),foldersList=null!=(ref1=adapter.folders)?ref1.list:void 0,foldersTrashList=null!=(ref2=adapter.folders)&&null!=(ref3=ref2.trash)?ref3.list:void 0,methods={},null!=foldersList&&nestedMethod.set(methods,"folders.list",function(parentId){var promise;return promise=foldersList.apply(this,arguments),filterResByParentId(parentId,promise)}),null!=foldersTrashList&&nestedMethod.set(methods,"folders.trash.list",function(parentId){var promise;return/^trash/i.test(parentId)&&(parentId=null),promise=foldersTrashList.apply(this,arguments),filterResByParentId(parentId,promise)}),methods)}})}.call(this),function(){"use strict";this.app.factory("allMediaFolder",function($q,Folder,settings,i18n,nestedMethod){var createAllMediaFolder;return createAllMediaFolder=function(adapter){return new Folder(adapter,{id:null,virtualId:"allMedia_"+settings.mediaType,mediaType:settings.mediaType,parentId:null,name:i18n.translate("private_media.all_media"),filesCount:0,createdAt:0,isVirtual:!0,type:"allMedia",can:{rename:function(){return!1},remove:function(){return!1},moveItemIn:function(){return!1}},foldersList:function(){return $q.when([])}})},function(adapter){var foldersList,methods,ref;return _.includes(["private","platform"],adapter.name)?(foldersList=null!=(ref=adapter.folders)?ref.list:void 0,methods={},nestedMethod.set(methods,"folders.list",function(parentId){return foldersList.apply(this,arguments).then(function(list){return parentId?list:(list.data.unshift(createAllMediaFolder(adapter)),list)})}),methods):{}}})}.call(this),function(){"use strict";this.app.factory("siteMediaFolder",function($q,Folder,settings,i18n,nestedMethod){var createSiteMediaFolder;return createSiteMediaFolder=function(adapter){return new Folder(adapter,{id:"siteMedia",virtualId:"siteMedia_"+settings.mediaType,mediaType:settings.mediaType,parentId:null,name:i18n.translate("private_media.site_media"),filesCount:0,createdAt:0,isVirtual:!0,type:"siteMedia",can:{rename:function(){return!1},remove:function(){return!1},moveItemIn:function(){return!0}},foldersList:function(){return $q.when([])},itemsList:function(options){return adapter.items.siteMedia.list(null,options)},moveItemIn:function(item){return item.addToSiteMedia()}})},function(adapter){var foldersList,methods,ref;return"private"!==adapter.name?{}:(foldersList=null!=(ref=adapter.folders)?ref.list:void 0,methods={},nestedMethod.set(methods,"folders.list",function(parentId){return foldersList.apply(this,arguments).then(function(list){return parentId?list:(list.data.unshift(createSiteMediaFolder(adapter)),list)})}),methods)}})}.call(this),function(){"use strict";this.app.factory("unsortedFolder",function($q,Folder,i18n,nestedMethod,settings){var createUnsorted,makeUnsorted;return makeUnsorted=function(rootFolder,adapter){return rootFolder.name=i18n.translate(("private"===adapter.name?"private_media":adapter.name)+".unsorted"),rootFolder.isVirtual=!0,rootFolder.type="unsorted",rootFolder.can={rename:function(){return!1},remove:function(){return!1},move:function(){return!1}},rootFolder.foldersList=function(){return $q.when([])},rootFolder},createUnsorted=function(adapter){var folder;return folder=new Folder(adapter,{id:null,virtualId:"unsorted_"+settings.mediaType,mediaType:settings.mediaType,parentId:null,createdAt:0}),makeUnsorted(folder,adapter)},function(adapter){var foldersList,methods,ref;return _.includes(["private","collection","settingsPassed"],adapter.name)?(foldersList=null!=(ref=adapter.folders)?ref.list:void 0,methods={},nestedMethod.set(methods,"folders.list",function(parentId){return foldersList.apply(this,arguments).then(function(list){var rootFolder;return parentId?list:(rootFolder=_.find(list.data,function(folder){return null===folder.parentId}),rootFolder&&"private"===adapter.name?(_.remove(list.data,rootFolder),list.data.unshift(makeUnsorted(rootFolder,adapter))):list.data.unshift(createUnsorted(adapter)),list)})}),methods):{}}})}.call(this),function(){"use strict";this.app.factory("purchasedFolder",function($q,i18n,settings,mediaTypes,nestedMethod){return function(adapter){var foldersList,methods,ref;return"private"!==adapter.name||settings.mediaType!==mediaTypes.PICTURE?{}:(foldersList=null!=(ref=adapter.folders)?ref.list:void 0,methods={},nestedMethod.set(methods,"folders.list",function(parentId){return foldersList.apply(this,arguments).then(function(list){return parentId?list:(list.data.push({id:"purchased"+settings.mediaType,name:i18n.translate("private_media.purchased"),type:"purchased",isVirtual:!0,mediaType:settings.mediaType,can:{rename:function(){return!1},remove:function(){return!1},moveItemIn:function(){return!1},moveFolderIn:function(){return!1},move:function(){return!1},uploadIn:function(){return!1}},foldersList:function(){return $q.when([])},itemsList:function(options){return null==options&&(options={}),adapter.items.searchByTag("_paid",options)}}),list)})}),methods)}})}.call(this),function(){"use strict";this.app.factory("favoritesFolder",function(i18n,settings,$q,nestedMethod){return function(adapter){var foldersList,methods,ref;return"private"!==adapter.name?{}:(foldersList=null!=(ref=adapter.folders)?ref.list:void 0,methods={},nestedMethod.set(methods,"folders.list",function(parentId){return foldersList.apply(this,arguments).then(function(list){return parentId?list:(list.data.push({id:"favorites"+settings.mediaType,name:i18n.translate("private_media.favorites"),type:"favorites",isVirtual:!0,mediaType:settings.mediaType,can:{rename:function(){return!1},remove:function(){return!1},moveItemIn:function(){return!0},moveFolderIn:function(){return!1},move:function(){return!1},uploadIn:function(){return!1}},foldersList:function(){return $q.when([])},itemsList:function(options){return null==options&&(options={}),adapter.items.searchByTag("_favorites",options)},moveItemIn:function(item){return adapter.item.makeFavorites(item)}}),list)})}),methods)}})}.call(this),function(){"use strict";this.app.factory("trashFolder",function(i18n,settings,nestedMethod,confirm){return function(adapter){var foldersList,methods,ref,ref1;return"private"!==adapter.name||null==(null!=(ref=adapter.items)?ref.trash:void 0)?{}:(foldersList=null!=(ref1=adapter.folders)?ref1.list:void 0,methods={},nestedMethod.set(methods,"folders.list",function(parentId){return foldersList.apply(this,arguments).then(function(list){return parentId?list:(list.data.push({id:"trash"+settings.mediaType,name:i18n.translate("private_media.trash"),type:"trash",isVirtual:!0,mediaType:settings.mediaType,can:{rename:function(){return!1},remove:function(){return!1},moveItemIn:function(){return!0},move:function(){return!1},uploadIn:function(){return!1},restore:function(){return!0},deleteAll:function(){return!0}},itemsList:function(options){return adapter.items.trash.list(null,options)},foldersList:function(options){return adapter.folders.trash.list(null,options)},moveItemIn:function(item){return item.remove()},moveFolderIn:function(folder){return folder.remove()},restore:function(){return confirm({confirmTitle:i18n.translate("private_media.restore_confirmation.title"),confirmMessage:i18n.translate("private_media.restore_confirmation.message"),confirmYes:i18n.translate("private_media.restore_confirmation.yes"),confirmNo:i18n.translate("private_media.restore_confirmation.no"),confirm:function(){return adapter.trash.restore({mediaType:settings.mediaType})},className:"blue"}),!1},deleteAll:function(){return confirm({confirmTitle:i18n.translate("private_media.empty_trash_confirmation.title"),confirmMessage:i18n.translate("private_media.empty_trash_confirmation.message"),confirmYes:i18n.translate("private_media.empty_trash_confirmation.yes"),confirmNo:i18n.translate("private_media.empty_trash_confirmation.no"),confirm:function(){return adapter.trash.remove({mediaType:settings.mediaType})}}),!1}}),list)})}),methods)}})}.call(this),function(){"use strict";var ref,ref1;null!=(ref=this.appLoadNotifiers)&&ref.appIsInitialized(),this.app.config(function(_this){return function($httpProvider,RestangularProvider){return $httpProvider.defaults.withCredentials=!0,$httpProvider.defaults.responseType="json",$httpProvider.interceptors.push("UrlSanitizeInterceptor"),RestangularProvider.setDefaultHeaders({"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}),RestangularProvider.setDefaultRequestParams("jsonp",{callback:"JSON_CALLBACK"}),RestangularProvider.setDefaultHttpFields({withCredentials:!0})}}()),null!=(ref1=this.appLoadNotifiers)&&ref1.componentsAreConfigured(),this.app.run(["editorConnection","appLoad","biSubscribeUpload",function(_this){return function(editorConnection,appLoad){var ref2,ref3;return null!=(ref2=_this.appLoadNotifiers)&&ref2.appIsRunning(),appLoad.integrate(),editorConnection.emit("ready"),null!=(ref3=_this.appLoadNotifiers)?ref3.sentReadyToProtocol():void 0}}(this)])}.call(this);